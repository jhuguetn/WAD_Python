<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Tools.dbTools.dbTool &mdash; ..  documentation</title>
    
    <link rel="stylesheet" href="../../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="top" title="..  documentation" href="../../../index.html" />
    <link rel="up" title="Module code" href="../../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">..  documentation</a> &raquo;</li>
          <li><a href="../../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for Tools.dbTools.dbTool</h1><div class="highlight"><pre>
<span class="c">#!/usr/bin/python</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Changelog:</span>
<span class="sd">20150617: Fix crash on empty value; SeekAndDestroy (SrcAET) added; restructured SeekAndDestroy for SrcAET,Modality,StationName</span>
<span class="sd">20150413: SeekAndDestroy (modality)</span>
<span class="sd">20150407: SeekAndDestroy (selector); fix empty stationname</span>
<span class="sd">20150317: Fix crash on empty value; added SrcAET info</span>
<span class="sd">20150305: Fix for empty selectors crash (EPIStab)</span>
<span class="sd">20150210: Fix for crash on trying to add a None to qctable</span>
<span class="sd">20141010: Fix remove all traces of one StationName; added remove all traces of one GewensteID; addAnatomy voor CT2</span>
<span class="sd">20141008: Add option to remove all traces of one StationName</span>
<span class="sd">20140627: added MIR excerpt</span>
<span class="sd">20140618: scaling between -1 and 1</span>
<span class="sd">20140617: Added Current Status Report</span>
<span class="sd">20140616: Allow &quot;None&quot; for station_name or modality; stacked graphs; critical lines</span>
<span class="sd">20140613: distinguishable colors in report; sorting on date in report</span>
<span class="sd">20140611: reportgenerator added</span>
<span class="sd">20140610: ability to select items to show/hide in report</span>
<span class="sd">20140606: added FilterName to description of MG studies</span>
<span class="sd">20140603: added reporting</span>
<span class="sd">20140528: added &#39;purge&#39; option to Database to delete XML files</span>
<span class="sd">20140521: initial version</span>

<span class="sd">TODO:</span>
<span class="sd">    o Herschrijf onSeekandDestroyStation net als onSeekandDestroyGewenst</span>
<span class="sd">    o Bouw optie om data te corrigeren (wrong or no stationname, etc)</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">OrderedDict</span>
<span class="kn">from</span> <span class="nn">pyqtgraph.Qt</span> <span class="kn">import</span> <span class="n">QtGui</span><span class="p">,</span><span class="n">QtCore</span>
<span class="kn">import</span> <span class="nn">pyqtgraph</span> <span class="kn">as</span> <span class="nn">pg</span>
<span class="kn">import</span> <span class="nn">MySQLdb</span> <span class="kn">as</span> <span class="nn">mdb</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">ConfigParser</span> <span class="kn">import</span> <span class="n">SafeConfigParser</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">functools</span>
<span class="kn">from</span> <span class="nn">reporter</span> <span class="kn">import</span> <span class="n">Reporter</span>

<div class="viewcode-block" id="datetime2seconds"><a class="viewcode-back" href="../../../Tools.dbTools.html#Tools.dbTools.dbTool.datetime2seconds">[docs]</a><span class="k">def</span> <span class="nf">datetime2seconds</span><span class="p">(</span><span class="n">dt</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">time</span><span class="o">.</span><span class="n">mktime</span><span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">timetuple</span><span class="p">())</span>
</div>
<div class="viewcode-block" id="reportentry"><a class="viewcode-back" href="../../../Tools.dbTools.html#Tools.dbTools.dbTool.reportentry">[docs]</a><span class="k">class</span> <span class="nc">reportentry</span><span class="p">:</span>
    <span class="n">gpid</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">seriesid</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">stationname</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">status</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">selector</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">modality</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">date</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">description</span> <span class="o">=</span> <span class="bp">None</span> <span class="c"># concat of series_description and FilterName if exists in resultaten_char</span>
    <span class="n">analysisresult</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">analysisdate</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">srcaet</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">gpid</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">stationname</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">modality</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">date</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">selector</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">status</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">seriesid</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">analysisresult</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">analysisdate</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">srcaet</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gpid</span> <span class="o">=</span> <span class="n">gpid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stationname</span> <span class="o">=</span> <span class="n">stationname</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modality</span> <span class="o">=</span> <span class="n">modality</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">date</span> <span class="o">=</span> <span class="n">date</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selector</span> <span class="o">=</span> <span class="n">selector</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">status</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">description</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seriesid</span> <span class="o">=</span> <span class="n">seriesid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">analysisresult</span> <span class="o">=</span> <span class="n">analysisresult</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">analysisdate</span> <span class="o">=</span> <span class="n">analysisdate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">srcaet</span> <span class="o">=</span> <span class="n">srcaet</span>
</div>
<div class="viewcode-block" id="dbTool"><a class="viewcode-back" href="../../../Tools.dbTools.html#Tools.dbTools.dbTool.dbTool">[docs]</a><span class="k">class</span> <span class="nc">dbTool</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QMainWindow</span><span class="p">):</span>
    <span class="n">qcversion</span> <span class="o">=</span> <span class="mi">20150617</span>
    <span class="n">verbose</span> <span class="o">=</span> <span class="bp">False</span>

    <span class="n">stModeProcessor</span> <span class="o">=</span> <span class="s">&#39;processor&#39;</span>
    <span class="n">stModeReport</span> <span class="o">=</span> <span class="s">&#39;report&#39;</span>
    <span class="n">stModeDestroy</span> <span class="o">=</span> <span class="s">&#39;destroy&#39;</span>

    <span class="n">runmode</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">host</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">user</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">pswd</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">rootxml</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="n">iqcdb</span> <span class="o">=</span> <span class="s">&#39;iqc&#39;</span>
    <span class="n">table_gewenste_processen</span> <span class="o">=</span> <span class="s">&#39;gewenste_processen&#39;</span>
    <span class="n">table_studies</span> <span class="o">=</span> <span class="s">&#39;study&#39;</span>
    <span class="n">table_series</span> <span class="o">=</span> <span class="s">&#39;series&#39;</span>
    <span class="n">table_instances</span> <span class="o">=</span> <span class="s">&#39;instance&#39;</span>
    <span class="n">table_patient</span> <span class="o">=</span> <span class="s">&#39;patient&#39;</span>
    <span class="n">table_files</span> <span class="o">=</span> <span class="s">&#39;files&#39;</span>
    <span class="n">table_selector</span> <span class="o">=</span> <span class="s">&#39;selector&#39;</span>
    <span class="n">table_status_omschrijving</span> <span class="o">=</span> <span class="s">&#39;status_omschrijving&#39;</span>

    <span class="n">table_char</span> <span class="o">=</span> <span class="s">&#39;resultaten_char&#39;</span>
    <span class="n">table_float</span> <span class="o">=</span> <span class="s">&#39;resultaten_floating&#39;</span>
    <span class="n">table_object</span> <span class="o">=</span> <span class="s">&#39;resultaten_object&#39;</span>
    <span class="n">table_bool</span> <span class="o">=</span> <span class="s">&#39;resultaten_boolean&#39;</span>
    <span class="n">table_status</span> <span class="o">=</span> <span class="s">&#39;resultaten_status&#39;</span>

    <span class="n">table_analyseinput</span> <span class="o">=</span> <span class="s">&#39;analysemodule_input&#39;</span>
    <span class="n">table_analyseoutput</span> <span class="o">=</span> <span class="s">&#39;analysemodule_output&#39;</span>
    <span class="n">table_collectorstatusseries</span>  <span class="o">=</span> <span class="s">&#39;collector_series_status&#39;</span>
    <span class="n">table_collectorstatusstudies</span> <span class="o">=</span> <span class="s">&#39;collector_study_status&#39;</span>

    <span class="n">status_reset</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">qctable</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">qcgraph</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">qcgroupbox</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">qcplots</span> <span class="o">=</span> <span class="bp">None</span> <span class="c"># dictionary of measurement_names (plot)</span>
    <span class="n">qctext</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">statusLabel</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">selectedModality</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">selectedStation</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">selectedSelector</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">selectedStatus</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">selectedGewenst</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="n">selectedReportPeriod</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">selectedReportQCPeriodicity</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">selectedReportDateTimestart</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">selectedReportDateTimeuntil</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">reportentries</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">reporter</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="n">status_id_text</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">selector_id_text</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="n">truncate_tables</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s">&#39;analysemodule_input&#39;</span><span class="p">,</span>
        <span class="s">&#39;analysemodule_output&#39;</span><span class="p">,</span>
        <span class="s">&#39;collector_series_status&#39;</span><span class="p">,</span>
        <span class="s">&#39;collector_study_status&#39;</span><span class="p">,</span>
        <span class="s">&#39;files&#39;</span><span class="p">,</span>
        <span class="s">&#39;gewenste_processen&#39;</span><span class="p">,</span>
        <span class="s">&#39;instance&#39;</span><span class="p">,</span>
        <span class="s">&#39;patient&#39;</span><span class="p">,</span>
        <span class="s">&#39;resultaten_boolean&#39;</span><span class="p">,</span>
        <span class="s">&#39;resultaten_char&#39;</span><span class="p">,</span>
        <span class="s">&#39;resultaten_floating&#39;</span><span class="p">,</span>
        <span class="s">&#39;resultaten_object&#39;</span><span class="p">,</span>
        <span class="s">&#39;resultaten_status&#39;</span><span class="p">,</span>
        <span class="s">&#39;series&#39;</span><span class="p">,</span>
        <span class="s">&#39;study&#39;</span><span class="p">,</span>
        <span class="p">]</span>

    <span class="n">stNone</span> <span class="o">=</span> <span class="s">&#39;NONE&#39;</span>
    <span class="n">stResultOK</span> <span class="o">=</span> <span class="s">&#39;Ok&#39;</span>
    <span class="n">stResultOutOfRange</span> <span class="o">=</span> <span class="s">&#39;Out of Range&#39;</span>
    <span class="n">stResultNoRanges</span> <span class="o">=</span> <span class="s">&#39;No limits&#39;</span>
    <span class="n">stResultError</span> <span class="o">=</span> <span class="s">&#39;Error&#39;</span>
    <span class="n">destroylist</span> <span class="o">=</span> <span class="p">[]</span>

<div class="viewcode-block" id="dbTool.pswdFromDialog"><a class="viewcode-back" href="../../../Tools.dbTools.html#Tools.dbTools.dbTool.dbTool.pswdFromDialog">[docs]</a>    <span class="k">def</span> <span class="nf">pswdFromDialog</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">diag</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QInputDialog</span><span class="p">()</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s">&quot;Enter password&quot;</span>
        <span class="n">text</span> <span class="o">=</span> <span class="s">&quot;Password for mysql user </span><span class="si">%s</span><span class="s"> at host </span><span class="si">%s</span><span class="s">: &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">while</span> <span class="n">s</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">qstring</span><span class="p">,</span> <span class="n">ok</span> <span class="o">=</span> <span class="n">diag</span><span class="o">.</span><span class="n">getText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QString</span><span class="p">(</span><span class="n">title</span><span class="p">),</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QString</span><span class="p">(</span><span class="n">text</span><span class="p">),</span> <span class="n">mode</span><span class="o">=</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QLineEdit</span><span class="o">.</span><span class="n">Password</span><span class="p">)</span>
            <span class="n">s</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">qstring</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ok</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span> <span class="c"># user pressed Cancel</span>
                <span class="k">return</span> <span class="bp">None</span>
            <span class="k">if</span> <span class="n">s</span> <span class="o">==</span> <span class="s">&#39;&#39;</span><span class="p">:</span>     <span class="c"># user entered nothing</span>
                <span class="n">s</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">return</span> <span class="n">s</span>
</div>
<div class="viewcode-block" id="dbTool.configError"><a class="viewcode-back" href="../../../Tools.dbTools.html#Tools.dbTools.dbTool.dbTool.configError">[docs]</a>    <span class="k">def</span> <span class="nf">configError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ininame</span><span class="p">):</span>
        <span class="k">print</span> <span class="s">&quot;ERROR: configfile </span><span class="si">%s</span><span class="s"> corrupt or non-existent. Should look like:</span><span class="se">\n</span><span class="s">[iqc]</span><span class="se">\n</span><span class="s">host = localhost</span><span class="se">\n</span><span class="s">&quot;</span> \
              <span class="s">&quot;user = root</span><span class="se">\n</span><span class="s">pswd = ***</span><span class="se">\n\n</span><span class="s">with valid values for host and user.</span><span class="se">\n</span><span class="s">Optionally xmlroot=/opt can be supplied</span><span class="se">\n</span><span class="s">&quot;</span> \
              <span class="s">&quot;if pswd is blank then a dialog will ask for a valid password</span><span class="se">\n</span><span class="s">&quot;</span> \
              <span class="s">&quot;alternatively pswd2 = xxx can be given, with xxx the base64encoded password&quot;</span><span class="o">%</span> <span class="n">ininame</span>
        <span class="n">QtGui</span><span class="o">.</span><span class="n">qApp</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
        <span class="nb">exit</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="dbTool.configRead"><a class="viewcode-back" href="../../../Tools.dbTools.html#Tools.dbTools.dbTool.dbTool.configRead">[docs]</a>    <span class="k">def</span> <span class="nf">configRead</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ininame</span><span class="p">):</span>
        <span class="n">parser</span> <span class="o">=</span> <span class="n">SafeConfigParser</span><span class="p">()</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">ininame</span><span class="p">)</span>
        <span class="n">section</span> <span class="o">=</span> <span class="s">&#39;iqc&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">parser</span><span class="o">.</span><span class="n">has_section</span><span class="p">(</span><span class="n">section</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">configError</span><span class="p">(</span><span class="n">ininame</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">candidates</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;host&#39;</span><span class="p">,</span><span class="s">&#39;user&#39;</span><span class="p">,</span><span class="s">&#39;pswd&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">can</span> <span class="ow">in</span> <span class="n">candidates</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">parser</span><span class="o">.</span><span class="n">has_option</span><span class="p">(</span><span class="n">section</span><span class="p">,</span><span class="n">can</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">configError</span><span class="p">(</span><span class="n">ininame</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">host</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">section</span><span class="p">,</span><span class="s">&#39;host&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">section</span><span class="p">,</span><span class="s">&#39;user&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pswd</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">section</span><span class="p">,</span><span class="s">&#39;pswd&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">parser</span><span class="o">.</span><span class="n">has_option</span><span class="p">(</span><span class="n">section</span><span class="p">,</span><span class="s">&#39;xmlroot&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xmlroot</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">section</span><span class="p">,</span><span class="s">&#39;xmlroot&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xmlroot</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pswd</span> <span class="ow">is</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">base64</span>
            <span class="n">pswd2</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">section</span><span class="p">,</span><span class="s">&#39;pswd2&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">pswd2</span> <span class="ow">is</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pswd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pswdFromDialog</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">pswd</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">pswd2</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">pswd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pswdFromDialog</span><span class="p">()</span>
                    <span class="k">print</span> <span class="s">&#39;add line pswd2 = </span><span class="si">%s</span><span class="s"> to dbTool.ini&#39;</span> <span class="o">%</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pswd</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">dbTool</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        <span class="sd">&quot;&quot;&quot;Config&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">configRead</span><span class="p">(</span><span class="s">&#39;dbTool.ini&#39;</span><span class="p">)</span>

        <span class="sd">&quot;&quot;&quot;Constructor&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qw</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QWidget</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setCentralWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qw</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QGridLayout</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statusBar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statusBar</span><span class="p">()</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span><span class="s">&#39;Ready&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">700</span><span class="p">,</span> <span class="mi">512</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s">&quot;dbTool v&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qcversion</span><span class="p">));</span>
        <span class="n">menubar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">menuBar</span><span class="p">()</span>
        <span class="n">fileMenu</span> <span class="o">=</span> <span class="n">menubar</span><span class="o">.</span><span class="n">addMenu</span><span class="p">(</span><span class="s">&#39;&amp;File&#39;</span><span class="p">)</span>
        <span class="n">exitAction</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QAction</span><span class="p">(</span><span class="s">&quot;&amp;Quit&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="n">exitAction</span><span class="o">.</span><span class="n">setShortcut</span><span class="p">(</span><span class="s">&#39;Ctrl+Q&#39;</span><span class="p">)</span>
        <span class="n">exitAction</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">qApp</span><span class="o">.</span><span class="n">quit</span><span class="p">)</span>
        <span class="n">fileMenu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="n">exitAction</span><span class="p">)</span>

        <span class="n">processorMenu</span> <span class="o">=</span> <span class="n">menubar</span><span class="o">.</span><span class="n">addMenu</span><span class="p">(</span><span class="s">&quot;&amp;Processor&quot;</span><span class="p">)</span>
        <span class="n">procresetAction</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QAction</span><span class="p">(</span><span class="s">&quot;Reset: Select which processor status to reset&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="n">procresetAction</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">processorReset</span><span class="p">)</span>
        <span class="n">processorMenu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="n">procresetAction</span><span class="p">)</span>

        <span class="n">databaseactions</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="s">&quot;Truncate: remove all results and datasets&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">databaseTruncatePopUp</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;Purge: Truncate database and remove XML files&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">popupPurge</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;Seek and Destroy: remove all iqc database traces of a given Src-AET (will start reimport from dcm4chee)&quot;</span><span class="p">,</span><span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seekandDestroy</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s">&#39;Src-AET&#39;</span><span class="p">)),</span>
            <span class="p">(</span><span class="s">&quot;Seek and Destroy: remove all iqc database traces of a given StationName (will start reimport from dcm4chee)&quot;</span><span class="p">,</span><span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seekandDestroy</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s">&#39;StationName&#39;</span><span class="p">)),</span>
            <span class="p">(</span><span class="s">&quot;Seek and Destroy: remove all iqc database traces of a given GewenstID (will start reimport from dcm4chee)&quot;</span><span class="p">,</span><span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seekandDestroy</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s">&#39;GewenstID&#39;</span><span class="p">)),</span>
            <span class="p">(</span><span class="s">&quot;Seek and Destroy: remove all iqc database traces of a given Selector (will start reimport from dcm4chee)&quot;</span><span class="p">,</span><span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seekandDestroy</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s">&#39;Selector&#39;</span><span class="p">)),</span>
            <span class="p">(</span><span class="s">&quot;Seek and Destroy: remove all iqc database traces of all selectors of a given Modality (will start reimport from dcm4chee)&quot;</span><span class="p">,</span><span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seekandDestroy</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s">&#39;Modality&#39;</span><span class="p">)),</span>
        <span class="p">]</span>
        <span class="n">databaseMenu</span> <span class="o">=</span> <span class="n">menubar</span><span class="o">.</span><span class="n">addMenu</span><span class="p">(</span><span class="s">&quot;&amp;Database&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ra</span> <span class="ow">in</span> <span class="n">databaseactions</span><span class="p">:</span>
            <span class="n">dbAction</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QAction</span><span class="p">(</span><span class="n">ra</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="p">)</span>
            <span class="n">dbAction</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">ra</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">databaseMenu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="n">dbAction</span><span class="p">)</span>

        <span class="n">reportactions</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="s">&quot;Periodic status report&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">periodicStatus</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;Current status report per selector+description&quot;</span><span class="p">,</span><span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currentStatus</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s">&#39;selector+description&#39;</span><span class="p">)),</span>
            <span class="p">(</span><span class="s">&quot;Current status report per selector&quot;</span><span class="p">,</span><span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currentStatus</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s">&#39;selector&#39;</span><span class="p">)),</span>
            <span class="p">(</span><span class="s">&quot;Demo status report&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">reportDemo</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;MIR Bucky report&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">reportMIRBucky</span><span class="p">),</span>
            <span class="p">]</span>
        <span class="n">reportMenu</span> <span class="o">=</span> <span class="n">menubar</span><span class="o">.</span><span class="n">addMenu</span><span class="p">(</span><span class="s">&quot;&amp;Reports&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ra</span> <span class="ow">in</span> <span class="n">reportactions</span><span class="p">:</span>
            <span class="n">reportAction</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QAction</span><span class="p">(</span><span class="n">ra</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="p">)</span>
            <span class="n">reportAction</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">ra</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">reportMenu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="n">reportAction</span><span class="p">)</span>

        <span class="c"># create progress bar</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statusLabel</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statusBar</span><span class="p">()</span><span class="o">.</span><span class="n">addPermanentWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">statusLabel</span><span class="p">)</span>

<div class="viewcode-block" id="dbTool.clearLayout"><a class="viewcode-back" href="../../../Tools.dbTools.html#Tools.dbTools.dbTool.dbTool.clearLayout">[docs]</a>    <span class="k">def</span> <span class="nf">clearLayout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layout</span><span class="p">,</span><span class="n">layoutOnly</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">layout</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">while</span> <span class="n">layout</span><span class="o">.</span><span class="n">count</span><span class="p">():</span>
                <span class="n">item</span> <span class="o">=</span> <span class="n">layout</span><span class="o">.</span><span class="n">takeAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">widget</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">widget</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">widget</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">widget</span><span class="o">.</span><span class="n">deleteLater</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">clearLayout</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">layout</span><span class="p">())</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">layoutOnly</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qcgraph</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qctable</span> <span class="o">=</span> <span class="bp">None</span>
</div>
<div class="viewcode-block" id="dbTool.connectdb"><a class="viewcode-back" href="../../../Tools.dbTools.html#Tools.dbTools.dbTool.dbTool.connectdb">[docs]</a>    <span class="k">def</span> <span class="nf">connectdb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">host</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">user</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">pswd</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">db</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">host</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">host</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">host</span>
        <span class="k">if</span> <span class="n">user</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">user</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">user</span>
        <span class="k">if</span> <span class="n">pswd</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">pswd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pswd</span>
        <span class="k">if</span> <span class="n">db</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">db</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">iqcdb</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">con</span> <span class="o">=</span> <span class="n">mdb</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">host</span><span class="p">,</span><span class="n">user</span><span class="p">,</span><span class="n">pswd</span><span class="p">,</span><span class="n">db</span><span class="p">)</span> <span class="c"># host, username, pswd, db</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">(</span><span class="n">mdb</span><span class="o">.</span><span class="n">cursors</span><span class="o">.</span><span class="n">DictCursor</span><span class="p">)</span> <span class="c"># dictionary format, i.e. access by column name</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;select * from config&quot;</span><span class="p">)</span>
            <span class="n">rows</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
            <span class="n">dbversion</span><span class="o">=</span><span class="s">&#39;0&#39;</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;property&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;Version_Database&quot;</span><span class="p">:</span>
                    <span class="n">dbversion</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;value&#39;</span><span class="p">])</span>
        <span class="k">except</span> <span class="n">mdb</span><span class="o">.</span><span class="n">Error</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;[connectdb] Error </span><span class="si">%d</span><span class="s">: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">con</span><span class="p">,</span><span class="n">cur</span><span class="p">,</span><span class="n">dbversion</span>
</div>
<div class="viewcode-block" id="dbTool.closedb"><a class="viewcode-back" href="../../../Tools.dbTools.html#Tools.dbTools.dbTool.dbTool.closedb">[docs]</a>    <span class="k">def</span> <span class="nf">closedb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">con</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">con</span><span class="p">:</span>
            <span class="n">con</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="dbTool.processorShowSelected"><a class="viewcode-back" href="../../../Tools.dbTools.html#Tools.dbTools.dbTool.dbTool.processorShowSelected">[docs]</a>    <span class="k">def</span> <span class="nf">processorShowSelected</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">selected</span><span class="p">):</span>
        <span class="n">columnsToShow</span><span class="o">=</span><span class="p">[</span>
            <span class="s">&#39;status&#39;</span><span class="p">,</span>
            <span class="s">&#39;selector_fk&#39;</span><span class="p">,</span>
            <span class="s">&#39;creation_time&#39;</span>
            <span class="p">]</span>
        <span class="c">###1 open db iqc</span>
        <span class="n">con</span><span class="p">,</span><span class="n">cur</span><span class="p">,</span><span class="n">dbversion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectdb</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="p">)</span>

        <span class="n">selrows</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">pkid</span> <span class="ow">in</span> <span class="n">selected</span><span class="p">:</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;select * from </span><span class="si">%s</span><span class="s"> where pk=</span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_gewenste_processen</span><span class="p">,</span><span class="n">pkid</span><span class="p">))</span>
            <span class="n">rows</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
            <span class="n">selrows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>  <span class="c"># should be only 1</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">headers</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">columnsToShow</span><span class="p">:</span>
                        <span class="n">headers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>

        <span class="n">headers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;Modality&#39;</span><span class="p">)</span>
        <span class="n">headers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;StationName&#39;</span><span class="p">)</span>
        <span class="n">headers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;SrcAET&#39;</span><span class="p">)</span>
        <span class="n">headers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;Description&#39;</span><span class="p">)</span>
        <span class="n">headers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;GewenstID&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="mi">1</span><span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">runmode</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">stModeReport</span><span class="p">:</span>
            <span class="n">headers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;DateTime&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">qctable</span><span class="o">.</span><span class="n">setRowCount</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">selrows</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">selected</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qctable</span><span class="o">.</span><span class="n">setColumnCount</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">headers</span><span class="p">))</span>
            <span class="n">rowid</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qctable</span><span class="o">.</span><span class="n">setHorizontalHeaderLabels</span><span class="p">(</span><span class="n">headers</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">selrows</span><span class="p">:</span>
                <span class="n">colid</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">gpid</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;pk&#39;</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">hd</span> <span class="ow">in</span> <span class="n">headers</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">status_id_text</span> <span class="ow">and</span> <span class="n">hd</span> <span class="o">==</span> <span class="s">&#39;status&#39;</span><span class="p">:</span>
                        <span class="n">valstr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status_id_text</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="n">hd</span><span class="p">]]</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">reportentries</span><span class="p">[</span><span class="n">gpid</span><span class="p">]</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">valstr</span>
                    <span class="k">elif</span> <span class="n">hd</span> <span class="o">==</span> <span class="s">&#39;selector_fk&#39;</span><span class="p">:</span>
                        <span class="n">valstr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selector_id_text</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="n">hd</span><span class="p">]]</span>
                        <span class="k">if</span> <span class="n">gpid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reportentries</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">reportentries</span><span class="p">[</span><span class="n">gpid</span><span class="p">]</span><span class="o">.</span><span class="n">selector</span> <span class="o">=</span> <span class="n">valstr</span>
                    <span class="k">elif</span> <span class="n">hd</span> <span class="o">==</span> <span class="s">&#39;Modality&#39;</span><span class="p">:</span>
                        <span class="n">valstr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reportentries</span><span class="p">[</span><span class="n">gpid</span><span class="p">]</span><span class="o">.</span><span class="n">modality</span>
                    <span class="k">elif</span> <span class="n">hd</span> <span class="o">==</span> <span class="s">&#39;StationName&#39;</span><span class="p">:</span>
                        <span class="n">valstr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reportentries</span><span class="p">[</span><span class="n">gpid</span><span class="p">]</span><span class="o">.</span><span class="n">stationname</span>
                    <span class="k">elif</span> <span class="n">hd</span> <span class="o">==</span> <span class="s">&#39;SrcAET&#39;</span><span class="p">:</span>
                        <span class="n">valstr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reportentries</span><span class="p">[</span><span class="n">gpid</span><span class="p">]</span><span class="o">.</span><span class="n">srcaet</span>
                    <span class="k">elif</span> <span class="n">hd</span> <span class="o">==</span> <span class="s">&#39;Description&#39;</span><span class="p">:</span>
                        <span class="n">valstr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reportentries</span><span class="p">[</span><span class="n">gpid</span><span class="p">]</span><span class="o">.</span><span class="n">description</span>
                    <span class="k">elif</span> <span class="n">hd</span> <span class="o">==</span> <span class="s">&#39;DateTime&#39;</span><span class="p">:</span>
                        <span class="n">valstr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reportentries</span><span class="p">[</span><span class="n">gpid</span><span class="p">]</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%Y/%m/</span><span class="si">%d</span><span class="s"> %H:%M:%S&#39;</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">hd</span> <span class="o">==</span> <span class="s">&#39;GewenstID&#39;</span><span class="p">:</span>
                        <span class="n">valstr</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reportentries</span><span class="p">[</span><span class="n">gpid</span><span class="p">]</span><span class="o">.</span><span class="n">gpid</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">valstr</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="n">hd</span><span class="p">])</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">valstr</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">qctable</span><span class="o">.</span><span class="n">setItem</span><span class="p">(</span><span class="n">rowid</span><span class="p">,</span> <span class="n">colid</span><span class="p">,</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QTableWidgetItem</span><span class="p">(</span><span class="n">valstr</span><span class="p">))</span>
                    <span class="n">colid</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">rowid</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="c">### close db</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">closedb</span><span class="p">(</span><span class="n">con</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statusLabel</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s">&quot;Selected </span><span class="si">%d</span><span class="s"> processes.&quot;</span> <span class="o">%</span><span class="nb">len</span><span class="p">(</span><span class="n">selrows</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="dbTool.onActivatedProcessorSelector"><a class="viewcode-back" href="../../../Tools.dbTools.html#Tools.dbTools.dbTool.dbTool.onActivatedProcessorSelector">[docs]</a>    <span class="k">def</span> <span class="nf">onActivatedProcessorSelector</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">text</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;[onActivatedProcessorSelector]&quot;</span><span class="p">,</span><span class="n">text</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">selector_id_text</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">text</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selectedSelector</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selector_id_text</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">text</span><span class="p">)]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">qctable</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">statusLabel</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">runmode</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">stModeDestroy</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">onSeekAndDestroySelector</span><span class="p">()</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">runmode</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">stModeReport</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">determineReportPeriod</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">onActivatedProcessorChanged</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">runmode</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">stModeReport</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">onActivatedReportChanged</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="dbTool.onActivatedProcessorStatus"><a class="viewcode-back" href="../../../Tools.dbTools.html#Tools.dbTools.dbTool.dbTool.onActivatedProcessorStatus">[docs]</a>    <span class="k">def</span> <span class="nf">onActivatedProcessorStatus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">text</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;[onActivatedProcessorStatus]&quot;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">text</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">status_id_text</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">text</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selectedStatus</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status_id_text</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">text</span><span class="p">)]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">qctable</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">statusLabel</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">runmode</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">stModeReport</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">determineReportPeriod</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">onActivatedProcessorChanged</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">runmode</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">stModeReport</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">onActivatedReportChanged</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="dbTool.onActivatedGewenstProces"><a class="viewcode-back" href="../../../Tools.dbTools.html#Tools.dbTools.dbTool.dbTool.onActivatedGewenstProces">[docs]</a>    <span class="k">def</span> <span class="nf">onActivatedGewenstProces</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">text</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;[onActivatedGewenstProces]&quot;</span><span class="p">,</span><span class="n">text</span>
        <span class="n">station</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selectedGewenst</span> <span class="o">=</span> <span class="n">station</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">qctable</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">statusLabel</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">runmode</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">stModeDestroy</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">onSeekAndDestroyGewenst</span><span class="p">()</span>
            <span class="k">return</span>
</div>
<div class="viewcode-block" id="dbTool.onActivatedProcessorStation"><a class="viewcode-back" href="../../../Tools.dbTools.html#Tools.dbTools.dbTool.dbTool.onActivatedProcessorStation">[docs]</a>    <span class="k">def</span> <span class="nf">onActivatedProcessorStation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">text</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;[onActivatedProcessorStation]&quot;</span><span class="p">,</span><span class="n">text</span>
        <span class="n">station</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selectedStation</span> <span class="o">=</span> <span class="n">station</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">qctable</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">statusLabel</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">runmode</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">stModeDestroy</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">onSeekAndDestroyStation</span><span class="p">()</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">runmode</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">stModeReport</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">determineReportPeriod</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">onActivatedProcessorChanged</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">runmode</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">stModeReport</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">onActivatedReportChanged</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="dbTool.onActivatedProcessorSrcAET"><a class="viewcode-back" href="../../../Tools.dbTools.html#Tools.dbTools.dbTool.dbTool.onActivatedProcessorSrcAET">[docs]</a>    <span class="k">def</span> <span class="nf">onActivatedProcessorSrcAET</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">text</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;[onActivatedProcessorSrcAET]&quot;</span><span class="p">,</span><span class="n">text</span>
        <span class="n">station</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selectedAET</span> <span class="o">=</span> <span class="n">station</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">qctable</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">statusLabel</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">runmode</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">stModeDestroy</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">onSeekAndDestroyStation</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s">&#39;SrcAET&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">runmode</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">stModeReport</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">determineReportPeriod</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">onActivatedProcessorChanged</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">runmode</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">stModeReport</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">onActivatedReportChanged</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="dbTool.onActivatedProcessorModality"><a class="viewcode-back" href="../../../Tools.dbTools.html#Tools.dbTools.dbTool.dbTool.onActivatedProcessorModality">[docs]</a>    <span class="k">def</span> <span class="nf">onActivatedProcessorModality</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">text</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;[onActivatedProcessorModality]&quot;</span><span class="p">,</span><span class="n">text</span>
        <span class="n">mod</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selectedModality</span> <span class="o">=</span> <span class="n">mod</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">qctable</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">statusLabel</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">runmode</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">stModeDestroy</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">onSeekAndDestroyStation</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s">&#39;Modality&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">runmode</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">stModeReport</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">determineReportPeriod</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">onActivatedProcessorChanged</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">runmode</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">stModeReport</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">onActivatedReportChanged</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="dbTool.uniqifyList"><a class="viewcode-back" href="../../../Tools.dbTools.html#Tools.dbTools.dbTool.dbTool.uniqifyList">[docs]</a>    <span class="k">def</span> <span class="nf">uniqifyList</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">multilist</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">OrderedDict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">multilist</span><span class="p">)</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</div>
<div class="viewcode-block" id="dbTool.onSeekAndDestroySelector"><a class="viewcode-back" href="../../../Tools.dbTools.html#Tools.dbTools.dbTool.dbTool.onSeekAndDestroySelector">[docs]</a>    <span class="k">def</span> <span class="nf">onSeekAndDestroySelector</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">onSeekAndDestroyGewenst</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">selector</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">selectedSelector</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="dbTool.onSeekAndDestroyGewenst"><a class="viewcode-back" href="../../../Tools.dbTools.html#Tools.dbTools.dbTool.dbTool.onSeekAndDestroyGewenst">[docs]</a>    <span class="k">def</span> <span class="nf">onSeekAndDestroyGewenst</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">act</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">selector</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">destroylist</span> <span class="o">=</span> <span class="p">[(</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">)]</span> <span class="c"># fill this one up at the end with XMLfiles</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">qctext</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qctext</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

        <span class="n">QtGui</span><span class="o">.</span><span class="n">QApplication</span><span class="o">.</span><span class="n">setOverrideCursor</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QCursor</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">WaitCursor</span><span class="p">))</span>
        <span class="c">###1 open db iqc</span>
        <span class="n">con</span><span class="p">,</span><span class="n">cur</span><span class="p">,</span><span class="n">dbversion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectdb</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="p">)</span>

        <span class="sd">&quot;&quot;&quot; Plan: Remove all traces from iqc, afterward remove xml files; data in dcm4che should stay intact, so rebuild should happen</span>
<span class="sd">        affected tables:</span>
<span class="sd">            01. analysemodule_input: /opt/XML/analysemodule_input/*.xml files for removal</span>
<span class="sd">            01. analysemodule_output: /opt/XML/analysemodule_input/&lt;Selector Name&gt; for removal</span>
<span class="sd">            2. collector_series_status: gekoppeld met series via series_fk</span>
<span class="sd">            3. collector_study_status: gekoppeld met study via study_fk</span>
<span class="sd">            4. files: gekoppeld met instance via instance_fk</span>
<span class="sd">            01. gewenste_processen: gekoppeld met selector/study/series/instance/analysemodule_input/analysemodule_output via xxx_fk</span>
<span class="sd">            01. instance: gekoppeld met series via series_fk</span>
<span class="sd">            3. patient</span>
<span class="sd">            01. series: gekoppeld met study via study_fk, heeft station_name</span>
<span class="sd">            01. study: gekoppeld met patient via patient_fk</span>
<span class="sd">            6. resultaten_boolean: gekoppeld aan gewenste_processen via gewenste_processen_fk</span>
<span class="sd">            6. resultaten_char: gekoppeld aan gewenste_processen via gewenste_processen_fk</span>
<span class="sd">            6. resultaten_floating: gekoppeld aan gewenste_processen via gewenste_processen_fk</span>
<span class="sd">            6. resultaten_object: gekoppeld aan gewenste_processen via gewenste_processen_fk</span>
<span class="sd">            6. resultaten_status: gekoppeld aan gewenste_processen via gewenste_processen_fk</span>
<span class="sd">        needs for xml:</span>
<span class="sd">            Selector Name</span>

<span class="sd">        FlowChart:</span>
<span class="sd">            01. Maak lijsten Processen, Series, Studies, Instances, AnalyseInput, AnalyseOutput uit &#39;gewenste_processen&#39;</span>
<span class="sd">            02. Als instance, controlleer dan of alle instances uit serie weg, zo ja dan ook serie weg</span>
<span class="sd">            02. Als series, controlleer dan of alle series uit study weg, zo ja dan ook study weg</span>
<span class="sd">            02. Als study, controlleer dan of alle studies uit patient weg, zo ja dan ook patient weg</span>
<span class="sd">            03. Van boven naar beneden lijsten completeren: Pat-&gt;stud-&gt;series-&gt;instances-&gt;files</span>
<span class="sd">            04. Dan toevoegen van alles dat indirect uit Studies,Series,Processen volgt</span>
<span class="sd">            05. list of xml files /dirs to remove</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># 01. Maak lijsten Processen, Series, Studies, Instances, AnalyseInput, AnalyseOutput uit &#39;gewenste_processen&#39;</span>
        <span class="n">daProcessen</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">daInput</span>     <span class="o">=</span> <span class="p">[]</span>
        <span class="n">daOutput</span>    <span class="o">=</span> <span class="p">[]</span>
        <span class="n">daInstances</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">daSeries</span>    <span class="o">=</span> <span class="p">[]</span>
        <span class="n">daStudies</span>   <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">selector</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;SELECT * FROM </span><span class="si">%s</span><span class="s"> where pk=</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_gewenste_processen</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">selectedGewenst</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;SELECT * FROM </span><span class="si">%s</span><span class="s"> where selector_fk=</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_gewenste_processen</span><span class="p">,</span><span class="n">selector</span><span class="p">))</span>
            
        <span class="n">rows_processen</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="n">checklist</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="s">&#39;pk&#39;</span><span class="p">,</span>                     <span class="n">daProcessen</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">table_gewenste_processen</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;study_fk&#39;</span><span class="p">,</span>               <span class="n">daStudies</span><span class="p">,</span>  <span class="bp">self</span><span class="o">.</span><span class="n">table_studies</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;series_fk&#39;</span><span class="p">,</span>              <span class="n">daSeries</span><span class="p">,</span>   <span class="bp">self</span><span class="o">.</span><span class="n">table_series</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;instance_fk&#39;</span><span class="p">,</span>            <span class="n">daInstances</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">table_instances</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;analysemodule_input_fk&#39;</span><span class="p">,</span> <span class="n">daInput</span><span class="p">,</span>    <span class="bp">self</span><span class="o">.</span><span class="n">table_analyseinput</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;analysemodule_output_fk&#39;</span><span class="p">,</span><span class="n">daOutput</span><span class="p">,</span>   <span class="bp">self</span><span class="o">.</span><span class="n">table_analyseoutput</span><span class="p">),</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows_processen</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">lis</span><span class="p">,</span><span class="n">tab</span> <span class="ow">in</span> <span class="n">checklist</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
                    <span class="n">lis</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
        <span class="n">daProcessen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uniqifyList</span><span class="p">(</span><span class="n">daProcessen</span><span class="p">)</span>
        <span class="n">daStudies</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uniqifyList</span><span class="p">(</span><span class="n">daStudies</span><span class="p">)</span>
        <span class="n">daSeries</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uniqifyList</span><span class="p">(</span><span class="n">daSeries</span><span class="p">)</span>
        <span class="n">daInstances</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uniqifyList</span><span class="p">(</span><span class="n">daInstances</span><span class="p">)</span>
        <span class="n">daInput</span>     <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uniqifyList</span><span class="p">(</span><span class="n">daInput</span><span class="p">)</span>
        <span class="n">daOutput</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uniqifyList</span><span class="p">(</span><span class="n">daOutput</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">lis</span><span class="p">,</span><span class="n">tab</span> <span class="ow">in</span> <span class="n">checklist</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">selector</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">feedback</span>  <span class="o">=</span> <span class="s">&quot;1. Found </span><span class="si">%d</span><span class="s"> entries in </span><span class="si">%s</span><span class="s"> for </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lis</span><span class="p">),</span><span class="n">tab</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">selectedGewenst</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">feedback</span>  <span class="o">=</span> <span class="s">&quot;1. Found </span><span class="si">%d</span><span class="s"> entries in </span><span class="si">%s</span><span class="s"> for </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lis</span><span class="p">),</span><span class="n">tab</span><span class="p">,</span><span class="n">selector</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">qctext</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">qctext</span><span class="o">.</span><span class="n">appendPlainText</span><span class="p">(</span><span class="n">feedback</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">print</span> <span class="n">feedback</span>

        <span class="c"># 2. Als instance, controlleer dan of alle instances uit serie weg, zo ja dan ook serie weg</span>
        <span class="c"># 2. Als series, controlleer dan of alle series uit study weg, zo ja dan ook study weg</span>
        <span class="c"># 2. Als study, controlleer dan of alle studies uit patient weg, zo ja dan ook patient weg</span>
        <span class="n">daPatients</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">checklist</span> <span class="o">=</span> <span class="p">[</span>
            <span class="c">#(tabel_laagnivo, lijst_laagnivo, key_hoognivo, lijst_hoognivo</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_instances</span><span class="p">,</span> <span class="n">daInstances</span><span class="p">,</span> <span class="s">&#39;series_fk&#39;</span><span class="p">,</span>  <span class="n">daSeries</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_series</span><span class="p">,</span>    <span class="n">daSeries</span><span class="p">,</span>    <span class="s">&#39;study_fk&#39;</span><span class="p">,</span>   <span class="n">daStudies</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_studies</span><span class="p">,</span>   <span class="n">daStudies</span><span class="p">,</span>   <span class="s">&#39;patient_fk&#39;</span><span class="p">,</span> <span class="n">daPatients</span><span class="p">),</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">tab_lo</span><span class="p">,</span><span class="n">list_lo</span><span class="p">,</span> <span class="n">key_hi</span><span class="p">,</span><span class="n">list_hi</span> <span class="ow">in</span> <span class="n">checklist</span><span class="p">:</span>
            <span class="n">high_lows</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;SELECT * FROM </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span><span class="n">tab_lo</span><span class="p">)</span>
            <span class="n">rows_processen</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows_processen</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;pk&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">list_lo</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="n">key_hi</span><span class="p">]:</span>
                        <span class="n">high_lows</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="n">key_hi</span><span class="p">]]</span><span class="o">=</span><span class="p">[</span> <span class="p">]</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows_processen</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="n">key_hi</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="n">key_hi</span><span class="p">]</span> <span class="ow">in</span> <span class="n">high_lows</span><span class="p">:</span>
                        <span class="n">high_lows</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="n">key_hi</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;pk&#39;</span><span class="p">])</span>

            <span class="k">for</span> <span class="n">hi</span><span class="p">,</span><span class="n">los</span> <span class="ow">in</span> <span class="n">high_lows</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="n">numdel</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">lo</span> <span class="ow">in</span> <span class="n">los</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">lo</span> <span class="ow">in</span> <span class="n">list_lo</span><span class="p">:</span>
                        <span class="n">numdel</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">print</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s"> sub </span><span class="si">%d</span><span class="s"> of </span><span class="si">%d</span><span class="s"> in </span><span class="si">%s</span><span class="s"> is not scheduled for delete!&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">key_hi</span><span class="p">,</span><span class="n">lo</span><span class="p">,</span><span class="n">hi</span><span class="p">,</span><span class="n">tab_lo</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">numdel</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">los</span><span class="p">):</span>
                    <span class="n">list_hi</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hi</span><span class="p">)</span>
        <span class="n">daPatients</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uniqifyList</span><span class="p">(</span><span class="n">daPatients</span><span class="p">)</span>
        <span class="n">daStudies</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uniqifyList</span><span class="p">(</span><span class="n">daStudies</span><span class="p">)</span>
        <span class="n">daSeries</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uniqifyList</span><span class="p">(</span><span class="n">daSeries</span><span class="p">)</span>
        <span class="n">feedback</span>  <span class="o">=</span> <span class="s">&quot;2. Selected </span><span class="si">%d</span><span class="s"> Patients&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">daPatients</span><span class="p">)</span>
        <span class="n">feedback</span>  <span class="o">+=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">2. Selected </span><span class="si">%d</span><span class="s"> Studies&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">daStudies</span><span class="p">)</span>
        <span class="n">feedback</span>  <span class="o">+=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">2. Selected </span><span class="si">%d</span><span class="s"> Series&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">daSeries</span><span class="p">)</span>
        <span class="n">feedback</span>  <span class="o">+=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">2. Selected </span><span class="si">%d</span><span class="s"> Instances&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">daInstances</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">qctext</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qctext</span><span class="o">.</span><span class="n">appendPlainText</span><span class="p">(</span><span class="n">feedback</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">feedback</span>

        <span class="c"># 3. Van boven naar beneden lijsten completeren: Pat-&gt;stud-&gt;series-&gt;instances-&gt;files</span>
        <span class="c"># 4. Dan toevoegen van alles dat indirect uit Studies,Series,Processen volgt</span>
        <span class="n">daFiles</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">daCollectorStudyStatus</span>  <span class="o">=</span> <span class="p">[]</span>
        <span class="n">daCollectorSeriesStatus</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">daBools</span>  <span class="o">=</span> <span class="p">[]</span>
        <span class="n">daChars</span>  <span class="o">=</span> <span class="p">[]</span>
        <span class="n">daFloats</span>  <span class="o">=</span> <span class="p">[]</span>
        <span class="n">daObjects</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">daStats</span>   <span class="o">=</span> <span class="p">[]</span>
        <span class="n">checklist</span> <span class="o">=</span> <span class="p">[</span>
            <span class="c">#(tabel_laagnivo, lijst_laagnivo, key_hoognivo, lijst_hoognivo</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_studies</span><span class="p">,</span>   <span class="n">daStudies</span><span class="p">,</span>   <span class="s">&#39;patient_fk&#39;</span><span class="p">,</span>  <span class="n">daPatients</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_series</span><span class="p">,</span>    <span class="n">daSeries</span><span class="p">,</span>    <span class="s">&#39;study_fk&#39;</span><span class="p">,</span>    <span class="n">daStudies</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_instances</span><span class="p">,</span> <span class="n">daInstances</span><span class="p">,</span> <span class="s">&#39;series_fk&#39;</span><span class="p">,</span>   <span class="n">daSeries</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_files</span><span class="p">,</span>     <span class="n">daFiles</span><span class="p">,</span>     <span class="s">&#39;instance_fk&#39;</span><span class="p">,</span> <span class="n">daInstances</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_collectorstatusstudies</span><span class="p">,</span> <span class="n">daCollectorStudyStatus</span><span class="p">,</span>    <span class="s">&#39;study_fk&#39;</span><span class="p">,</span>  <span class="n">daStudies</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_collectorstatusseries</span><span class="p">,</span>  <span class="n">daCollectorSeriesStatus</span><span class="p">,</span>   <span class="s">&#39;series_fk&#39;</span><span class="p">,</span> <span class="n">daSeries</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_bool</span><span class="p">,</span>   <span class="n">daBools</span><span class="p">,</span> <span class="s">&#39;gewenste_processen_fk&#39;</span><span class="p">,</span> <span class="n">daProcessen</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_char</span><span class="p">,</span>   <span class="n">daChars</span><span class="p">,</span> <span class="s">&#39;gewenste_processen_fk&#39;</span><span class="p">,</span> <span class="n">daProcessen</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_float</span><span class="p">,</span>  <span class="n">daFloats</span><span class="p">,</span> <span class="s">&#39;gewenste_processen_fk&#39;</span><span class="p">,</span> <span class="n">daProcessen</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_object</span><span class="p">,</span> <span class="n">daObjects</span><span class="p">,</span> <span class="s">&#39;gewenste_processen_fk&#39;</span><span class="p">,</span> <span class="n">daProcessen</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_status</span><span class="p">,</span> <span class="n">daStats</span><span class="p">,</span> <span class="s">&#39;gewenste_processen_fk&#39;</span><span class="p">,</span> <span class="n">daProcessen</span><span class="p">),</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">tab_lo</span><span class="p">,</span> <span class="n">list_lo</span><span class="p">,</span> <span class="n">key_hi</span><span class="p">,</span><span class="n">list_hi</span> <span class="ow">in</span> <span class="n">checklist</span><span class="p">:</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;SELECT * FROM </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span><span class="n">tab_lo</span><span class="p">)</span>
            <span class="n">rows_processen</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows_processen</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="n">key_hi</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="n">key_hi</span><span class="p">]</span> <span class="ow">in</span> <span class="n">list_hi</span><span class="p">:</span>
                        <span class="n">list_lo</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;pk&#39;</span><span class="p">])</span>
        <span class="n">daPatients</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uniqifyList</span><span class="p">(</span><span class="n">daPatients</span><span class="p">)</span>
        <span class="n">daStudies</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uniqifyList</span><span class="p">(</span><span class="n">daStudies</span><span class="p">)</span>
        <span class="n">daSeries</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uniqifyList</span><span class="p">(</span><span class="n">daSeries</span><span class="p">)</span>
        <span class="n">daInstances</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uniqifyList</span><span class="p">(</span><span class="n">daInstances</span><span class="p">)</span>
        <span class="n">daFiles</span>     <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uniqifyList</span><span class="p">(</span><span class="n">daFiles</span><span class="p">)</span>
        <span class="n">daCollectorStudyStatus</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uniqifyList</span><span class="p">(</span><span class="n">daCollectorStudyStatus</span><span class="p">)</span>
        <span class="n">daCollectorSeriesStatus</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uniqifyList</span><span class="p">(</span><span class="n">daCollectorSeriesStatus</span><span class="p">)</span>
        <span class="n">daBools</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uniqifyList</span><span class="p">(</span><span class="n">daBools</span><span class="p">)</span>
        <span class="n">daChars</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uniqifyList</span><span class="p">(</span><span class="n">daChars</span><span class="p">)</span>
        <span class="n">daFloats</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uniqifyList</span><span class="p">(</span><span class="n">daFloats</span><span class="p">)</span>
        <span class="n">daObjects</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uniqifyList</span><span class="p">(</span><span class="n">daObjects</span><span class="p">)</span>
        <span class="n">daStats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uniqifyList</span><span class="p">(</span><span class="n">daStats</span><span class="p">)</span>
        <span class="n">feedback</span>  <span class="o">=</span> <span class="s">&quot;3. Corrected to </span><span class="si">%d</span><span class="s"> Patients&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">daPatients</span><span class="p">)</span>
        <span class="n">feedback</span>  <span class="o">+=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">3. Corrected to </span><span class="si">%d</span><span class="s"> Studies&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">daStudies</span><span class="p">)</span>
        <span class="n">feedback</span>  <span class="o">+=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">3. Corrected to </span><span class="si">%d</span><span class="s"> Series&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">daSeries</span><span class="p">)</span>
        <span class="n">feedback</span>  <span class="o">+=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">3. Corrected to </span><span class="si">%d</span><span class="s"> Instances&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">daInstances</span><span class="p">)</span>
        <span class="n">feedback</span>  <span class="o">+=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">3. Selected </span><span class="si">%d</span><span class="s"> Files&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">daFiles</span><span class="p">)</span>
        <span class="n">feedback</span>  <span class="o">+=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">3. Selected </span><span class="si">%d</span><span class="s"> CollectorStudyStatus&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">daCollectorStudyStatus</span><span class="p">)</span>
        <span class="n">feedback</span>  <span class="o">+=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">3. Selected </span><span class="si">%d</span><span class="s"> CollectorSeriesStatus&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">daCollectorSeriesStatus</span><span class="p">)</span>
        <span class="n">feedback</span>  <span class="o">+=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">3. Selected </span><span class="si">%d</span><span class="s"> Bools&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">daBools</span><span class="p">)</span>
        <span class="n">feedback</span>  <span class="o">+=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">3. Selected </span><span class="si">%d</span><span class="s"> Chars&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">daChars</span><span class="p">)</span>
        <span class="n">feedback</span>  <span class="o">+=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">3. Selected </span><span class="si">%d</span><span class="s"> Floats&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">daFloats</span><span class="p">)</span>
        <span class="n">feedback</span>  <span class="o">+=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">3. Selected </span><span class="si">%d</span><span class="s"> Objects&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">daObjects</span><span class="p">)</span>
        <span class="n">feedback</span>  <span class="o">+=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">3. Selected </span><span class="si">%d</span><span class="s"> Status&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">daStats</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">qctext</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qctext</span><span class="o">.</span><span class="n">appendPlainText</span><span class="p">(</span><span class="n">feedback</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">feedback</span>

        <span class="c"># 5. list of xml files /dirs to remove</span>
        <span class="n">daXML</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;SELECT * FROM </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">table_analyseinput</span><span class="p">)</span>
        <span class="n">rows_processen</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows_processen</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;pk&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">daInput</span><span class="p">:</span>
                <span class="n">daXML</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s%s</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;filepath&#39;</span><span class="p">],</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;filename&#39;</span><span class="p">]))</span>
        <span class="n">feedback</span> <span class="o">=</span> <span class="s">&quot;4. Found </span><span class="si">%d</span><span class="s">/</span><span class="si">%d</span><span class="s"> </span><span class="si">%s</span><span class="s"> for </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">daXML</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">rows_processen</span><span class="p">),</span><span class="s">&quot;inputXMLs&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">selectedStation</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">qctext</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qctext</span><span class="o">.</span><span class="n">appendPlainText</span><span class="p">(</span><span class="n">feedback</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">feedback</span>

        <span class="n">len0</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">daXML</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;SELECT * FROM </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">table_analyseoutput</span><span class="p">)</span>
        <span class="n">rows_processen</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows_processen</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;pk&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">daOutput</span><span class="p">:</span>
                <span class="n">daXML</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s%s</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;filepath&#39;</span><span class="p">],</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;filename&#39;</span><span class="p">])))</span>
        <span class="n">feedback</span> <span class="o">=</span> <span class="s">&quot;4. Found </span><span class="si">%d</span><span class="s">/</span><span class="si">%d</span><span class="s"> </span><span class="si">%s</span><span class="s"> for </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">daXML</span><span class="p">)</span><span class="o">-</span><span class="n">len0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">rows_processen</span><span class="p">),</span><span class="s">&quot;outputXMLs&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">selectedStation</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">qctext</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qctext</span><span class="o">.</span><span class="n">appendPlainText</span><span class="p">(</span><span class="n">feedback</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">feedback</span>

        <span class="c"># Make destroylist</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">destroylist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">destroylist</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="bp">None</span><span class="p">,</span><span class="n">daXML</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">destroylist</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">table_patient</span><span class="p">,</span><span class="n">daPatients</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">destroylist</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">table_studies</span><span class="p">,</span><span class="n">daStudies</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">destroylist</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">table_series</span><span class="p">,</span><span class="n">daSeries</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">destroylist</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">table_instances</span><span class="p">,</span><span class="n">daInstances</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">destroylist</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">table_files</span><span class="p">,</span><span class="n">daFiles</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">destroylist</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">table_collectorstatusstudies</span><span class="p">,</span><span class="n">daCollectorStudyStatus</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">destroylist</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">table_collectorstatusseries</span><span class="p">,</span><span class="n">daCollectorSeriesStatus</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">destroylist</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">table_bool</span><span class="p">,</span><span class="n">daBools</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">destroylist</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">table_char</span><span class="p">,</span><span class="n">daChars</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">destroylist</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">table_float</span><span class="p">,</span><span class="n">daFloats</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">destroylist</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">table_object</span><span class="p">,</span><span class="n">daObjects</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">destroylist</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">table_status</span><span class="p">,</span><span class="n">daStats</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">destroylist</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">table_gewenste_processen</span><span class="p">,</span><span class="n">daProcessen</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">destroylist</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">table_analyseinput</span><span class="p">,</span><span class="n">daInput</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">destroylist</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">table_analyseoutput</span><span class="p">,</span><span class="n">daOutput</span><span class="p">))</span>

        <span class="c">### close db</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">closedb</span><span class="p">(</span><span class="n">con</span><span class="p">)</span>
        <span class="n">QtGui</span><span class="o">.</span><span class="n">QApplication</span><span class="o">.</span><span class="n">restoreOverrideCursor</span><span class="p">()</span>

        <span class="k">return</span>

</div>
<div class="viewcode-block" id="dbTool.onSeekAndDestroyStation"><a class="viewcode-back" href="../../../Tools.dbTools.html#Tools.dbTools.dbTool.dbTool.onSeekAndDestroyStation">[docs]</a>    <span class="k">def</span> <span class="nf">onSeekAndDestroyStation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">act</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s">&#39;StationName&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">destroylist</span> <span class="o">=</span> <span class="p">[(</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">)]</span> <span class="c"># fill this one up at the end with XMLfiles</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">qctext</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qctext</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

        <span class="n">QtGui</span><span class="o">.</span><span class="n">QApplication</span><span class="o">.</span><span class="n">setOverrideCursor</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QCursor</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">WaitCursor</span><span class="p">))</span>
        <span class="c">###1 open db iqc</span>
        <span class="n">con</span><span class="p">,</span><span class="n">cur</span><span class="p">,</span><span class="n">dbversion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectdb</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="p">)</span>

        <span class="sd">&quot;&quot;&quot; Plan: Remove all traces from iqc, afterward remove xml files; data in dcm4che should stay intact, so rebuild should happen</span>
<span class="sd">        affected tables:</span>
<span class="sd">            5. analysemodule_input: /opt/XML/analysemodule_input/*.xml files for removal</span>
<span class="sd">            5. analysemodule_output: /opt/XML/analysemodule_input/&lt;Selector Name&gt; for removal</span>
<span class="sd">            2. collector_series_status: gekoppeld met series via series_fk</span>
<span class="sd">            3. collector_study_status: gekoppeld met study via study_fk</span>
<span class="sd">            4. files: gekoppeld met instance via instance_fk</span>
<span class="sd">            5. gewenste_processen: gekoppeld met selector/study/series/instance/analysemodule_input/analysemodule_output via xxx_fk</span>
<span class="sd">            2. instance: gekoppeld met series via series_fk</span>
<span class="sd">            3. patient</span>
<span class="sd">            1. series: gekoppeld met study via study_fk, heeft station_name</span>
<span class="sd">            1. study: gekoppeld met patient via patient_fk</span>
<span class="sd">            6. resultaten_boolean: gekoppeld aan gewenste_processen via gewenste_processen_fk</span>
<span class="sd">            6. resultaten_char: gekoppeld aan gewenste_processen via gewenste_processen_fk</span>
<span class="sd">            6. resultaten_floating: gekoppeld aan gewenste_processen via gewenste_processen_fk</span>
<span class="sd">            6. resultaten_object: gekoppeld aan gewenste_processen via gewenste_processen_fk</span>
<span class="sd">            6. resultaten_status: gekoppeld aan gewenste_processen via gewenste_processen_fk</span>
<span class="sd">        needs for xml:</span>
<span class="sd">            Selector Name</span>

<span class="sd">        FlowChart:</span>
<span class="sd">            1. Maak lijst &#39;Series&#39; en &#39;Studies&#39; uit series met juiste station_name</span>
<span class="sd">            2. Gebruik &#39;Series&#39;: voor lijst &#39;Instances&#39; uit instance en &#39;Collector_series_status&#39; uit collector_series_status</span>
<span class="sd">            3. Gebruik &#39;Studies&#39;: voor lijst &#39;Patients&#39; uit patient en &#39;Collector_study_status&#39; uit collector_study_status</span>
<span class="sd">            4. Gebruik &#39;Instances&#39;: voor lijst &#39;Files&#39; uit files</span>
<span class="sd">            5. Gebruik &#39;Series&#39; en &#39;Studies&#39; en &#39;Instances&#39;: voor lijsten &#39;Gewenste_processen&#39; en &#39;Analysemodule_input&#39;,&#39;Analysemodule_output&#39; uitgewenste_processen</span>
<span class="sd">            6. Gebruik &#39;Gewenste_processen&#39;: voor lijsten &#39;Resultaten_boolean&#39;,&#39;Resultaten_char&#39;,&#39;Resultaten_floating&#39;,&#39;Resultaten_object&#39; uit</span>
<span class="sd">            7.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># 1: Maak lijst &#39;Series&#39; en &#39;Studies&#39; uit series met juiste station_name</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s">&#39;StationName&#39;</span><span class="p">:</span> <span class="c"># station_name Mode</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedStation</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">stNone</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;SELECT * FROM </span><span class="si">%s</span><span class="s"> WHERE station_name IS NULL&quot;</span> <span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">table_series</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;SELECT * FROM </span><span class="si">%s</span><span class="s"> WHERE station_name=&#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_series</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">selectedStation</span><span class="p">))</span>
            <span class="n">rows_processen</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
            <span class="n">thisthing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedStation</span>
        <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s">&#39;Modality&#39;</span><span class="p">:</span> <span class="c">#modality mode</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedModality</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">stNone</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;SELECT * FROM </span><span class="si">%s</span><span class="s"> WHERE modality IS NULL&quot;</span> <span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">table_series</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;SELECT * FROM </span><span class="si">%s</span><span class="s"> WHERE modality=&#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_series</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">selectedModality</span><span class="p">))</span>
            <span class="n">rows_processen</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
            <span class="n">thisthing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedModality</span>
        <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s">&#39;SrcAET&#39;</span><span class="p">:</span> <span class="c">#modality mode</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedAET</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">stNone</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;SELECT * FROM </span><span class="si">%s</span><span class="s"> WHERE src_aet IS NULL&quot;</span> <span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">table_series</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;SELECT * FROM </span><span class="si">%s</span><span class="s"> WHERE src_aet=&#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_series</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">selectedAET</span><span class="p">))</span>
            <span class="n">rows_processen</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
            <span class="n">thisthing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedAET</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">feedback</span> <span class="o">=</span> <span class="s">&quot;Unknown mode </span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="n">mode</span>
                
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">qctext</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">qctext</span><span class="o">.</span><span class="n">appendPlainText</span><span class="p">(</span><span class="n">feedback</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">print</span> <span class="n">feedback</span>
            <span class="k">return</span>
        
        <span class="n">thisthing</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">=</span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span><span class="n">thisthing</span><span class="p">)</span>    
        <span class="n">feedback</span> <span class="o">=</span> <span class="s">&quot;Found </span><span class="si">%d</span><span class="s"> rows in </span><span class="si">%s</span><span class="s"> for </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rows_processen</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">table_series</span><span class="p">,</span><span class="n">thisthing</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">qctext</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qctext</span><span class="o">.</span><span class="n">appendPlainText</span><span class="p">(</span><span class="n">feedback</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">feedback</span>

        <span class="n">daSeries</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">daStudies</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows_processen</span><span class="p">:</span>
            <span class="n">daSeries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;pk&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;study_fk&#39;</span><span class="p">]:</span>
                <span class="n">daStudies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;study_fk&#39;</span><span class="p">])</span>
        <span class="n">daSeries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uniqifyList</span><span class="p">(</span><span class="n">daSeries</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">destroylist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_series</span><span class="p">,</span><span class="n">daSeries</span><span class="p">)</span> <span class="p">)</span>
        <span class="n">feedback</span> <span class="o">=</span> <span class="s">&quot;1. Found </span><span class="si">%d</span><span class="s"> series for </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">daSeries</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">selectedStation</span><span class="p">)</span>
        <span class="n">feedback</span> <span class="o">+=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">1. Found </span><span class="si">%d</span><span class="s">/</span><span class="si">%d</span><span class="s"> studies for </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">daStudies</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">rows_processen</span><span class="p">),</span><span class="n">thisthing</span><span class="p">)</span>

        <span class="c">#selecteer voor delete alleen studies, die geen series meer hebben na delete series</span>
        <span class="n">studseries</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;SELECT * FROM </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">table_series</span><span class="p">)</span>
        <span class="n">rows_processen</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows_processen</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;study_fk&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;study_fk&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">daStudies</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;study_fk&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">studseries</span><span class="p">:</span>
                        <span class="n">studseries</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;study_fk&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;pk&#39;</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">studseries</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;study_fk&#39;</span><span class="p">]]</span><span class="o">=</span><span class="p">[</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;pk&#39;</span><span class="p">]</span> <span class="p">]</span>

        <span class="n">daStudies</span> <span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">stud</span><span class="p">,</span><span class="n">sers</span> <span class="ow">in</span> <span class="n">studseries</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">numdel</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">ser</span> <span class="ow">in</span> <span class="n">sers</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">ser</span> <span class="ow">in</span> <span class="n">daSeries</span><span class="p">:</span>
                    <span class="n">numdel</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">print</span> <span class="s">&quot;Series </span><span class="si">%d</span><span class="s"> of study </span><span class="si">%d</span><span class="s"> is not scheduled for delete!&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ser</span><span class="p">,</span><span class="n">stud</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">numdel</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">sers</span><span class="p">):</span>
                <span class="n">daStudies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stud</span><span class="p">)</span>

        <span class="n">daStudies</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uniqifyList</span><span class="p">(</span><span class="n">daStudies</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">destroylist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_studies</span><span class="p">,</span><span class="n">daStudies</span><span class="p">)</span> <span class="p">)</span>
        <span class="n">feedback</span> <span class="o">+=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">1. Corrected to </span><span class="si">%d</span><span class="s"> studies only for </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">daStudies</span><span class="p">),</span><span class="n">thisthing</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">qctext</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qctext</span><span class="o">.</span><span class="n">appendPlainText</span><span class="p">(</span><span class="n">feedback</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">feedback</span>

        <span class="c"># 2. Gebruik &#39;Series&#39;: voor lijst &#39;Instances&#39; uit instance en &#39;Collector_series_status&#39; uit collector_series_status</span>
        <span class="n">daInstances</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;SELECT * FROM </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">table_instances</span><span class="p">)</span>
        <span class="n">rows_processen</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows_processen</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;series_fk&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;series_fk&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">daSeries</span><span class="p">:</span>
                    <span class="n">daInstances</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;pk&#39;</span><span class="p">])</span>
        <span class="n">daInstances</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uniqifyList</span><span class="p">(</span><span class="n">daInstances</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">destroylist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_instances</span><span class="p">,</span><span class="n">daInstances</span><span class="p">)</span> <span class="p">)</span>
        <span class="n">feedback</span><span class="o">=</span> <span class="s">&quot;2. Found </span><span class="si">%d</span><span class="s">/</span><span class="si">%d</span><span class="s"> instances for </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">daInstances</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">rows_processen</span><span class="p">),</span><span class="n">thisthing</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">qctext</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qctext</span><span class="o">.</span><span class="n">appendPlainText</span><span class="p">(</span><span class="n">feedback</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">feedback</span>

        <span class="n">daCollectorSeriesStatus</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;SELECT * FROM </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">table_collectorstatusseries</span><span class="p">)</span>
        <span class="n">rows_processen</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows_processen</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;series_fk&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;series_fk&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">daSeries</span><span class="p">:</span>
                    <span class="n">daCollectorSeriesStatus</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;pk&#39;</span><span class="p">])</span>
        <span class="n">daCollectorSeriesStatus</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uniqifyList</span><span class="p">(</span><span class="n">daCollectorSeriesStatus</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">destroylist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_collectorstatusseries</span><span class="p">,</span><span class="n">daCollectorSeriesStatus</span><span class="p">)</span> <span class="p">)</span>
        <span class="n">feedback</span> <span class="o">=</span> <span class="s">&quot;2. Found </span><span class="si">%d</span><span class="s">/</span><span class="si">%d</span><span class="s"> collectorstatusseries for </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">daCollectorSeriesStatus</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">rows_processen</span><span class="p">),</span><span class="n">thisthing</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">qctext</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qctext</span><span class="o">.</span><span class="n">appendPlainText</span><span class="p">(</span><span class="n">feedback</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">feedback</span>

        <span class="c"># 3. Gebruik &#39;Studies&#39;: voor lijst &#39;Patients&#39; uit patient en &#39;Collector_study_status&#39; uit collector_study_status</span>
        <span class="n">daPatients</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;SELECT * FROM </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">table_studies</span><span class="p">)</span>
        <span class="n">rows_processen</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows_processen</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;patient_fk&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;pk&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">daStudies</span><span class="p">:</span>
                    <span class="n">daPatients</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;patient_fk&#39;</span><span class="p">])</span>
        <span class="n">daPatients</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uniqifyList</span><span class="p">(</span><span class="n">daPatients</span><span class="p">)</span>
        <span class="n">feedback</span> <span class="o">=</span> <span class="s">&quot;3. Found </span><span class="si">%d</span><span class="s">/</span><span class="si">%d</span><span class="s"> patients for </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">daPatients</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">rows_processen</span><span class="p">),</span><span class="n">thisthing</span><span class="p">)</span>

        <span class="c">#selecteer voor delete alleen patients, die geen studies meer hebben na delete studies</span>
        <span class="n">patstuds</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows_processen</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;patient_fk&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;patient_fk&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">daPatients</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;patient_fk&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">patstuds</span><span class="p">:</span>
                        <span class="n">patstuds</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;patient_fk&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;pk&#39;</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">patstuds</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;patient_fk&#39;</span><span class="p">]]</span><span class="o">=</span><span class="p">[</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;pk&#39;</span><span class="p">]</span> <span class="p">]</span>

        <span class="n">daPatients</span> <span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">pat</span><span class="p">,</span><span class="n">studs</span> <span class="ow">in</span> <span class="n">patstuds</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">numdel</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">stud</span> <span class="ow">in</span> <span class="n">studs</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">stud</span> <span class="ow">in</span> <span class="n">daStudies</span><span class="p">:</span>
                    <span class="n">numdel</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">numdel</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">studs</span><span class="p">):</span>
                <span class="n">daPatients</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pat</span><span class="p">)</span>

        <span class="n">feedback</span> <span class="o">+=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">3. Corrected to </span><span class="si">%d</span><span class="s"> patients for only </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">daPatients</span><span class="p">),</span><span class="n">thisthing</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">destroylist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_patient</span><span class="p">,</span><span class="n">daPatients</span><span class="p">)</span> <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">qctext</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qctext</span><span class="o">.</span><span class="n">appendPlainText</span><span class="p">(</span><span class="n">feedback</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">feedback</span>

        <span class="n">daCollectorStudyStatus</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;SELECT * FROM </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">table_collectorstatusstudies</span><span class="p">)</span>
        <span class="n">rows_processen</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows_processen</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;study_fk&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;study_fk&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">daStudies</span><span class="p">:</span>
                    <span class="n">daCollectorStudyStatus</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;pk&#39;</span><span class="p">])</span>
        <span class="n">daCollectorStudyStatus</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uniqifyList</span><span class="p">(</span><span class="n">daCollectorStudyStatus</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">destroylist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_collectorstatusstudies</span><span class="p">,</span><span class="n">daCollectorStudyStatus</span><span class="p">)</span> <span class="p">)</span>
        <span class="n">feedback</span> <span class="o">=</span> <span class="s">&quot;3. Found </span><span class="si">%d</span><span class="s">/</span><span class="si">%d</span><span class="s"> collectorstatusstudies for </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">daCollectorStudyStatus</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">rows_processen</span><span class="p">),</span><span class="n">thisthing</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">qctext</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qctext</span><span class="o">.</span><span class="n">appendPlainText</span><span class="p">(</span><span class="n">feedback</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">feedback</span>

        <span class="c"># 4. Gebruik &#39;Instances&#39;: voor lijst &#39;Files&#39; uit files</span>
        <span class="n">daFiles</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;SELECT * FROM </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">table_files</span><span class="p">)</span>
        <span class="n">rows_processen</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows_processen</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;instance_fk&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;instance_fk&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">daInstances</span><span class="p">:</span>
                    <span class="n">daFiles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;pk&#39;</span><span class="p">])</span>
        <span class="n">daFiles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uniqifyList</span><span class="p">(</span><span class="n">daFiles</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">destroylist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_files</span><span class="p">,</span><span class="n">daFiles</span><span class="p">)</span> <span class="p">)</span>
        <span class="n">feedback</span> <span class="o">=</span> <span class="s">&quot;4. Found </span><span class="si">%d</span><span class="s">/</span><span class="si">%d</span><span class="s"> files for </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">daFiles</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">rows_processen</span><span class="p">),</span><span class="n">thisthing</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">qctext</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qctext</span><span class="o">.</span><span class="n">appendPlainText</span><span class="p">(</span><span class="n">feedback</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">feedback</span>

        <span class="c"># 5. Gebruik &#39;Series&#39; en &#39;Studies&#39; en &#39;Instances&#39;: voor lijsten &#39;Gewenste_processen&#39; en &#39;Analysemodule_input&#39;,&#39;Analysemodule_output&#39; uitgewenste_processen</span>
        <span class="n">daProcessen</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">daInput</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">daOutput</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;SELECT * FROM </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">table_gewenste_processen</span><span class="p">)</span>
        <span class="n">rows_processen</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows_processen</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;instance_fk&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;instance_fk&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">daInstances</span><span class="p">:</span>
                    <span class="n">daProcessen</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;pk&#39;</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;analysemodule_input_fk&#39;</span><span class="p">]:</span>
                        <span class="n">daInput</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;analysemodule_input_fk&#39;</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;analysemodule_output_fk&#39;</span><span class="p">]:</span>
                        <span class="n">daOutput</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;analysemodule_output_fk&#39;</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;study_fk&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;study_fk&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">daStudies</span><span class="p">:</span>
                    <span class="n">daProcessen</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;pk&#39;</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;analysemodule_input_fk&#39;</span><span class="p">]:</span>
                        <span class="n">daInput</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;analysemodule_input_fk&#39;</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;analysemodule_output_fk&#39;</span><span class="p">]:</span>
                        <span class="n">daOutput</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;analysemodule_output_fk&#39;</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;series_fk&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;series_fk&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">daSeries</span><span class="p">:</span>
                    <span class="n">daProcessen</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;pk&#39;</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;analysemodule_input_fk&#39;</span><span class="p">]:</span>
                        <span class="n">daInput</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;analysemodule_input_fk&#39;</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;analysemodule_output_fk&#39;</span><span class="p">]:</span>
                        <span class="n">daOutput</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;analysemodule_output_fk&#39;</span><span class="p">])</span>
        <span class="n">daProcessen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uniqifyList</span><span class="p">(</span><span class="n">daProcessen</span><span class="p">)</span>
        <span class="n">daInput</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uniqifyList</span><span class="p">(</span><span class="n">daInput</span><span class="p">)</span>
        <span class="n">daOutput</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uniqifyList</span><span class="p">(</span><span class="n">daOutput</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">destroylist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_gewenste_processen</span><span class="p">,</span><span class="n">daProcessen</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">destroylist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_analyseinput</span><span class="p">,</span><span class="n">daInput</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">destroylist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_analyseoutput</span><span class="p">,</span><span class="n">daOutput</span><span class="p">)</span> <span class="p">)</span>
        <span class="n">feedback</span>  <span class="o">=</span> <span class="s">&quot;5. Found </span><span class="si">%d</span><span class="s">/</span><span class="si">%d</span><span class="s"> processen for </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">daProcessen</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">rows_processen</span><span class="p">),</span><span class="n">thisthing</span><span class="p">)</span>
        <span class="n">feedback</span> <span class="o">+=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">5. Found </span><span class="si">%d</span><span class="s">/</span><span class="si">%d</span><span class="s"> inputs for </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">daInput</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">rows_processen</span><span class="p">),</span><span class="n">thisthing</span><span class="p">)</span>
        <span class="n">feedback</span> <span class="o">+=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">5. Found </span><span class="si">%d</span><span class="s">/</span><span class="si">%d</span><span class="s"> outputs for </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">daOutput</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">rows_processen</span><span class="p">),</span><span class="n">thisthing</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">qctext</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qctext</span><span class="o">.</span><span class="n">appendPlainText</span><span class="p">(</span><span class="n">feedback</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">feedback</span>

        <span class="c"># 6. Gebruik &#39;Gewenste_processen&#39;: voor lijsten &#39;Resultaten_boolean&#39;,&#39;Resultaten_char&#39;,&#39;Resultaten_floating&#39;,&#39;Resultaten_object&#39; uit</span>
        <span class="n">daBools</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">daChars</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">daFloats</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">daObjects</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">daStatus</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">resultlist</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_bool</span><span class="p">,</span> <span class="n">daBools</span><span class="p">,</span> <span class="s">&#39;booleans&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_char</span><span class="p">,</span> <span class="n">daChars</span><span class="p">,</span> <span class="s">&#39;chars&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_float</span><span class="p">,</span> <span class="n">daFloats</span><span class="p">,</span> <span class="s">&#39;floats&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_object</span><span class="p">,</span> <span class="n">daObjects</span><span class="p">,</span> <span class="s">&#39;objects&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_status</span><span class="p">,</span> <span class="n">daStatus</span><span class="p">,</span> <span class="s">&#39;status&#39;</span><span class="p">),</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">tab</span><span class="p">,</span><span class="n">lis</span><span class="p">,</span><span class="n">desc</span><span class="p">)</span> <span class="ow">in</span> <span class="n">resultlist</span><span class="p">:</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;SELECT * FROM </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">tab</span><span class="p">)</span>
            <span class="n">rows_processen</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows_processen</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;gewenste_processen_fk&#39;</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;gewenste_processen_fk&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">daProcessen</span><span class="p">:</span>
                        <span class="n">lis</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;pk&#39;</span><span class="p">])</span>
            <span class="n">lis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uniqifyList</span><span class="p">(</span><span class="n">lis</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">destroylist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span><span class="n">tab</span><span class="p">,</span><span class="n">lis</span><span class="p">)</span> <span class="p">)</span>
            <span class="n">feedback</span> <span class="o">=</span> <span class="s">&quot;6. Found </span><span class="si">%d</span><span class="s">/</span><span class="si">%d</span><span class="s"> </span><span class="si">%s</span><span class="s"> for </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lis</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">rows_processen</span><span class="p">),</span><span class="n">desc</span><span class="p">,</span><span class="n">thisthing</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">qctext</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">qctext</span><span class="o">.</span><span class="n">appendPlainText</span><span class="p">(</span><span class="n">feedback</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">print</span> <span class="n">feedback</span>

        <span class="c"># 7. list of xml files /dirs to remove</span>
        <span class="n">daXML</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;SELECT * FROM </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">table_analyseinput</span><span class="p">)</span>
        <span class="n">rows_processen</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows_processen</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;pk&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">daInput</span><span class="p">:</span>
                <span class="n">daXML</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s%s</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;filepath&#39;</span><span class="p">],</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;filename&#39;</span><span class="p">]))</span>
        <span class="n">feedback</span> <span class="o">=</span> <span class="s">&quot;7. Found </span><span class="si">%d</span><span class="s">/</span><span class="si">%d</span><span class="s"> </span><span class="si">%s</span><span class="s"> for </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">daXML</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">rows_processen</span><span class="p">),</span><span class="s">&quot;inputXMLs&quot;</span><span class="p">,</span><span class="n">thisthing</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">qctext</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qctext</span><span class="o">.</span><span class="n">appendPlainText</span><span class="p">(</span><span class="n">feedback</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">feedback</span>

        <span class="n">len0</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">daXML</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;SELECT * FROM </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">table_analyseoutput</span><span class="p">)</span>
        <span class="n">rows_processen</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows_processen</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;pk&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">daOutput</span><span class="p">:</span>
                <span class="n">daXML</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s%s</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;filepath&#39;</span><span class="p">],</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;filename&#39;</span><span class="p">])))</span>
        <span class="n">feedback</span> <span class="o">=</span> <span class="s">&quot;7. Found </span><span class="si">%d</span><span class="s">/</span><span class="si">%d</span><span class="s"> </span><span class="si">%s</span><span class="s"> for </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">daXML</span><span class="p">)</span><span class="o">-</span><span class="n">len0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">rows_processen</span><span class="p">),</span><span class="s">&quot;outputXMLs&quot;</span><span class="p">,</span><span class="n">thisthing</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">qctext</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qctext</span><span class="o">.</span><span class="n">appendPlainText</span><span class="p">(</span><span class="n">feedback</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">feedback</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">destroylist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="n">daXML</span><span class="p">)</span>

        <span class="c">### close db</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">closedb</span><span class="p">(</span><span class="n">con</span><span class="p">)</span>
        <span class="n">QtGui</span><span class="o">.</span><span class="n">QApplication</span><span class="o">.</span><span class="n">restoreOverrideCursor</span><span class="p">()</span>

        <span class="k">return</span>
</div>
<div class="viewcode-block" id="dbTool.onActivatedProcessorChanged"><a class="viewcode-back" href="../../../Tools.dbTools.html#Tools.dbTools.dbTool.dbTool.onActivatedProcessorChanged">[docs]</a>    <span class="k">def</span> <span class="nf">onActivatedProcessorChanged</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reportentries</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c">###1 open db iqc</span>
        <span class="n">con</span><span class="p">,</span><span class="n">cur</span><span class="p">,</span><span class="n">dbversion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectdb</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="p">)</span>

        <span class="c"># 1-2: build list with (gp_is.series ids)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;SELECT * FROM </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">table_gewenste_processen</span><span class="p">)</span>
        <span class="n">rows_processen</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>

        <span class="n">gp_series_fks</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows_processen</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedSelector</span><span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">selector_id_text</span><span class="p">[</span><span class="s">&#39;[Selector]&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedSelector</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;selector_fk&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedStatus</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedStatus</span><span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">status_id_text</span><span class="p">[</span><span class="s">&#39;[Status]&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedStatus</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;status&#39;</span><span class="p">]:</span>
                    <span class="n">gpid</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;pk&#39;</span><span class="p">]</span>
                    <span class="n">sfk</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;series_fk&#39;</span><span class="p">]:</span>
                       <span class="n">sfk</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;series_fk&#39;</span><span class="p">])</span>
                    <span class="k">elif</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;study_fk&#39;</span><span class="p">]:</span>
                        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;SELECT pk FROM </span><span class="si">%s</span><span class="s"> WHERE study_fk=</span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_series</span><span class="p">,</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;study_fk&#39;</span><span class="p">]))</span>
                        <span class="n">rows_series</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                        <span class="k">for</span> <span class="n">roww</span> <span class="ow">in</span> <span class="n">rows_series</span><span class="p">:</span>
                            <span class="n">sfk</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">roww</span><span class="p">[</span><span class="s">&#39;pk&#39;</span><span class="p">])</span>
                    <span class="k">elif</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;instance_fk&#39;</span><span class="p">]:</span>
                        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;SELECT series_fk FROM </span><span class="si">%s</span><span class="s"> WHERE pk=</span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_instances</span><span class="p">,</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;instance_fk&#39;</span><span class="p">]))</span>
                        <span class="n">rows_instances</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                        <span class="n">sfk</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rows_instances</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;series_fk&#39;</span><span class="p">])</span> <span class="c"># can be only one result</span>

                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sfk</span><span class="p">)</span> <span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                        <span class="n">gp_series_fks</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">gpid</span><span class="p">,</span><span class="n">sfk</span><span class="p">])</span>

        <span class="c"># 3: check modality and stationname in all series per gp_id; if match, add to reset_list</span>
        <span class="n">reset_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">gpid</span><span class="p">,</span><span class="n">skfs</span> <span class="ow">in</span> <span class="n">gp_series_fks</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">skf</span> <span class="ow">in</span> <span class="n">skfs</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;SELECT * FROM </span><span class="si">%s</span><span class="s"> WHERE pk=</span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_series</span><span class="p">,</span><span class="n">skf</span><span class="p">))</span>
                <span class="n">series_rows</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">series_rows</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedModality</span><span class="o">==</span><span class="s">&quot;[Modality]&quot;</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selectedModality</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">stNone</span> <span class="ow">and</span> <span class="n">series_rows</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;modality&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedModality</span> <span class="o">==</span> <span class="n">series_rows</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;modality&#39;</span><span class="p">]:</span> <span class="c"># can be only one result</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedStation</span><span class="o">==</span><span class="s">&quot;[StationName]&quot;</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selectedStation</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">stNone</span> <span class="ow">and</span> <span class="n">series_rows</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;station_name&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedStation</span> <span class="o">==</span> <span class="n">series_rows</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;station_name&#39;</span><span class="p">]:</span> <span class="c"># can be only one result</span>
                        <span class="k">if</span> <span class="n">series_rows</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;station_name&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                            <span class="n">series_rows</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;station_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stNone</span>
                        <span class="k">if</span> <span class="n">series_rows</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;modality&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                            <span class="n">series_rows</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;modality&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stNone</span>
                        <span class="k">if</span> <span class="n">series_rows</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;src_aet&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                            <span class="n">series_rows</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;src_aet&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stNone</span>
                        <span class="n">entry</span> <span class="o">=</span> <span class="n">reportentry</span><span class="p">(</span><span class="n">stationname</span><span class="o">=</span><span class="n">series_rows</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;station_name&#39;</span><span class="p">],</span><span class="n">modality</span><span class="o">=</span><span class="n">series_rows</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;modality&#39;</span><span class="p">],</span><span class="n">gpid</span><span class="o">=</span><span class="n">gpid</span><span class="p">,</span><span class="n">description</span><span class="o">=</span><span class="n">series_rows</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;series_desc&#39;</span><span class="p">],</span><span class="n">seriesid</span><span class="o">=</span><span class="n">skf</span><span class="p">,</span><span class="n">srcaet</span><span class="o">=</span><span class="n">series_rows</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;src_aet&#39;</span><span class="p">])</span>

                        <span class="k">if</span> <span class="ow">not</span> <span class="n">entry</span><span class="o">.</span><span class="n">description</span><span class="p">:</span>
                            <span class="n">entry</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
                        <span class="c"># add datetime</span>
                        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;SELECT content_datetime FROM </span><span class="si">%s</span><span class="s"> WHERE series_fk=</span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_instances</span><span class="p">,</span><span class="n">skf</span><span class="p">))</span>
                        <span class="n">instance_rows</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                        <span class="n">seriesdate</span> <span class="o">=</span> <span class="nb">min</span> <span class="p">(</span> <span class="p">[</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;content_datetime&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">instance_rows</span><span class="p">]</span> <span class="p">)</span>
                        <span class="n">entry</span><span class="o">.</span><span class="n">date</span> <span class="o">=</span> <span class="n">seriesdate</span>

                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">runmode</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">stModeReport</span><span class="p">:</span>
<span class="c">#                            cur.execute(&quot;SELECT content_datetime FROM %s WHERE series_fk=%d&quot; % (self.table_instances,skf))</span>
<span class="c">#                            instance_rows = cur.fetchall()</span>
<span class="c">#                            seriesdate = min ( [ row[&#39;content_datetime&#39;] for row in instance_rows] )</span>
                            <span class="n">checkseriesdate</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="n">seriesdate</span><span class="o">.</span><span class="n">year</span><span class="p">,</span><span class="n">month</span><span class="o">=</span><span class="n">seriesdate</span><span class="o">.</span><span class="n">month</span><span class="p">,</span><span class="n">day</span><span class="o">=</span><span class="n">seriesdate</span><span class="o">.</span><span class="n">day</span><span class="p">)</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedReportDateTimestart</span> <span class="o">&lt;=</span> <span class="n">checkseriesdate</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedReportDateTimeuntil</span><span class="p">:</span>
                                <span class="n">reset_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gpid</span><span class="p">)</span>
                                <span class="n">entry</span><span class="o">.</span><span class="n">date</span> <span class="o">=</span> <span class="n">seriesdate</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">reportentries</span><span class="p">[</span><span class="n">gpid</span><span class="p">]</span> <span class="o">=</span> <span class="n">entry</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">reset_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gpid</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">reportentries</span><span class="p">[</span><span class="n">gpid</span><span class="p">]</span> <span class="o">=</span> <span class="n">entry</span>
                        <span class="k">break</span>

        <span class="c">### close db</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">closedb</span><span class="p">(</span><span class="n">con</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">addFilterNames</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reportentries</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">processorShowSelected</span><span class="p">(</span><span class="n">reset_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">reset_list</span>
</div>
<div class="viewcode-block" id="dbTool.onActivatedReportPeriod"><a class="viewcode-back" href="../../../Tools.dbTools.html#Tools.dbTools.dbTool.dbTool.onActivatedReportPeriod">[docs]</a>    <span class="k">def</span> <span class="nf">onActivatedReportPeriod</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">text</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;[onActivatedReportPeriod]&quot;</span><span class="p">,</span><span class="n">text</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selectedReportPeriod</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">qctable</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">statusLabel</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">determineReportPeriod</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">onActivatedProcessorChanged</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">onActivatedReportChanged</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="dbTool.onActivatedReportQCPeriodicity"><a class="viewcode-back" href="../../../Tools.dbTools.html#Tools.dbTools.dbTool.dbTool.onActivatedReportQCPeriodicity">[docs]</a>    <span class="k">def</span> <span class="nf">onActivatedReportQCPeriodicity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">text</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;[onActivatedReportQCPeriodicity]&quot;</span><span class="p">,</span><span class="n">text</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selectedReportQCPeriodicity</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">qctable</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">statusLabel</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">determineReportPeriod</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">onActivatedProcessorChanged</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">onActivatedReportChanged</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="dbTool.determineReportPeriod"><a class="viewcode-back" href="../../../Tools.dbTools.html#Tools.dbTools.dbTool.dbTool.determineReportPeriod">[docs]</a>    <span class="k">def</span> <span class="nf">determineReportPeriod</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Workflow:</span>
<span class="sd">                1. Find number of days/weeks/months is reporting period</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">## 1. Find number of days/weeks/months is reporting period</span>
        <span class="k">if</span> <span class="s">&#39;[Period to Report]&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedReportPeriod</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">selectedReportDateTimestart</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">min</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">selectedReportDateTimeuntil</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">max</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span>
            <span class="n">y1</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">year</span>
            <span class="n">m1</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">month</span>
            <span class="n">d1</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">day</span>
            <span class="k">if</span> <span class="s">&#39;Last 3 months&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedReportPeriod</span><span class="p">:</span>
                <span class="n">dm</span> <span class="o">=</span> <span class="mi">3</span>
                <span class="n">dy</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">d0</span> <span class="o">=</span> <span class="n">d1</span>
            <span class="k">elif</span> <span class="s">&#39;Last 6 months&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedReportPeriod</span><span class="p">:</span>
                <span class="n">dm</span> <span class="o">=</span> <span class="mi">6</span>
                <span class="n">dy</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">d0</span> <span class="o">=</span> <span class="n">d1</span>
            <span class="k">elif</span> <span class="s">&#39;Last 12 months&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedReportPeriod</span><span class="p">:</span>
                <span class="n">dm</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">dy</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">d0</span> <span class="o">=</span> <span class="n">d1</span>
            <span class="k">elif</span> <span class="s">&#39;Previous year&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedReportPeriod</span><span class="p">:</span>
                <span class="n">y1</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">year</span> <span class="o">-</span><span class="mi">1</span>
                <span class="n">m1</span> <span class="o">=</span> <span class="mi">12</span>
                <span class="n">dy</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">dm</span> <span class="o">=</span> <span class="mi">11</span>
                <span class="n">d0</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">d1</span> <span class="o">=</span> <span class="mi">31</span>
            <span class="k">elif</span> <span class="s">&#39;This year&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedReportPeriod</span><span class="p">:</span>
                <span class="n">dy</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">dm</span> <span class="o">=</span> <span class="n">m1</span><span class="o">-</span><span class="mi">1</span>
                <span class="n">d0</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="c">#how many?</span>
            <span class="n">y0</span> <span class="o">=</span> <span class="n">y1</span> <span class="o">-</span> <span class="n">dy</span>
            <span class="n">m0</span> <span class="o">=</span> <span class="n">m1</span> <span class="o">-</span> <span class="n">dm</span>
            <span class="k">if</span> <span class="n">m0</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">y0</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="n">m0</span> <span class="o">+=</span> <span class="mi">12</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">selectedReportDateTimestart</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="n">y0</span><span class="p">,</span><span class="n">month</span><span class="o">=</span><span class="n">m0</span><span class="p">,</span><span class="n">day</span><span class="o">=</span><span class="n">d0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">selectedReportDateTimeuntil</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="n">y1</span><span class="p">,</span><span class="n">month</span><span class="o">=</span><span class="n">m1</span><span class="p">,</span><span class="n">day</span><span class="o">=</span><span class="n">d1</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="dbTool.onActivatedReportChanged"><a class="viewcode-back" href="../../../Tools.dbTools.html#Tools.dbTools.dbTool.dbTool.onActivatedReportChanged">[docs]</a>    <span class="k">def</span> <span class="nf">onActivatedReportChanged</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Workflow:</span>
<span class="sd">                2. Find processes of correct modality, stationname, selector and in given reporting period</span>
<span class="sd">                3. Determine expected number of processes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">## 1. Find number of days/weeks/months is reporting period</span>
        <span class="n">delta_days</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selectedReportDateTimeuntil</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedReportDateTimestart</span><span class="p">)</span><span class="o">.</span><span class="n">days</span>
        <span class="n">delta_weeks</span> <span class="o">=</span> <span class="n">delta_days</span><span class="o">/</span><span class="mi">7</span>
        <span class="n">delta_months</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedReportDateTimeuntil</span><span class="o">.</span><span class="n">month</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedReportDateTimestart</span><span class="o">.</span><span class="n">month</span><span class="o">+</span> <span class="mi">12</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selectedReportDateTimeuntil</span><span class="o">.</span><span class="n">year</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedReportDateTimestart</span><span class="o">.</span><span class="n">year</span><span class="p">)</span>
<span class="c">#        print &quot;days/weeks/months&quot;,delta_days, delta_weeks,delta_months</span>

        <span class="c">## 2. Find processes of correct modality, stationname, selector and in given reporting period</span>

        <span class="c">## 3. Determine expected number of processes</span>
        <span class="k">if</span> <span class="s">&#39;[&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedReportPeriod</span> <span class="ow">or</span> <span class="s">&#39;[&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedReportQCPeriodicity</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">num_expected</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="s">&#39;Monthly&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedReportQCPeriodicity</span><span class="p">:</span>
            <span class="n">num_expected</span> <span class="o">=</span> <span class="n">delta_months</span>
        <span class="k">elif</span> <span class="s">&#39;Bi-Weekly&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedReportQCPeriodicity</span><span class="p">:</span>
            <span class="n">num_expected</span> <span class="o">=</span> <span class="n">delta_weeks</span><span class="o">/</span><span class="mi">2</span>
        <span class="k">elif</span> <span class="s">&#39;Weekly&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedReportQCPeriodicity</span><span class="p">:</span>
            <span class="n">num_expected</span> <span class="o">=</span> <span class="n">delta_weeks</span>
        <span class="k">elif</span> <span class="s">&#39;Daily&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedReportQCPeriodicity</span><span class="p">:</span>
            <span class="n">num_expected</span> <span class="o">=</span> <span class="n">delta_days</span>
<span class="c">#        print &quot;num expected&quot;,num_expected</span>

        <span class="k">if</span> <span class="s">&#39;[&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedModality</span> <span class="ow">and</span> <span class="s">&#39;[&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedStation</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">selector_id_text</span><span class="p">[</span><span class="s">&#39;[Selector]&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedSelector</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c">## Find number of machines:</span>
        <span class="n">machines</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">stationname</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reportentries</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>
        <span class="n">machines</span> <span class="o">=</span>  <span class="n">OrderedDict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">machines</span><span class="p">)</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

        <span class="k">print</span> <span class="s">&#39;Expected </span><span class="si">%d</span><span class="s"> QC entries in </span><span class="si">%s</span><span class="s"> for each selector of </span><span class="si">%d</span><span class="s"> machines&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">num_expected</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">selectedReportPeriod</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">machines</span><span class="p">))</span>
        <span class="n">overal_expected</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">overal_total</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">overal_notprocessed</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">overal_retakes</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">overal_errors</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">machine</span> <span class="ow">in</span> <span class="n">machines</span><span class="p">:</span>
            <span class="n">cleanentries</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">sel_count</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">sel_notprocessed</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">sel_retakes</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">total_count</span> <span class="o">=</span> <span class="mi">0</span> <span class="c"># total processables for this machine</span>
            <span class="n">total_notprocessed</span> <span class="o">=</span> <span class="mi">0</span>    <span class="c"># total non-processables for this machine</span>
            <span class="n">total_retakes</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">total_errors</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">selectors</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">descriptions</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">sel</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reportentries</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">sel</span><span class="o">.</span><span class="n">stationname</span> <span class="o">==</span> <span class="n">machine</span><span class="p">:</span>
                    <span class="n">selectors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sel</span><span class="o">.</span><span class="n">selector</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">sel</span><span class="o">.</span><span class="n">selector</span> <span class="ow">in</span> <span class="n">sel_count</span><span class="p">:</span>
                        <span class="n">sel_count</span><span class="p">[</span><span class="n">sel</span><span class="o">.</span><span class="n">selector</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">sel_count</span><span class="p">[</span><span class="n">sel</span><span class="o">.</span><span class="n">selector</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="n">total_count</span> <span class="o">+=</span> <span class="mi">1</span>

                    <span class="k">if</span> <span class="n">sel</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="s">&#39;Error&#39;</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">sel</span><span class="o">.</span><span class="n">selector</span> <span class="ow">in</span> <span class="n">sel_notprocessed</span><span class="p">:</span>
                            <span class="n">sel_notprocessed</span><span class="p">[</span><span class="n">sel</span><span class="o">.</span><span class="n">selector</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">sel_notprocessed</span><span class="p">[</span><span class="n">sel</span><span class="o">.</span><span class="n">selector</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                        <span class="n">total_notprocessed</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="k">continue</span>

                    <span class="c"># count number of distinct descriptions (filters)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">sel</span><span class="o">.</span><span class="n">description</span> <span class="ow">in</span> <span class="n">descriptions</span><span class="p">:</span>
                        <span class="n">descriptions</span><span class="p">[</span><span class="n">sel</span><span class="o">.</span><span class="n">description</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">descriptions</span><span class="p">[</span><span class="n">sel</span><span class="o">.</span><span class="n">description</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

                    <span class="n">dat</span> <span class="o">=</span> <span class="n">sel</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%Y/%m/</span><span class="si">%d</span><span class="s">&#39;</span><span class="p">)</span>
                    <span class="n">uid</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">_</span><span class="si">%s</span><span class="s">_</span><span class="si">%s</span><span class="s">_</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">sel</span><span class="o">.</span><span class="n">stationname</span><span class="p">,</span><span class="n">sel</span><span class="o">.</span><span class="n">selector</span><span class="p">,</span><span class="n">dat</span><span class="p">,</span><span class="n">sel</span><span class="o">.</span><span class="n">description</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">uid</span> <span class="ow">in</span> <span class="n">cleanentries</span><span class="p">:</span>
                        <span class="n">cleanentries</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span> <span class="o">=</span> <span class="n">sel</span>
                    <span class="k">if</span> <span class="n">sel</span><span class="o">.</span><span class="n">date</span> <span class="o">&gt;</span> <span class="n">cleanentries</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span><span class="o">.</span><span class="n">date</span><span class="p">:</span>
                        <span class="k">print</span> <span class="s">&quot;Retake &quot;</span><span class="p">,</span><span class="n">sel</span><span class="c">#%s: %s %s %s&quot; %(uid,dat,sel.date,cleanentries[uid].date)</span>
                        <span class="n">cleanentries</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span> <span class="o">=</span> <span class="n">sel</span>
                        <span class="k">if</span> <span class="n">sel</span><span class="o">.</span><span class="n">selector</span> <span class="ow">in</span> <span class="n">sel_retakes</span><span class="p">:</span>
                            <span class="n">sel_retakes</span><span class="p">[</span><span class="n">sel</span><span class="o">.</span><span class="n">selector</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">sel_retakes</span><span class="p">[</span><span class="n">sel</span><span class="o">.</span><span class="n">selector</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                        <span class="n">total_retakes</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">print</span> <span class="n">descriptions</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">descriptions</span><span class="p">)</span>
            <span class="n">selectors</span> <span class="o">=</span>  <span class="n">OrderedDict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">selectors</span><span class="p">)</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">sel</span> <span class="ow">in</span> <span class="n">selectors</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">sel</span> <span class="ow">in</span> <span class="n">sel_count</span><span class="p">:</span>
                    <span class="n">sel_count</span><span class="p">[</span><span class="n">sel</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">sel</span> <span class="ow">in</span> <span class="n">sel_notprocessed</span><span class="p">:</span>
                    <span class="n">sel_notprocessed</span><span class="p">[</span><span class="n">sel</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">sel</span> <span class="ow">in</span> <span class="n">sel_retakes</span><span class="p">:</span>
                    <span class="n">sel_retakes</span><span class="p">[</span><span class="n">sel</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">errors</span><span class="p">,</span><span class="n">scaleddata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkResults</span><span class="p">(</span><span class="n">cleanentries</span><span class="p">,</span><span class="n">selectors</span><span class="p">)</span> <span class="c"># per machine, per selector</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graphResults</span><span class="p">(</span><span class="n">scaleddata</span><span class="p">)</span>
            <span class="c">## Add this selector as section to report</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">addToReport</span><span class="p">(</span><span class="n">machine</span><span class="o">=</span><span class="n">machine</span><span class="p">,</span><span class="n">selectors</span><span class="o">=</span><span class="n">selectors</span><span class="p">,</span><span class="n">scaleddata</span><span class="o">=</span><span class="n">scaleddata</span><span class="p">,</span><span class="n">errors</span><span class="o">=</span><span class="n">errors</span><span class="p">,</span>
                             <span class="n">verwacht</span><span class="o">=</span><span class="n">num_expected</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">descriptions</span><span class="p">),</span><span class="n">counts</span><span class="o">=</span><span class="n">sel_count</span><span class="p">,</span><span class="n">bads</span><span class="o">=</span><span class="n">sel_notprocessed</span><span class="p">,</span><span class="n">retakes</span><span class="o">=</span><span class="n">sel_retakes</span><span class="p">)</span>
            <span class="c"># summary per machine</span>
            <span class="n">total_errors</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">selectors</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">: </span><span class="si">%d</span><span class="s"> selectors found in </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">machine</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">selectors</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">selectedReportPeriod</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">: </span><span class="si">%d</span><span class="s"> selectors; found </span><span class="si">%d</span><span class="s"> (</span><span class="si">%d</span><span class="s"> bad, </span><span class="si">%d</span><span class="s"> retakes) of </span><span class="si">%d</span><span class="s"> expected tests: net </span><span class="si">%.1f%%</span><span class="s">&#39;</span> \
                      <span class="o">%</span><span class="p">(</span><span class="n">machine</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">selectors</span><span class="p">),</span><span class="n">total_count</span><span class="p">,</span><span class="n">total_notprocessed</span><span class="p">,</span><span class="n">total_retakes</span><span class="p">,</span>
                        <span class="n">num_expected</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">selectors</span><span class="p">)</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">descriptions</span><span class="p">),</span><span class="mf">100.</span><span class="o">*</span><span class="p">(</span><span class="n">total_count</span><span class="o">-</span><span class="n">total_notprocessed</span><span class="o">-</span><span class="n">total_retakes</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">num_expected</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">selectors</span><span class="p">)</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">descriptions</span><span class="p">)))</span>
                <span class="k">for</span> <span class="n">sel</span> <span class="ow">in</span> <span class="n">selectors</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">val</span> <span class="ow">in</span> <span class="n">errors</span><span class="p">[</span><span class="n">sel</span><span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                        <span class="n">total_errors</span> <span class="o">+=</span> <span class="n">val</span>
                <span class="k">print</span> <span class="s">&#39;     : </span><span class="si">%d</span><span class="s"> problems:&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">total_errors</span><span class="p">),</span>
                <span class="k">for</span> <span class="n">sel</span> <span class="ow">in</span> <span class="n">selectors</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">val</span> <span class="ow">in</span> <span class="n">errors</span><span class="p">[</span><span class="n">sel</span><span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                        <span class="k">print</span> <span class="n">key</span><span class="p">,</span><span class="s">&#39;:&#39;</span><span class="p">,</span><span class="n">val</span><span class="p">,</span><span class="s">&#39;;&#39;</span><span class="p">,</span>
                <span class="k">print</span> <span class="s">&#39;&#39;</span>
            <span class="n">reportname</span><span class="o">=</span><span class="s">&#39;&#39;</span>
            <span class="n">reportname</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedReportDateTimestart</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%Y%m</span><span class="si">%d</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="n">reportname</span> <span class="o">+=</span> <span class="s">&#39;_&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">selectedReportDateTimeuntil</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%Y%m</span><span class="si">%d</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="n">reportname</span> <span class="o">+=</span> <span class="s">&#39;_&#39;</span><span class="o">+</span><span class="n">machine</span><span class="o">+</span><span class="s">&#39;.pdf&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">finishReport</span><span class="p">(</span><span class="n">reportname</span><span class="p">,</span><span class="n">machine</span><span class="o">=</span><span class="n">machine</span><span class="p">,</span><span class="n">verwacht</span><span class="o">=</span><span class="n">num_expected</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">descriptions</span><span class="p">),</span><span class="n">count</span><span class="o">=</span><span class="n">total_count</span><span class="p">,</span>
                              <span class="n">bads</span><span class="o">=</span><span class="n">total_notprocessed</span><span class="p">,</span><span class="n">retakes</span><span class="o">=</span><span class="n">total_retakes</span><span class="p">,</span><span class="n">errors</span><span class="o">=</span><span class="n">total_errors</span><span class="p">)</span>

            <span class="c"># summary over all machines</span>
            <span class="n">overal_expected</span> <span class="o">+=</span> <span class="n">num_expected</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">selectors</span><span class="p">)</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">descriptions</span><span class="p">)</span>
            <span class="n">overal_total</span> <span class="o">+=</span> <span class="n">total_count</span>
            <span class="n">overal_notprocessed</span> <span class="o">+=</span> <span class="n">total_notprocessed</span>
            <span class="n">overal_retakes</span> <span class="o">+=</span> <span class="n">total_retakes</span>
            <span class="n">overal_errors</span> <span class="o">+=</span> <span class="n">total_errors</span>

        <span class="k">if</span> <span class="n">overal_expected</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;Overal: expected </span><span class="si">%d</span><span class="s"> tests in </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span><span class="p">(</span> <span class="n">overal_expected</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">selectedReportPeriod</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;Overal: found </span><span class="si">%d</span><span class="s"> (</span><span class="si">%d</span><span class="s"> bad, </span><span class="si">%d</span><span class="s"> retakes) of </span><span class="si">%d</span><span class="s"> expected tests (net </span><span class="si">%.1f%%</span><span class="s"> done) showing </span><span class="si">%d</span><span class="s"> errors&#39;</span> \
                  <span class="o">%</span><span class="p">(</span> <span class="n">overal_total</span><span class="p">,</span><span class="n">overal_notprocessed</span><span class="p">,</span><span class="n">overal_retakes</span><span class="p">,</span><span class="n">overal_expected</span><span class="p">,</span><span class="mf">100.</span><span class="o">*</span><span class="p">(</span><span class="n">overal_total</span><span class="o">-</span><span class="n">overal_notprocessed</span><span class="o">-</span><span class="n">overal_retakes</span><span class="p">)</span><span class="o">/</span><span class="n">overal_expected</span><span class="p">,</span><span class="n">overal_errors</span> <span class="p">)</span>
</div>
<div class="viewcode-block" id="dbTool.graphResults"><a class="viewcode-back" href="../../../Tools.dbTools.html#Tools.dbTools.dbTool.dbTool.graphResults">[docs]</a>    <span class="k">def</span> <span class="nf">graphResults</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">scaleddata</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Expected input: dictionary of all correctly processed entries for one stationname</span>
<span class="sd">        For each selector, make a graph of all scaled values if limits given</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">qcgraph</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qcgraph</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">qcgraph</span><span class="o">.</span><span class="n">getPlotItem</span><span class="p">()</span><span class="o">.</span><span class="n">legend</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">qcgraph</span><span class="o">.</span><span class="n">getPlotItem</span><span class="p">()</span><span class="o">.</span><span class="n">legend</span><span class="o">.</span><span class="n">items</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">qcgraph</span><span class="o">.</span><span class="n">addLegend</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qcgraph</span><span class="o">.</span><span class="n">setXRange</span><span class="p">(</span>
                <span class="n">datetime2seconds</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selectedReportDateTimestart</span><span class="p">),</span>
                <span class="n">datetime2seconds</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selectedReportDateTimeuntil</span><span class="p">),</span>
                <span class="n">padding</span><span class="o">=.</span><span class="mi">0</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qcplots</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">qcgroupbox</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clearLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qcgroupbox</span><span class="o">.</span><span class="n">layout</span><span class="p">(),</span><span class="n">layoutOnly</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="n">ix</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">2.</span>
        <span class="n">boxcols</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="k">for</span> <span class="n">sel</span> <span class="ow">in</span> <span class="n">scaleddata</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">qcgraph</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">qcgraph</span><span class="o">.</span><span class="n">setTitle</span><span class="p">(</span><span class="n">sel</span><span class="p">)</span>
            <span class="n">selector</span> <span class="o">=</span> <span class="n">scaleddata</span><span class="p">[</span><span class="n">sel</span><span class="p">]</span>
            <span class="n">mintime</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">maxtime</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">selector</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="n">data</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">selector</span><span class="p">[</span><span class="n">name</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">mintime</span><span class="p">:</span>
                    <span class="n">mintime</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">mintime</span><span class="p">,</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">maxtime</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">maxtime</span><span class="p">,</span><span class="n">data</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">mintime</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">maxtime</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

                <span class="n">penstyle</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">ix</span> <span class="o">&lt;</span> <span class="mi">9</span><span class="o">*</span><span class="mi">5</span><span class="p">:</span>
                    <span class="n">penstyle</span> <span class="o">=</span> <span class="n">ix</span><span class="o">/</span><span class="mi">9</span><span class="o">+</span><span class="mi">1</span>


                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">qcgraph</span><span class="p">:</span> <span class="c"># and &#39;doseratio&#39; in name:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">qcplots</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qcgraph</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">data</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">data</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span> <span class="n">symbol</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span><span class="n">symbolPen</span><span class="o">=</span><span class="n">pg</span><span class="o">.</span><span class="n">mkPen</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="n">linewidth</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">pg</span><span class="o">.</span><span class="n">intColor</span><span class="p">(</span><span class="n">ix</span><span class="p">)))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">qcplots</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qcgraph</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">data</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">data</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span><span class="n">pen</span><span class="o">=</span><span class="n">pg</span><span class="o">.</span><span class="n">mkPen</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="n">linewidth</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">pg</span><span class="o">.</span><span class="n">intColor</span><span class="p">(</span><span class="n">ix</span><span class="p">),</span><span class="n">style</span><span class="o">=</span><span class="n">penstyle</span><span class="p">))</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">qcgroupbox</span><span class="p">:</span>
                        <span class="n">nwButton</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QCheckBox</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                        <span class="n">nwButton</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
                        <span class="n">nwButton</span><span class="o">.</span><span class="n">stateChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">togglePlot</span><span class="p">,</span><span class="n">name</span><span class="p">))</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">qcgroupbox</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">nwButton</span><span class="p">,</span><span class="n">ix</span><span class="o">/</span><span class="n">boxcols</span><span class="p">,</span><span class="n">ix</span><span class="o">%</span><span class="n">boxcols</span><span class="p">)</span>
                    <span class="n">ix</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">qcgraph</span><span class="p">:</span> <span class="c"># and &#39;doseratio&#39; in name:</span>
                <span class="n">limitpen</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">mkPen</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="n">linewidth</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">),</span><span class="n">style</span><span class="o">=</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">DashLine</span><span class="p">)</span>
                <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;CritMAX&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">qcplots</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qcgraph</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">mintime</span><span class="p">,</span><span class="n">maxtime</span><span class="p">],[</span><span class="mf">1.</span><span class="p">,</span><span class="mf">1.</span><span class="p">],</span><span class="n">pen</span><span class="o">=</span><span class="n">limitpen</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;CritMAX&#39;</span><span class="p">)</span>
                <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;CritMIN&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">qcplots</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qcgraph</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">mintime</span><span class="p">,</span><span class="n">maxtime</span><span class="p">],[</span><span class="o">-</span><span class="mf">1.</span><span class="p">,</span><span class="o">-</span><span class="mf">1.</span><span class="p">],</span><span class="n">pen</span><span class="o">=</span><span class="n">limitpen</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;CritMIN&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="dbTool.togglePlot"><a class="viewcode-back" href="../../../Tools.dbTools.html#Tools.dbTools.dbTool.dbTool.togglePlot">[docs]</a>    <span class="k">def</span> <span class="nf">togglePlot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">state</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Checked</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qcplots</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">sample</span><span class="p">,</span><span class="n">label</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">qcgraph</span><span class="o">.</span><span class="n">getPlotItem</span><span class="p">()</span><span class="o">.</span><span class="n">legend</span><span class="o">.</span><span class="n">items</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">label</span><span class="o">.</span><span class="n">text</span> <span class="o">==</span> <span class="n">name</span><span class="p">:</span>
                    <span class="n">label</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
                    <span class="n">sample</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
                    <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qcplots</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">sample</span><span class="p">,</span><span class="n">label</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">qcgraph</span><span class="o">.</span><span class="n">getPlotItem</span><span class="p">()</span><span class="o">.</span><span class="n">legend</span><span class="o">.</span><span class="n">items</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">label</span><span class="o">.</span><span class="n">text</span> <span class="o">==</span> <span class="n">name</span><span class="p">:</span>
                    <span class="n">label</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
                    <span class="n">sample</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
                    <span class="k">break</span>
</div>
<div class="viewcode-block" id="dbTool.addFilterNames"><a class="viewcode-back" href="../../../Tools.dbTools.html#Tools.dbTools.dbTool.dbTool.addFilterNames">[docs]</a>    <span class="k">def</span> <span class="nf">addFilterNames</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">entries</span><span class="p">,</span><span class="n">doubleid</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="c"># If an extra identifier (like Filter or Antomy) is given use that instead of description</span>
        <span class="c">###1 open db iqc</span>
        <span class="n">con</span><span class="p">,</span><span class="n">cur</span><span class="p">,</span><span class="n">dbversion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectdb</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="p">)</span>

        <span class="n">gps</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">entry</span><span class="o">.</span><span class="n">gpid</span> <span class="ow">in</span> <span class="n">gps</span><span class="p">:</span>
                <span class="n">gps</span><span class="p">[</span><span class="n">entry</span><span class="o">.</span><span class="n">gpid</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">gps</span><span class="p">[</span><span class="n">entry</span><span class="o">.</span><span class="n">gpid</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;SELECT * FROM </span><span class="si">%s</span><span class="s"> WHERE omschrijving LIKE &#39;</span><span class="si">%%%s%%</span><span class="s">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_char</span><span class="p">,</span><span class="s">&#39;FilterMaterial&#39;</span><span class="p">))</span>
        <span class="n">rowsF</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;SELECT * FROM </span><span class="si">%s</span><span class="s"> WHERE omschrijving LIKE &#39;</span><span class="si">%%%s%%</span><span class="s">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_char</span><span class="p">,</span><span class="s">&#39;Anatomy&#39;</span><span class="p">))</span>
        <span class="n">rowsP</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>

        <span class="n">fnames</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rowsF</span><span class="p">:</span>
            <span class="n">uid</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;gewenste_processen_fk&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">uid</span> <span class="ow">in</span> <span class="n">fnames</span><span class="p">:</span>
                <span class="n">fnames</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">fnames</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;waarde&#39;</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rowsP</span><span class="p">:</span>
            <span class="n">uid</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;gewenste_processen_fk&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">uid</span> <span class="ow">in</span> <span class="n">fnames</span><span class="p">:</span>
                <span class="n">fnames</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">fnames</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;waarde&#39;</span><span class="p">])</span>


        <span class="k">for</span> <span class="n">uid</span><span class="p">,</span><span class="n">vals</span> <span class="ow">in</span> <span class="n">fnames</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">uid</span> <span class="ow">in</span> <span class="n">gps</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">en</span> <span class="ow">in</span> <span class="n">gps</span><span class="p">[</span><span class="n">uid</span><span class="p">]:</span>
                    <span class="n">entries</span><span class="p">[</span><span class="n">en</span><span class="p">]</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s">&#39; &#39;</span><span class="o">+</span><span class="s">&#39;#&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">vals</span><span class="p">))</span>

        <span class="c">### close db</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">closedb</span><span class="p">(</span><span class="n">con</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="dbTool.checkResults"><a class="viewcode-back" href="../../../Tools.dbTools.html#Tools.dbTools.dbTool.dbTool.checkResults">[docs]</a>    <span class="k">def</span> <span class="nf">checkResults</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">entries</span><span class="p">,</span><span class="n">selectors</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check all results of given entries, identified by gewensteprocessen_id.</span>
<span class="sd">        If any of the tables resultaten_char, resultaten_floating is outside specs, put in report</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">selectors</span><span class="p">:</span>
            <span class="c">## 1. for each selector make dictionary of number of errors</span>
            <span class="n">errors</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="c">## 2. for each selector make dictionary of scaled measurements vs date</span>
            <span class="n">scaleddata</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">sel</span> <span class="ow">in</span> <span class="n">selectors</span><span class="p">:</span>
                <span class="n">errors</span><span class="p">[</span><span class="n">sel</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">scaleddata</span><span class="p">[</span><span class="n">sel</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c">###1 open db iqc</span>
        <span class="n">con</span><span class="p">,</span><span class="n">cur</span><span class="p">,</span><span class="n">dbversion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectdb</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">en</span> <span class="ow">in</span> <span class="n">entries</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">en</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="s">&#39;Error&#39;</span><span class="p">:</span>
                <span class="n">en</span><span class="o">.</span><span class="n">analysisresult</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stResultError</span>
                <span class="k">continue</span>
            <span class="n">hascrits</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">en</span><span class="o">.</span><span class="n">analysisresult</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stResultNoRanges</span>
            <span class="n">sel</span> <span class="o">=</span> <span class="n">en</span><span class="o">.</span><span class="n">selector</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;SELECT * FROM </span><span class="si">%s</span><span class="s"> WHERE gewenste_processen_fk=</span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_char</span><span class="p">,</span><span class="n">en</span><span class="o">.</span><span class="n">gpid</span><span class="p">))</span>
            <span class="n">rows</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;criterium&#39;</span><span class="p">]:</span>
                    <span class="n">hascrits</span> <span class="o">=</span> <span class="bp">True</span>
                    <span class="k">if</span> <span class="n">selectors</span> <span class="ow">and</span> <span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;waarde&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;criterium&#39;</span><span class="p">]):</span>
                        <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;omschrijving&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">errors</span><span class="p">[</span><span class="n">sel</span><span class="p">]:</span>
                            <span class="n">errors</span><span class="p">[</span><span class="n">sel</span><span class="p">][</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;omschrijving&#39;</span><span class="p">]]</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">errors</span><span class="p">[</span><span class="n">sel</span><span class="p">][</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;omschrijving&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">1</span>

            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;SELECT * FROM </span><span class="si">%s</span><span class="s"> WHERE gewenste_processen_fk=</span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_float</span><span class="p">,</span><span class="n">en</span><span class="o">.</span><span class="n">gpid</span><span class="p">))</span>
            <span class="n">rows</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
                <span class="n">krmax</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;grens_kritisch_boven&#39;</span><span class="p">]</span>
                <span class="n">krmin</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;grens_kritisch_onder&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">krmax</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">krmin</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">hascrits</span> <span class="o">=</span> <span class="bp">True</span>
                    <span class="k">if</span> <span class="n">selectors</span><span class="p">:</span>
                        <span class="n">measurement_value</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;waarde&#39;</span><span class="p">]</span>
                        <span class="n">measurement_name</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;omschrijving&#39;</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">measurement_value</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                            <span class="k">continue</span>
                        <span class="n">scaled_value</span> <span class="o">=</span> <span class="p">(</span><span class="n">measurement_value</span><span class="o">-</span><span class="p">(</span><span class="n">krmax</span><span class="o">+</span><span class="n">krmin</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span><span class="o">/</span><span class="p">((</span><span class="n">krmax</span><span class="o">-</span><span class="n">krmin</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">measurement_name</span> <span class="ow">in</span> <span class="n">scaleddata</span><span class="p">[</span><span class="n">sel</span><span class="p">]:</span>
                            <span class="n">scaleddata</span><span class="p">[</span><span class="n">sel</span><span class="p">][</span><span class="n">measurement_name</span><span class="p">]</span><span class="o">=</span><span class="p">[]</span>
                        <span class="n">scaleddata</span><span class="p">[</span><span class="n">sel</span><span class="p">][</span><span class="n">measurement_name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span><span class="n">datetime2seconds</span><span class="p">(</span><span class="n">en</span><span class="o">.</span><span class="n">date</span><span class="p">),</span><span class="n">scaled_value</span><span class="p">,</span><span class="n">measurement_value</span><span class="p">)</span> <span class="p">)</span>

                        <span class="k">if</span> <span class="n">scaled_value</span><span class="o">&lt;-</span><span class="mi">1</span> <span class="ow">or</span> <span class="n">scaled_value</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
                            <span class="n">en</span><span class="o">.</span><span class="n">analysisresult</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stResultOutOfRange</span>
                            <span class="k">if</span> <span class="n">measurement_name</span> <span class="ow">in</span> <span class="n">errors</span><span class="p">[</span><span class="n">sel</span><span class="p">]:</span>
                                <span class="n">errors</span><span class="p">[</span><span class="n">sel</span><span class="p">][</span><span class="n">measurement_name</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">errors</span><span class="p">[</span><span class="n">sel</span><span class="p">][</span><span class="n">measurement_name</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">en</span><span class="o">.</span><span class="n">analysisresult</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">stResultNoRanges</span> <span class="ow">and</span> <span class="n">hascrits</span><span class="p">:</span>
                <span class="n">en</span><span class="o">.</span><span class="n">analysisresult</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stResultOK</span>
        <span class="c">### close db</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">closedb</span><span class="p">(</span><span class="n">con</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">selectors</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">errors</span><span class="p">,</span><span class="n">scaleddata</span>
        <span class="k">return</span>


</div>
<div class="viewcode-block" id="dbTool.resetListedProcessor"><a class="viewcode-back" href="../../../Tools.dbTools.html#Tools.dbTools.dbTool.dbTool.resetListedProcessor">[docs]</a>    <span class="k">def</span> <span class="nf">resetListedProcessor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">reportentries</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">qctable</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">qctable</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">qctable</span><span class="o">.</span><span class="n">columnCount</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">reset_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">en</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reportentries</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">reset_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">en</span><span class="o">.</span><span class="n">gpid</span> <span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">reset_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c">###1 open db iqc</span>
        <span class="n">con</span><span class="p">,</span><span class="n">cur</span><span class="p">,</span><span class="n">dbversion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectdb</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="p">)</span>

        <span class="c"># 4: for all gp_id in reset_list, set status to &quot;reset&quot;</span>
        <span class="n">nrows</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">gpid</span> <span class="ow">in</span> <span class="n">reset_list</span><span class="p">:</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;UPDATE </span><span class="si">%s</span><span class="s"> set status=</span><span class="si">%d</span><span class="s"> where </span><span class="si">%s</span><span class="s">.pk=</span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_gewenste_processen</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">status_reset</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">table_gewenste_processen</span><span class="p">,</span><span class="n">gpid</span><span class="p">))</span>
            <span class="n">nrows</span> <span class="o">+=</span> <span class="n">cur</span><span class="o">.</span><span class="n">rowcount</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statusLabel</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s">&quot;Did reset of </span><span class="si">%d</span><span class="s"> processes&quot;</span> <span class="o">%</span><span class="n">nrows</span><span class="p">)</span>
        <span class="n">con</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

        <span class="c">### close db</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">closedb</span><span class="p">(</span><span class="n">con</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="dbTool.mysqlDeleteRows"><a class="viewcode-back" href="../../../Tools.dbTools.html#Tools.dbTools.dbTool.dbTool.mysqlDeleteRows">[docs]</a>    <span class="k">def</span> <span class="nf">mysqlDeleteRows</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">table</span><span class="p">,</span><span class="n">value_list</span><span class="p">,</span><span class="n">key</span><span class="o">=</span><span class="s">&#39;pk&#39;</span><span class="p">):</span>
        <span class="c">#DELETE FROM your_table WHERE id_users=1 AND id_product=2</span>
        <span class="c">###1 open db iqc</span>
        <span class="n">con</span><span class="p">,</span><span class="n">cur</span><span class="p">,</span><span class="n">dbversion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectdb</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="p">)</span>

        <span class="c"># for all values of given key in given table do delete row</span>
        <span class="n">nrows</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">value_list</span><span class="p">:</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;DELETE FROM </span><span class="si">%s</span><span class="s"> WHERE </span><span class="si">%s</span><span class="s">=</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">table</span><span class="p">,</span><span class="n">key</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">)))</span>
            <span class="n">nrows</span> <span class="o">+=</span> <span class="n">cur</span><span class="o">.</span><span class="n">rowcount</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statusLabel</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s">&quot;Did delete </span><span class="si">%d</span><span class="s"> rows of table </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">nrows</span><span class="p">,</span><span class="n">table</span><span class="p">))</span>
<span class="c">#        print &quot;Did delete %d rows of table %s&quot; %(nrows,table)</span>
        <span class="n">con</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

        <span class="c">### close db</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">closedb</span><span class="p">(</span><span class="n">con</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="dbTool.xmlDeleteFandF"><a class="viewcode-back" href="../../../Tools.dbTools.html#Tools.dbTools.dbTool.dbTool.xmlDeleteFandF">[docs]</a>    <span class="k">def</span> <span class="nf">xmlDeleteFandF</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">dalist</span><span class="p">):</span>
        <span class="n">error</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pathXMLInputOutput</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;ERROR! Cannot determine root path for XML files&quot;</span>
            <span class="k">return</span> <span class="n">error</span>

        <span class="n">outname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span><span class="s">&quot;dbtool_remove_list.txt&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">outname</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">myfile</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="n">dalist</span><span class="p">:</span>
                <span class="n">myfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;rm -rf &#39;</span><span class="si">%s</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="n">fname</span><span class="p">)))</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="s">&quot;pkexec /bin/bash </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span><span class="n">outname</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;You need to install the policykit to use this command: apt-get install policykit-1&quot;</span>
            <span class="k">return</span> <span class="n">error</span>

        <span class="n">error</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">feedback</span> <span class="o">=</span> <span class="s">&quot;Deleted </span><span class="si">%d</span><span class="s"> XML input files and XML output folders.&quot;</span> <span class="o">%</span><span class="nb">len</span><span class="p">(</span><span class="n">dalist</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">qctext</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qctext</span><span class="o">.</span><span class="n">appendPlainText</span><span class="p">(</span><span class="n">feedback</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">feedback</span>

        <span class="k">return</span> <span class="n">error</span>
</div>
<div class="viewcode-block" id="dbTool.destroySelected"><a class="viewcode-back" href="../../../Tools.dbTools.html#Tools.dbTools.dbTool.dbTool.destroySelected">[docs]</a>    <span class="k">def</span> <span class="nf">destroySelected</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">destroylist</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">QtGui</span><span class="o">.</span><span class="n">QApplication</span><span class="o">.</span><span class="n">setOverrideCursor</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QCursor</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">WaitCursor</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">destroylist</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span> <span class="c"># None is reserved for XML filelist</span>
            <span class="n">error</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xmlDeleteFandF</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">destroylist</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">feedback</span> <span class="o">=</span> <span class="s">&quot;ERROR! Nothing deleted, destroylist is malformed.&quot;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">qctext</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">qctext</span><span class="o">.</span><span class="n">appendPlainText</span><span class="p">(</span><span class="n">feedback</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">print</span> <span class="n">feedback</span>
            <span class="n">QtGui</span><span class="o">.</span><span class="n">QApplication</span><span class="o">.</span><span class="n">restoreOverrideCursor</span><span class="p">()</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">error</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">feedback</span> <span class="o">=</span> <span class="s">&quot;ERROR! Nothing deleted, XML files could not be removed.&quot;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">qctext</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">qctext</span><span class="o">.</span><span class="n">appendPlainText</span><span class="p">(</span><span class="n">feedback</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">print</span> <span class="n">feedback</span>
            <span class="n">QtGui</span><span class="o">.</span><span class="n">QApplication</span><span class="o">.</span><span class="n">restoreOverrideCursor</span><span class="p">()</span>
            <span class="k">return</span>

        <span class="n">num</span> <span class="o">=</span><span class="mi">0</span>
        <span class="k">for</span> <span class="n">tab</span><span class="p">,</span><span class="n">lis</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">destroylist</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">tab</span><span class="p">:</span>
                <span class="n">num</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lis</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mysqlDeleteRows</span><span class="p">(</span><span class="n">tab</span><span class="p">,</span><span class="n">lis</span><span class="p">)</span>

        <span class="n">feedback</span> <span class="o">=</span> <span class="s">&quot;Deleted </span><span class="si">%d</span><span class="s"> rows in iqc database tables.&quot;</span> <span class="o">%</span><span class="n">num</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">qctext</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qctext</span><span class="o">.</span><span class="n">appendPlainText</span><span class="p">(</span><span class="n">feedback</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">feedback</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statusLabel</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">feedback</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">destroylist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">feedback</span> <span class="o">=</span> <span class="s">&quot;Done! all traces of </span><span class="si">%s</span><span class="s"> gone from the iqc database. DCM4CHEE database is unaltered.&quot;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">selectedStation</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">qctext</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qctext</span><span class="o">.</span><span class="n">appendPlainText</span><span class="p">(</span><span class="n">feedback</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">feedback</span>
        <span class="n">QtGui</span><span class="o">.</span><span class="n">QApplication</span><span class="o">.</span><span class="n">restoreOverrideCursor</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="dbTool.seekandDestroy"><a class="viewcode-back" href="../../../Tools.dbTools.html#Tools.dbTools.dbTool.dbTool.seekandDestroy">[docs]</a>    <span class="k">def</span> <span class="nf">seekandDestroy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">mode</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">runmode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stModeDestroy</span>

        <span class="c"># clear GUI</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clearLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">)</span>

        <span class="c"># table showing selection</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qctable</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QTableWidget</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qctable</span><span class="o">.</span><span class="n">setEditTriggers</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QTableWidget</span><span class="o">.</span><span class="n">NoEditTriggers</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qctable</span><span class="o">.</span><span class="n">horizontalHeader</span><span class="p">()</span><span class="o">.</span><span class="n">sectionClicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qctable</span><span class="o">.</span><span class="n">sortByColumn</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qctext</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QPlainTextEdit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qctext</span><span class="o">.</span><span class="n">setReadOnly</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span> <span class="c"># disable editing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qctext</span><span class="o">.</span><span class="n">setTextInteractionFlags</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qctext</span><span class="o">.</span><span class="n">textInteractionFlags</span><span class="p">()</span> <span class="o">|</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">TextSelectableByKeyboard</span><span class="p">)</span> <span class="c"># keep selectable</span>

        <span class="c"># Reset Button</span>
        <span class="n">btnDestroy</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QPushButton</span><span class="p">(</span><span class="s">&quot;Destroy all traces of selected StationName/ID/Selector/Modality&quot;</span><span class="p">)</span>
        <span class="n">btnDestroy</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">destroySelected</span><span class="p">)</span>

        <span class="c">###1 open db iqc</span>
        <span class="n">con</span><span class="p">,</span><span class="n">cur</span><span class="p">,</span><span class="n">dbversion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectdb</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="p">)</span>
        <span class="n">validbdversions</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;1.1.0&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">dbversion</span> <span class="ow">in</span> <span class="n">validbdversions</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qctext</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qctext</span><span class="o">.</span><span class="n">appendPlainText</span><span class="p">(</span><span class="s">&quot;Database Version </span><span class="si">%s</span><span class="s"> is not supported for Search &amp; Destroy!&quot;</span> <span class="o">%</span> <span class="n">dbversion</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qctext</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qw</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">)</span>
            <span class="c">### close db</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">closedb</span><span class="p">(</span><span class="n">con</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s">&#39;GewenstID&#39;</span><span class="p">:</span>
            <span class="c"># dropdown with gewenste_processen ids</span>
            <span class="n">cmGewenst</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QComboBox</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">cmGewenst</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="s">&quot;[GewenstID]&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">selectedGewenst</span> <span class="o">=</span> <span class="n">cmGewenst</span><span class="o">.</span><span class="n">itemText</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">selected</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;select pk from </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_gewenste_processen</span><span class="p">))</span>
            <span class="n">rows</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;pk&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">selected</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stNone</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">selected</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;pk&#39;</span><span class="p">])</span>
            <span class="n">names</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">OrderedDict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">selected</span><span class="p">)</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="k">for</span> <span class="n">ho</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
                <span class="n">cmGewenst</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ho</span><span class="p">))</span>
            <span class="n">cmGewenst</span><span class="o">.</span><span class="n">activated</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onActivatedGewenstProces</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s">&#39;Selector&#39;</span><span class="p">:</span>
            <span class="c"># dropdown with gewenste_processen ids</span>
            <span class="n">cmSelectors</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QComboBox</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">cmSelectors</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="s">&quot;[Selector]&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">selectedSelector</span> <span class="o">=</span> <span class="n">cmSelectors</span><span class="o">.</span><span class="n">itemText</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">selector_id_text</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">selected</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;select * from </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_selector</span><span class="p">))</span>
            <span class="n">rows</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
            <span class="n">minid</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
                <span class="n">selected</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">minid</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">minid</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;pk&#39;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">minid</span> <span class="o">=</span> <span class="nb">min</span> <span class="p">(</span><span class="n">minid</span><span class="p">,</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;pk&#39;</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">selector_id_text</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;pk&#39;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">selector_id_text</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;pk&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span>
            <span class="n">names</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">OrderedDict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">selected</span><span class="p">)</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="k">for</span> <span class="n">ho</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
                <span class="n">cmSelectors</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">ho</span><span class="p">)</span>
            <span class="n">cmSelectors</span><span class="o">.</span><span class="n">activated</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onActivatedProcessorSelector</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s">&#39;Modality&#39;</span><span class="p">:</span>
            <span class="c"># dropdown with modalities</span>
            <span class="n">cmModality</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QComboBox</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">cmModality</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="s">&quot;[Modality]&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">selectedModality</span> <span class="o">=</span> <span class="n">cmModality</span><span class="o">.</span><span class="n">itemText</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="c">### fill ComboBoxes</span>
            <span class="n">selected</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;select modality from </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_series</span><span class="p">))</span>
            <span class="n">rows</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;modality&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">selected</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stNone</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">selected</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;modality&#39;</span><span class="p">])</span>
            <span class="n">names</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">OrderedDict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">selected</span><span class="p">)</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="k">for</span> <span class="n">ho</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
                <span class="n">cmModality</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">ho</span><span class="p">)</span>
            <span class="n">cmModality</span><span class="o">.</span><span class="n">activated</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onActivatedProcessorModality</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s">&#39;StationName&#39;</span><span class="p">:</span>
            <span class="c"># dropdown with stationnames</span>
            <span class="n">cmStations</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QComboBox</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">cmStations</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="s">&quot;[StationName]&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">selectedStation</span> <span class="o">=</span> <span class="n">cmStations</span><span class="o">.</span><span class="n">itemText</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="c">### fill ComboBoxes</span>
            <span class="n">selected</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;select station_name from </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_series</span><span class="p">))</span>
            <span class="n">rows</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;station_name&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">selected</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stNone</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">selected</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;station_name&#39;</span><span class="p">])</span>
            <span class="n">names</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">OrderedDict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">selected</span><span class="p">)</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="k">for</span> <span class="n">ho</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
                <span class="n">cmStations</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">ho</span><span class="p">)</span>
            <span class="n">cmStations</span><span class="o">.</span><span class="n">activated</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onActivatedProcessorStation</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># dropdown with SrcAET</span>
            <span class="n">cmSrcAET</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QComboBox</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">cmSrcAET</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="s">&quot;[SrcAET]&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">selectedAET</span> <span class="o">=</span> <span class="n">cmSrcAET</span><span class="o">.</span><span class="n">itemText</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="c">### fill ComboBoxes</span>
            <span class="n">selected</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;select src_aet from </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_series</span><span class="p">))</span>
            <span class="n">rows</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;src_aet&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">selected</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stNone</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">selected</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;src_aet&#39;</span><span class="p">])</span>
            <span class="n">names</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">OrderedDict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">selected</span><span class="p">)</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="k">for</span> <span class="n">ho</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
                <span class="n">cmSrcAET</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">ho</span><span class="p">)</span>
            <span class="n">cmSrcAET</span><span class="o">.</span><span class="n">activated</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onActivatedProcessorSrcAET</span><span class="p">)</span>

        <span class="c">### close db</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">closedb</span><span class="p">(</span><span class="n">con</span><span class="p">)</span>

        <span class="c">### build GUI</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s">&#39;GewenstID&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">cmGewenst</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s">&#39;Selector&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">cmSelectors</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s">&#39;Modality&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">cmModality</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s">&#39;StationName&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">cmStations</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">cmSrcAET</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qctext</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">btnDestroy</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qw</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="dbTool.processorReset"><a class="viewcode-back" href="../../../Tools.dbTools.html#Tools.dbTools.dbTool.dbTool.processorReset">[docs]</a>    <span class="k">def</span> <span class="nf">processorReset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">runmode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stModeProcessor</span>
        <span class="c"># clear GUI</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clearLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">)</span>

        <span class="c"># table showing selection</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qctable</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QTableWidget</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qctable</span><span class="o">.</span><span class="n">setEditTriggers</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QTableWidget</span><span class="o">.</span><span class="n">NoEditTriggers</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qctable</span><span class="o">.</span><span class="n">horizontalHeader</span><span class="p">()</span><span class="o">.</span><span class="n">sectionClicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qctable</span><span class="o">.</span><span class="n">sortByColumn</span><span class="p">)</span>

        <span class="c"># dropdown with modalities, stationnames, selector</span>
        <span class="n">cmModality</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QComboBox</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">cmModality</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="s">&quot;[Modality]&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selectedModality</span> <span class="o">=</span> <span class="n">cmModality</span><span class="o">.</span><span class="n">itemText</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">cmStations</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QComboBox</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">cmStations</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="s">&quot;[StationName]&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selectedStation</span> <span class="o">=</span> <span class="n">cmStations</span><span class="o">.</span><span class="n">itemText</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">zerotext</span> <span class="o">=</span> <span class="s">&quot;[Selector]&quot;</span>
        <span class="n">cmSelectors</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QComboBox</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">cmSelectors</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">zerotext</span><span class="p">)</span>

        <span class="n">zerotext</span> <span class="o">=</span> <span class="s">&quot;[Status]&quot;</span>
        <span class="n">cmStatus</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QComboBox</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">cmStatus</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">zerotext</span><span class="p">)</span>

        <span class="c"># Reset Button</span>
        <span class="n">btReset</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QPushButton</span><span class="p">(</span><span class="s">&quot;Reset processor status for</span><span class="se">\n</span><span class="s">processes shown in table&quot;</span><span class="p">)</span>
        <span class="n">btReset</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resetListedProcessor</span><span class="p">)</span>

        <span class="c">###1 open db iqc</span>
        <span class="n">con</span><span class="p">,</span><span class="n">cur</span><span class="p">,</span><span class="n">dbversion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectdb</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="p">)</span>

        <span class="c">### fill ComboBoxes</span>
        <span class="n">selected</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;select modality from </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_series</span><span class="p">))</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;modality&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">selected</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stNone</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">selected</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;modality&#39;</span><span class="p">])</span>
        <span class="n">names</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">OrderedDict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">selected</span><span class="p">)</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">ho</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
            <span class="n">cmModality</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">ho</span><span class="p">)</span>
        <span class="n">cmModality</span><span class="o">.</span><span class="n">activated</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onActivatedProcessorModality</span><span class="p">)</span>

        <span class="n">selected</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;select station_name from </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_series</span><span class="p">))</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;station_name&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">selected</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stNone</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">selected</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;station_name&#39;</span><span class="p">])</span>
        <span class="n">names</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">OrderedDict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">selected</span><span class="p">)</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">ho</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
            <span class="n">cmStations</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">ho</span><span class="p">)</span>
        <span class="n">cmStations</span><span class="o">.</span><span class="n">activated</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onActivatedProcessorStation</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">selector_id_text</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">selected</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;select * from </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_selector</span><span class="p">))</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="n">minid</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
            <span class="n">selected</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">minid</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">minid</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;pk&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">minid</span> <span class="o">=</span> <span class="nb">min</span> <span class="p">(</span><span class="n">minid</span><span class="p">,</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;pk&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">selector_id_text</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;pk&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">selector_id_text</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;pk&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span>
        <span class="n">names</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">OrderedDict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">selected</span><span class="p">)</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">ho</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
            <span class="n">cmSelectors</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">ho</span><span class="p">)</span>
        <span class="n">zerotext</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">cmSelectors</span><span class="o">.</span><span class="n">itemText</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selector_id_text</span><span class="p">[</span><span class="n">zerotext</span><span class="p">]</span> <span class="o">=</span> <span class="n">minid</span><span class="o">-</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selector_id_text</span><span class="p">[</span><span class="n">minid</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">zerotext</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selectedSelector</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selector_id_text</span><span class="p">[</span><span class="n">zerotext</span><span class="p">]</span>
        <span class="n">cmSelectors</span><span class="o">.</span><span class="n">activated</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onActivatedProcessorSelector</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">status_id_text</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">selected</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;select * from </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_status_omschrijving</span><span class="p">))</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="n">minid</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
            <span class="n">selected</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;veld_omschrijving&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">status_id_text</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;veld_omschrijving&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;nummer&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">status_id_text</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;nummer&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;veld_omschrijving&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">minid</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">minid</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;nummer&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">minid</span> <span class="o">=</span> <span class="nb">min</span> <span class="p">(</span><span class="n">minid</span><span class="p">,</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;nummer&#39;</span><span class="p">])</span>
        <span class="n">names</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">OrderedDict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">selected</span><span class="p">)</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">ho</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
            <span class="n">cmStatus</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">ho</span><span class="p">)</span>
        <span class="n">zerotext</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">cmStatus</span><span class="o">.</span><span class="n">itemText</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status_id_text</span><span class="p">[</span><span class="n">zerotext</span><span class="p">]</span> <span class="o">=</span> <span class="n">minid</span><span class="o">-</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status_id_text</span><span class="p">[</span><span class="n">minid</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">zerotext</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selectedStatus</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status_id_text</span><span class="p">[</span><span class="n">zerotext</span><span class="p">]</span>
        <span class="n">cmStatus</span><span class="o">.</span><span class="n">activated</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onActivatedProcessorStatus</span><span class="p">)</span>

        <span class="c">### select all processes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">onActivatedProcessorSelector</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">cmSelectors</span><span class="o">.</span><span class="n">itemText</span><span class="p">(</span><span class="mi">0</span><span class="p">)))</span>


        <span class="c">### close db</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">closedb</span><span class="p">(</span><span class="n">con</span><span class="p">)</span>

        <span class="c">### build GUI</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">cmModality</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">cmStations</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">cmSelectors</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">cmStatus</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qctable</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">btReset</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qw</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="dbTool.databaseTruncatePopUp"><a class="viewcode-back" href="../../../Tools.dbTools.html#Tools.dbTools.dbTool.dbTool.databaseTruncatePopUp">[docs]</a>    <span class="k">def</span> <span class="nf">databaseTruncatePopUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># clear GUI</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clearLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">)</span>
        <span class="n">qctext</span> <span class="o">=</span> <span class="s">&quot;Did NOT truncate ANY tables&quot;</span>

        <span class="n">title</span> <span class="o">=</span> <span class="s">&quot;Warning&quot;</span>
        <span class="n">text</span> <span class="o">=</span> <span class="s">&quot;Are you sure you want to truncate?</span><span class="se">\n</span><span class="s">&quot;</span> \
               <span class="s">&quot;This will remove all datasets and results from the IQC database,</span><span class="se">\n</span><span class="s">&quot;</span> \
               <span class="s">&quot;which will trigger the WAD-Collector to treat all data in the DCM4CHEE database as new</span><span class="se">\n\n</span><span class="s">&quot;</span> \
               <span class="s">&quot;This is NOT a clean reset of the WAD-Server.</span><span class="se">\n</span><span class="s">&quot;</span> \
               <span class="s">&quot;XML input and output files are NOT removed (but new ones will generated, so expect clutter)</span><span class="se">\n</span><span class="s">&quot;</span> \
               <span class="s">&quot;Configuration files and Selectors will remain and stay active.</span><span class="se">\n\n</span><span class="s">&quot;</span> \
               <span class="s">&quot;Last chance: press </span><span class="se">\&quot;</span><span class="s">OK</span><span class="se">\&quot;</span><span class="s"> to truncate or </span><span class="se">\&quot;</span><span class="s">CANCEL</span><span class="se">\&quot;</span><span class="s"> to bail out.&quot;</span>

        <span class="n">ret</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span><span class="n">text</span><span class="p">,</span>
                <span class="n">QtGui</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Cancel</span><span class="p">,</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ret</span> <span class="o">==</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">:</span>
            <span class="c"># textfield showing number of selected processes</span>
            <span class="n">nrows</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">databaseTruncate</span><span class="p">()</span>
            <span class="n">qctext</span> <span class="o">=</span> <span class="s">&quot;Did truncate </span><span class="si">%d</span><span class="s"> tables&quot;</span> <span class="o">%</span><span class="n">nrows</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statusLabel</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">qctext</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="dbTool.databaseTruncate"><a class="viewcode-back" href="../../../Tools.dbTools.html#Tools.dbTools.dbTool.dbTool.databaseTruncate">[docs]</a>    <span class="k">def</span> <span class="nf">databaseTruncate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c">###1 open db iqc</span>
        <span class="n">con</span><span class="p">,</span><span class="n">cur</span><span class="p">,</span><span class="n">dbversion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectdb</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="p">)</span>

        <span class="c"># truncating</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;SET FOREIGN_KEY_CHECKS=0&quot;</span><span class="p">)</span>
        <span class="n">nrows</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">ta</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">truncate_tables</span><span class="p">:</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;truncate </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">ta</span><span class="p">)</span>
            <span class="n">nrows</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;SET FOREIGN_KEY_CHECKS=1&quot;</span><span class="p">)</span>

        <span class="n">con</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

        <span class="c">### close db</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">closedb</span><span class="p">(</span><span class="n">con</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">nrows</span>
</div>
<div class="viewcode-block" id="dbTool.popupPurge"><a class="viewcode-back" href="../../../Tools.dbTools.html#Tools.dbTools.dbTool.dbTool.popupPurge">[docs]</a>    <span class="k">def</span> <span class="nf">popupPurge</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># clear GUI</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clearLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">)</span>
        <span class="n">qctext</span> <span class="o">=</span> <span class="s">&quot;Did NOT purge!&quot;</span>

        <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pathXMLInputOutput</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s">&#39;XML&#39;</span><span class="p">)</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s">&quot;Warning&quot;</span>
        <span class="n">text</span> <span class="o">=</span> <span class="s">&quot;Are you sure you want to purge?</span><span class="se">\n</span><span class="s">&quot;</span> \
               <span class="s">&quot;This will remove the files in </span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span> \
               <span class="s">&quot;and remove all datasets and results from the IQC database,</span><span class="se">\n</span><span class="s">&quot;</span> \
               <span class="s">&quot;which will trigger the WAD-Collector to treat all data in the DCM4CHEE database as new</span><span class="se">\n\n</span><span class="s">&quot;</span> \
               <span class="s">&quot;This is NOT a clean reset of the WAD-Server.</span><span class="se">\n</span><span class="s">&quot;</span> \
               <span class="s">&quot;Configuration files and Selectors will remain and stay active.</span><span class="se">\n\n</span><span class="s">&quot;</span> \
               <span class="s">&quot;Last chance: press </span><span class="se">\&quot;</span><span class="s">OK</span><span class="se">\&quot;</span><span class="s"> to purge or </span><span class="se">\&quot;</span><span class="s">CANCEL</span><span class="se">\&quot;</span><span class="s"> to bail out.&quot;</span> <span class="o">%</span> <span class="n">path</span>

        <span class="n">ret</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span><span class="n">text</span><span class="p">,</span>
                <span class="n">QtGui</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Cancel</span><span class="p">,</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ret</span> <span class="o">==</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">:</span>
            <span class="n">path1</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s">&#39;analysemodule_input&#39;</span><span class="p">)</span>
            <span class="n">path2</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s">&#39;analysemodule_output&#39;</span><span class="p">)</span>
            <span class="n">cpt</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">path1</span><span class="p">)])</span>
            <span class="n">cpt</span> <span class="o">+=</span> <span class="nb">sum</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">path2</span><span class="p">)])</span>
            <span class="n">path1</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path1</span><span class="p">,</span><span class="s">&#39;*&#39;</span><span class="p">)</span>
            <span class="n">path2</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path2</span><span class="p">,</span><span class="s">&#39;*&#39;</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="s">&quot;pkexec rm -rf </span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">path1</span><span class="p">,</span><span class="n">path2</span><span class="p">))</span>
            <span class="n">trows</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">databaseTruncate</span><span class="p">()</span>
            <span class="n">qctext</span> <span class="o">=</span> <span class="s">&quot;Did truncate </span><span class="si">%d</span><span class="s"> tables and deleted </span><span class="si">%d</span><span class="s"> files&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">trows</span><span class="p">,</span><span class="n">cpt</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statusLabel</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">qctext</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="dbTool.pathXMLInputOutput"><a class="viewcode-back" href="../../../Tools.dbTools.html#Tools.dbTools.dbTool.dbTool.pathXMLInputOutput">[docs]</a>    <span class="k">def</span> <span class="nf">pathXMLInputOutput</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">xmlroot</span><span class="p">:</span> <span class="c"># provided in ini file</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">xmlroot</span>

        <span class="n">path</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="c"># print in dialog: only works if on db (and server) on localhost, and installed as services</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="s">&#39;/etc/init/WAD-Selector.conf&#39;</span><span class="p">):</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;/etc/init/WAD-Selector.conf&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">infile</span><span class="p">:</span>
                <span class="n">rows</span> <span class="o">=</span> <span class="n">infile</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
                <span class="k">if</span> <span class="s">&#39;chdir&#39;</span> <span class="ow">in</span> <span class="n">row</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span> <span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;WAD_Services&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span>
                        <span class="k">break</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="n">path</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="s">&#39;/etc/init.d/WAD-Selector&#39;</span><span class="p">):</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;/etc/init.d/WAD-Selector&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">infile</span><span class="p">:</span>
                <span class="n">rows</span> <span class="o">=</span> <span class="n">infile</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
                <span class="k">if</span> <span class="s">&#39;RUN_FROM&#39;</span> <span class="ow">in</span> <span class="n">row</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span> <span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;=&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;WAD_Services&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span>
                        <span class="k">break</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="n">path</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;[removeXMLInputOutput] not on localhost or WAD services not installed as services&quot;</span>

        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;[removeXMLInputOutput] Could not determine path of WAD input/output&quot;</span>
        <span class="k">return</span> <span class="n">path</span>

</div>
<div class="viewcode-block" id="dbTool.periodicStatus"><a class="viewcode-back" href="../../../Tools.dbTools.html#Tools.dbTools.dbTool.dbTool.periodicStatus">[docs]</a>    <span class="k">def</span> <span class="nf">periodicStatus</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">runmode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stModeReport</span>
        <span class="c"># clear GUI</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clearLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status_id_text</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c"># table showing results</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qctable</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QTableWidget</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qctable</span><span class="o">.</span><span class="n">setEditTriggers</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QTableWidget</span><span class="o">.</span><span class="n">NoEditTriggers</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qctable</span><span class="o">.</span><span class="n">horizontalHeader</span><span class="p">()</span><span class="o">.</span><span class="n">sectionClicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qctable</span><span class="o">.</span><span class="n">sortByColumn</span><span class="p">)</span>
        <span class="c"># graph to viz data</span>
        <span class="n">dateaxis</span> <span class="o">=</span> <span class="n">DateAxis</span><span class="p">(</span><span class="n">orientation</span><span class="o">=</span><span class="s">&#39;bottom&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qcgraph</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">PlotWidget</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&quot;Report&quot;</span><span class="p">,</span> <span class="n">axisItems</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;bottom&#39;</span><span class="p">:</span> <span class="n">dateaxis</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qcgraph</span><span class="o">.</span><span class="n">setLabel</span><span class="p">(</span><span class="s">&#39;left&#39;</span><span class="p">,</span><span class="s">&#39;scaled measurement&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qcgraph</span><span class="o">.</span><span class="n">setTitle</span><span class="p">(</span><span class="s">&#39;Report&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qcgraph</span><span class="o">.</span><span class="n">showGrid</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.85</span><span class="p">)</span>
        <span class="c"># buttonboxes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qcgroupbox</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QGroupBox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s">&quot;Show graphs&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qcgroupbox</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QGridLayout</span><span class="p">())</span>

        <span class="c"># dropdown with period of report and QC periodicity</span>
        <span class="n">cmReportPeriod</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QComboBox</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">items</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s">&quot;[Period to Report]&quot;</span><span class="p">,</span>
            <span class="s">&quot;Last 3 months&quot;</span><span class="p">,</span>
            <span class="s">&quot;Last 6 months&quot;</span><span class="p">,</span>
            <span class="s">&quot;Last 12 months&quot;</span><span class="p">,</span>
            <span class="s">&quot;Previous year&quot;</span><span class="p">,</span>
            <span class="s">&quot;This year&quot;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
            <span class="n">cmReportPeriod</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">it</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selectedReportPeriod</span> <span class="o">=</span> <span class="n">cmReportPeriod</span><span class="o">.</span><span class="n">itemText</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">cmReportPeriod</span><span class="o">.</span><span class="n">activated</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onActivatedReportPeriod</span><span class="p">)</span>

        <span class="n">cmQCPeriodicity</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QComboBox</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">items</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s">&quot;[QC Periodicity]&quot;</span><span class="p">,</span>
            <span class="s">&quot;Monthly&quot;</span><span class="p">,</span>
            <span class="s">&quot;Bi-Weekly&quot;</span><span class="p">,</span>
            <span class="s">&quot;Weekly&quot;</span><span class="p">,</span>
            <span class="s">&quot;Daily&quot;</span>
            <span class="p">]</span>
        <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
            <span class="n">cmQCPeriodicity</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">it</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selectedReportQCPeriodicity</span> <span class="o">=</span> <span class="n">cmQCPeriodicity</span><span class="o">.</span><span class="n">itemText</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">cmQCPeriodicity</span><span class="o">.</span><span class="n">activated</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onActivatedReportQCPeriodicity</span><span class="p">)</span>

        <span class="c"># dropdown with modalities, stationnames, selector</span>
        <span class="n">cmModality</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QComboBox</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">cmModality</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="s">&quot;[Modality]&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selectedModality</span> <span class="o">=</span> <span class="n">cmModality</span><span class="o">.</span><span class="n">itemText</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">cmStations</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QComboBox</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">cmStations</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="s">&quot;[StationName]&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selectedStation</span> <span class="o">=</span> <span class="n">cmStations</span><span class="o">.</span><span class="n">itemText</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">zerotext</span> <span class="o">=</span> <span class="s">&quot;[Selector]&quot;</span>
        <span class="n">cmSelectors</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QComboBox</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">cmSelectors</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">zerotext</span><span class="p">)</span>

        <span class="c">###1 open db iqc</span>
        <span class="n">con</span><span class="p">,</span><span class="n">cur</span><span class="p">,</span><span class="n">dbversion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectdb</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="p">)</span>

        <span class="c">### fill ComboBoxes</span>
        <span class="n">selected</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;select modality from </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_series</span><span class="p">))</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
            <span class="n">selected</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;modality&#39;</span><span class="p">])</span>
        <span class="n">names</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">OrderedDict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">selected</span><span class="p">)</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">ho</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
            <span class="n">cmModality</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">ho</span><span class="p">)</span>
        <span class="n">cmModality</span><span class="o">.</span><span class="n">activated</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onActivatedProcessorModality</span><span class="p">)</span>

        <span class="n">selected</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;select station_name from </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_series</span><span class="p">))</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;station_name&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">selected</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stNone</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">selected</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;station_name&#39;</span><span class="p">])</span>
        <span class="n">names</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">OrderedDict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">selected</span><span class="p">)</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">ho</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
            <span class="n">cmStations</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">ho</span><span class="p">)</span>
        <span class="n">cmStations</span><span class="o">.</span><span class="n">activated</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onActivatedProcessorStation</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">selector_id_text</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">selected</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;select * from </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_selector</span><span class="p">))</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="n">minid</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
            <span class="n">selected</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">minid</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">minid</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;pk&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">minid</span> <span class="o">=</span> <span class="nb">min</span> <span class="p">(</span><span class="n">minid</span><span class="p">,</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;pk&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">selector_id_text</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;pk&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">selector_id_text</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;pk&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span>
        <span class="n">names</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">OrderedDict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">selected</span><span class="p">)</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">ho</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
            <span class="n">cmSelectors</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">ho</span><span class="p">)</span>
        <span class="n">zerotext</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">cmSelectors</span><span class="o">.</span><span class="n">itemText</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selector_id_text</span><span class="p">[</span><span class="n">zerotext</span><span class="p">]</span> <span class="o">=</span> <span class="n">minid</span><span class="o">-</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selector_id_text</span><span class="p">[</span><span class="n">minid</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">zerotext</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selectedSelector</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selector_id_text</span><span class="p">[</span><span class="n">zerotext</span><span class="p">]</span>
        <span class="n">cmSelectors</span><span class="o">.</span><span class="n">activated</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onActivatedProcessorSelector</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">status_id_text</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">selected</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;select * from </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_status_omschrijving</span><span class="p">))</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="n">minid</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
            <span class="n">selected</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;veld_omschrijving&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">status_id_text</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;veld_omschrijving&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;nummer&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">status_id_text</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;nummer&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;veld_omschrijving&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">minid</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">minid</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;nummer&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">minid</span> <span class="o">=</span> <span class="nb">min</span> <span class="p">(</span><span class="n">minid</span><span class="p">,</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;nummer&#39;</span><span class="p">])</span>
        <span class="n">names</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">selected</span><span class="p">)</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="n">zerotext</span> <span class="o">=</span> <span class="s">&quot;[Status]&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status_id_text</span><span class="p">[</span><span class="n">zerotext</span><span class="p">]</span> <span class="o">=</span> <span class="n">minid</span><span class="o">-</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status_id_text</span><span class="p">[</span><span class="n">minid</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">zerotext</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selectedStatus</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status_id_text</span><span class="p">[</span><span class="n">zerotext</span><span class="p">]</span>

        <span class="c">### close db</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">closedb</span><span class="p">(</span><span class="n">con</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">onActivatedReportPeriod</span><span class="p">(</span><span class="n">cmReportPeriod</span><span class="o">.</span><span class="n">itemText</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
        <span class="c">### build GUI</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">cmReportPeriod</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">cmQCPeriodicity</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">cmModality</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">cmStations</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">cmSelectors</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qctable</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qcgraph</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qcgroupbox</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qw</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="dbTool.finishReport"><a class="viewcode-back" href="../../../Tools.dbTools.html#Tools.dbTools.dbTool.dbTool.finishReport">[docs]</a>    <span class="k">def</span> <span class="nf">finishReport</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">reportfile</span><span class="p">,</span><span class="n">machine</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="n">verwacht</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">count</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">bads</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">retakes</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">errors</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reporter</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">abstract_data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">abstract_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">[</span><span class="s">&#39;Machine:&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="n">machine</span><span class="p">]</span> <span class="p">)</span>
        <span class="n">abstract_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">[</span><span class="s">&#39;Periode:&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s"> t/m </span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selectedReportDateTimestart</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%Y-%m-</span><span class="si">%d</span><span class="s">&#39;</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">selectedReportDateTimeuntil</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%Y-%m-</span><span class="si">%d</span><span class="s">&#39;</span><span class="p">))]</span> <span class="p">)</span>
        <span class="n">abstract_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">[</span><span class="s">&#39;Verwachte #testen:&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%d</span><span class="s">&#39;</span><span class="o">%</span><span class="n">verwacht</span><span class="p">]</span> <span class="p">)</span>
        <span class="n">abstract_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">[</span><span class="s">&#39;Uitgevoerde #testen:&#39;</span><span class="p">,</span><span class="s">&#39;</span><span class="si">%d</span><span class="s"> (</span><span class="si">%d</span><span class="s"> onbruikbaar, </span><span class="si">%d</span><span class="s"> herhalingen)&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">count</span><span class="p">,</span><span class="n">bads</span><span class="p">,</span><span class="n">retakes</span><span class="p">)]</span> <span class="p">)</span>
        <span class="k">if</span> <span class="n">verwacht</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">uitgevoerd</span> <span class="o">=</span> <span class="mf">100.</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">uitgevoerd</span> <span class="o">=</span> <span class="mf">100.</span><span class="o">*</span><span class="p">(</span><span class="n">count</span><span class="o">-</span><span class="n">bads</span><span class="o">-</span><span class="n">retakes</span><span class="p">)</span><span class="o">/</span><span class="n">verwacht</span>
        <span class="n">abstract_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">[</span><span class="s">&#39;Netto score:&#39;</span><span class="p">,</span><span class="s">&#39;</span><span class="si">%.1f%%</span><span class="s"> uitgevoerd&#39;</span> <span class="o">%</span><span class="n">uitgevoerd</span><span class="p">]</span> <span class="p">)</span>
        <span class="n">abstract_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">[</span><span class="s">&#39;Gevonden problemen:&#39;</span><span class="p">,</span><span class="s">&#39;</span><span class="si">%d</span><span class="s">&#39;</span><span class="o">%</span><span class="n">errors</span><span class="p">]</span> <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">reporter</span><span class="o">.</span><span class="n">addtitlepagewithtable</span><span class="p">(</span><span class="n">abstract_data</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">reporter</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">reportfile</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statusLabel</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s">&quot;Report written to </span><span class="si">%s</span><span class="s">.&quot;</span> <span class="o">%</span><span class="n">reportfile</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reporter</span> <span class="o">=</span> <span class="bp">None</span>
</div>
<div class="viewcode-block" id="dbTool.addToReport"><a class="viewcode-back" href="../../../Tools.dbTools.html#Tools.dbTools.dbTool.dbTool.addToReport">[docs]</a>    <span class="k">def</span> <span class="nf">addToReport</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">machine</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="n">selectors</span><span class="o">=</span><span class="p">[],</span><span class="n">scaleddata</span><span class="o">=</span><span class="p">{},</span><span class="n">errors</span><span class="o">=</span><span class="p">{},</span>
                             <span class="n">verwacht</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">counts</span><span class="o">=</span><span class="p">{},</span><span class="n">bads</span><span class="o">=</span><span class="p">{},</span><span class="n">retakes</span><span class="o">=</span><span class="p">{}):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reporter</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reporter</span> <span class="o">=</span> <span class="n">Reporter</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;QC Status Rapportage&#39;</span><span class="p">,</span><span class="n">author</span><span class="o">=</span><span class="s">&#39;dbTool.py versie </span><span class="si">%d</span><span class="s">&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">qcversion</span><span class="p">,</span><span class="n">url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">sel</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">selectors</span><span class="p">):</span>
            <span class="n">section_title</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reporter</span><span class="o">.</span><span class="n">header</span><span class="p">(</span><span class="n">machine</span><span class="o">+</span><span class="s">&#39;: &#39;</span><span class="o">+</span><span class="n">sel</span><span class="p">)</span>
            <span class="n">section_explain1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reporter</span><span class="o">.</span><span class="n">paragraph</span><span class="p">(</span><span class="s">&quot;Periode: </span><span class="si">%s</span><span class="s"> t/m </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selectedReportDateTimestart</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%Y-%m-</span><span class="si">%d</span><span class="s">&#39;</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">selectedReportDateTimeuntil</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%Y-%m-</span><span class="si">%d</span><span class="s">&#39;</span><span class="p">)))</span>
            <span class="n">section_explain2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reporter</span><span class="o">.</span><span class="n">paragraph</span><span class="p">(</span><span class="s">&quot;Verwachte #testen: </span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">verwacht</span><span class="p">)</span>
            <span class="n">section_explain3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reporter</span><span class="o">.</span><span class="n">paragraph</span><span class="p">(</span><span class="s">&quot;Uitgevoerde #testen: </span><span class="si">%d</span><span class="s"> (</span><span class="si">%d</span><span class="s"> onbruikbaar, </span><span class="si">%d</span><span class="s"> herhalingen)&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">counts</span><span class="p">[</span><span class="n">sel</span><span class="p">],</span><span class="n">bads</span><span class="p">[</span><span class="n">sel</span><span class="p">],</span><span class="n">retakes</span><span class="p">[</span><span class="n">sel</span><span class="p">]))</span>
            <span class="n">section_explain4</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reporter</span><span class="o">.</span><span class="n">paragraph</span><span class="p">(</span><span class="s">&quot;Netto score: </span><span class="si">%.1f%%</span><span class="s"> uitgevoerd&quot;</span> <span class="o">%</span><span class="p">(</span><span class="mf">100.</span><span class="o">*</span><span class="p">(</span><span class="n">counts</span><span class="p">[</span><span class="n">sel</span><span class="p">]</span><span class="o">-</span><span class="n">bads</span><span class="p">[</span><span class="n">sel</span><span class="p">]</span><span class="o">-</span><span class="n">retakes</span><span class="p">[</span><span class="n">sel</span><span class="p">])</span><span class="o">/</span><span class="n">verwacht</span><span class="p">)</span> <span class="p">)</span>

            <span class="n">total_errors</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">table_data</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">table_data</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s">&#39;meting&#39;</span><span class="p">,</span><span class="s">&#39;#problemen&#39;</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">val</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">errors</span><span class="p">[</span><span class="n">sel</span><span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()):</span>
                <span class="n">table_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">[</span><span class="n">key</span><span class="p">,</span><span class="n">val</span><span class="p">]</span> <span class="p">)</span>
                <span class="n">total_errors</span> <span class="o">+=</span> <span class="n">val</span>

            <span class="n">section_tabletext</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reporter</span><span class="o">.</span><span class="n">paragraph</span><span class="p">(</span><span class="s">&quot;In totaal zijn </span><span class="si">%d</span><span class="s"> problemen gevonden.&quot;</span> <span class="o">%</span> <span class="n">total_errors</span><span class="p">)</span>
            <span class="n">section_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reporter</span><span class="o">.</span><span class="n">table</span><span class="p">(</span> <span class="n">table_data</span> <span class="p">)</span>

            <span class="n">graph_data</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">scaleddata</span><span class="p">[</span><span class="n">sel</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="n">dadata</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">scaleddata</span><span class="p">[</span><span class="n">sel</span><span class="p">][</span><span class="n">name</span><span class="p">])</span>
                <span class="n">xyarr</span> <span class="o">=</span> <span class="p">[</span> <span class="p">(</span><span class="n">da</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">da</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">da</span> <span class="ow">in</span> <span class="n">dadata</span> <span class="p">]</span>
                <span class="n">graph_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">xyarr</span><span class="p">)</span> <span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">graph_data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">graph_data</span><span class="p">)</span><span class="o">&gt;</span><span class="bp">self</span><span class="o">.</span><span class="n">reporter</span><span class="o">.</span><span class="n">maxnumgraphsinchart</span><span class="p">:</span> <span class="c"># max two charts to this page</span>
                <span class="n">subset</span> <span class="o">=</span> <span class="n">graph_data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="nb">min</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">reporter</span><span class="o">.</span><span class="n">maxnumgraphsinchart</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">graph_data</span><span class="p">))]</span>
                <span class="n">section_chart</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reporter</span><span class="o">.</span><span class="n">stackedGraphs</span><span class="p">(</span><span class="n">subset</span><span class="p">,</span><span class="n">tmin</span><span class="o">=</span><span class="n">datetime2seconds</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selectedReportDateTimestart</span><span class="p">),</span><span class="n">tmax</span><span class="o">=</span><span class="n">datetime2seconds</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selectedReportDateTimeuntil</span><span class="p">))</span>
                <span class="n">section</span> <span class="o">=</span> <span class="p">[</span><span class="n">section_title</span><span class="p">,</span> <span class="n">section_explain1</span><span class="p">,</span><span class="n">section_explain2</span><span class="p">,</span><span class="n">section_explain3</span><span class="p">,</span><span class="n">section_explain4</span><span class="p">,</span><span class="n">section_tabletext</span><span class="p">,</span> <span class="n">section_table</span><span class="p">,</span> <span class="n">section_chart</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">reporter</span><span class="o">.</span><span class="n">addsection</span><span class="p">(</span><span class="n">section</span><span class="p">)</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">subset</span><span class="p">)</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="n">graph_data</span><span class="p">):</span>
                    <span class="n">graph_data</span> <span class="o">=</span> <span class="n">graph_data</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">subset</span><span class="p">):]</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">graph_data</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">4</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">reporter</span><span class="o">.</span><span class="n">maxnumgraphsinchart</span><span class="p">:</span>
                        <span class="k">print</span> <span class="s">&quot;ERROR! Still too many items to plot!&quot;</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">graph_data</span><span class="p">)</span>
                        <span class="k">return</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">section_chart</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reporter</span><span class="o">.</span><span class="n">stackedGraphs</span><span class="p">(</span><span class="n">graph_data</span><span class="p">,</span><span class="n">tmin</span><span class="o">=</span><span class="n">datetime2seconds</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selectedReportDateTimestart</span><span class="p">),</span><span class="n">tmax</span><span class="o">=</span><span class="n">datetime2seconds</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selectedReportDateTimeuntil</span><span class="p">))</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">reporter</span><span class="o">.</span><span class="n">addsection</span><span class="p">(</span><span class="n">section_chart</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">section_chart</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reporter</span><span class="o">.</span><span class="n">dategraph</span><span class="p">(</span><span class="n">graph_data</span><span class="p">,</span><span class="n">tmin</span><span class="o">=</span><span class="n">datetime2seconds</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selectedReportDateTimestart</span><span class="p">),</span><span class="n">tmax</span><span class="o">=</span><span class="n">datetime2seconds</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selectedReportDateTimeuntil</span><span class="p">))</span>
                <span class="n">section</span> <span class="o">=</span> <span class="p">[</span><span class="n">section_title</span><span class="p">,</span> <span class="n">section_explain1</span><span class="p">,</span><span class="n">section_explain2</span><span class="p">,</span><span class="n">section_explain3</span><span class="p">,</span><span class="n">section_explain4</span><span class="p">,</span><span class="n">section_tabletext</span><span class="p">,</span> <span class="n">section_table</span><span class="p">,</span> <span class="n">section_chart</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">reporter</span><span class="o">.</span><span class="n">addsection</span><span class="p">(</span><span class="n">section</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="dbTool.currentStatus"><a class="viewcode-back" href="../../../Tools.dbTools.html#Tools.dbTools.dbTool.dbTool.currentStatus">[docs]</a>    <span class="k">def</span> <span class="nf">currentStatus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s">&#39;selector+description&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Shows the date and outcome of the last run of each selector</span>
<span class="sd">        Flowchart:</span>
<span class="sd">        1. Get list of all selectors</span>
<span class="sd">        2. For each selector find last run</span>
<span class="sd">        3. Of each last run, determine result if NOT status == error</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">runmode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stModeReport</span>
        <span class="c"># clear GUI</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clearLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status_id_text</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c"># table showing results</span>
        <span class="c"># table showing results</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qctable</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QTableWidget</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qctable</span><span class="o">.</span><span class="n">setEditTriggers</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QTableWidget</span><span class="o">.</span><span class="n">NoEditTriggers</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qctable</span><span class="o">.</span><span class="n">horizontalHeader</span><span class="p">()</span><span class="o">.</span><span class="n">sectionClicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qctable</span><span class="o">.</span><span class="n">sortByColumn</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qcgraph</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qcgroupbox</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="c">###1 open db iqc</span>
        <span class="n">con</span><span class="p">,</span><span class="n">cur</span><span class="p">,</span><span class="n">dbversion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectdb</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="p">)</span>

        <span class="c">### fill ComboBoxes</span>
        <span class="n">selected</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;select modality from </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_series</span><span class="p">))</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
            <span class="n">selected</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;modality&#39;</span><span class="p">])</span>
        <span class="n">modalities</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">OrderedDict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">selected</span><span class="p">)</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="n">selected</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;select station_name from </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_series</span><span class="p">))</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;station_name&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">selected</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stNone</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">selected</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;station_name&#39;</span><span class="p">])</span>
        <span class="n">stations</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">OrderedDict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">selected</span><span class="p">)</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">selector_id_text</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">selected</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;select * from </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_selector</span><span class="p">))</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="n">minid</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
            <span class="n">selected</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">minid</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">minid</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;pk&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">minid</span> <span class="o">=</span> <span class="nb">min</span> <span class="p">(</span><span class="n">minid</span><span class="p">,</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;pk&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">selector_id_text</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;pk&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">selector_id_text</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;pk&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span>
        <span class="n">selectors</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">OrderedDict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">selected</span><span class="p">)</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">status_id_text</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">selected</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;select * from </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_status_omschrijving</span><span class="p">))</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="n">minid</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
            <span class="n">selected</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;veld_omschrijving&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">status_id_text</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;veld_omschrijving&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;nummer&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">status_id_text</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;nummer&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;veld_omschrijving&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">minid</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">minid</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;nummer&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">minid</span> <span class="o">=</span> <span class="nb">min</span> <span class="p">(</span><span class="n">minid</span><span class="p">,</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;nummer&#39;</span><span class="p">])</span>
        <span class="n">statusi</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">selected</span><span class="p">)</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

        <span class="n">allentries</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c"># 2.1 first make list linking all gp_ids to series_ids and add analysisdate and status</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;SELECT * FROM </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">table_gewenste_processen</span><span class="p">)</span>
        <span class="n">rows_processen</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows_processen</span><span class="p">:</span>
            <span class="n">gpid</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;pk&#39;</span><span class="p">]</span>
            <span class="n">sfk</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;series_fk&#39;</span><span class="p">]:</span>
                <span class="n">sfk</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;series_fk&#39;</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;study_fk&#39;</span><span class="p">]:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;SELECT pk FROM </span><span class="si">%s</span><span class="s"> WHERE study_fk=</span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_series</span><span class="p">,</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;study_fk&#39;</span><span class="p">]))</span>
                <span class="n">rows_series</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">roww</span> <span class="ow">in</span> <span class="n">rows_series</span><span class="p">:</span>
                    <span class="n">sfk</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">roww</span><span class="p">[</span><span class="s">&#39;pk&#39;</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;instance_fk&#39;</span><span class="p">]:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;SELECT series_fk FROM </span><span class="si">%s</span><span class="s"> WHERE pk=</span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_instances</span><span class="p">,</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;instance_fk&#39;</span><span class="p">]))</span>
                <span class="n">rows_instances</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                <span class="n">sfk</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rows_instances</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;series_fk&#39;</span><span class="p">])</span> <span class="c"># can be only one result</span>

            <span class="k">for</span> <span class="n">sk</span> <span class="ow">in</span> <span class="n">sfk</span><span class="p">:</span> <span class="c"># WIJKT AF VAN EERDER, OMDAT ONDERSCHEID MEERDERE SERIES PER STUDY NODIG</span>
                <span class="n">allentries</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">gpid</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">sk</span><span class="p">)]</span><span class="o">=</span> <span class="n">reportentry</span><span class="p">(</span><span class="n">gpid</span><span class="o">=</span><span class="n">gpid</span><span class="p">,</span><span class="n">seriesid</span><span class="o">=</span><span class="n">sk</span><span class="p">,</span>
                                                      <span class="n">status</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">status_id_text</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;status&#39;</span><span class="p">]],</span>
                                                      <span class="n">analysisdate</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;creation_time&#39;</span><span class="p">],</span>
                                                      <span class="n">selector</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">selector_id_text</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;selector_fk&#39;</span><span class="p">]],</span>
                                                      <span class="n">description</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>

        <span class="c"># 2.2: Add modality and stationname to all entries</span>
        <span class="k">for</span> <span class="n">gpid</span><span class="p">,</span><span class="n">entry</span> <span class="ow">in</span> <span class="n">allentries</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;SELECT * FROM </span><span class="si">%s</span><span class="s"> WHERE pk=</span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_series</span><span class="p">,</span><span class="n">entry</span><span class="o">.</span><span class="n">seriesid</span><span class="p">))</span>
            <span class="n">series_rows</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">series_rows</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;station_name&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">series_rows</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;station_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stNone</span>
            <span class="k">if</span> <span class="n">series_rows</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;modality&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">series_rows</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;modality&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stNone</span>
            <span class="k">if</span> <span class="n">series_rows</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;series_desc&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">series_rows</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;series_desc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
            <span class="k">if</span> <span class="n">series_rows</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;src_aet&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">series_rows</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;src_art&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stNone</span>
            <span class="n">entry</span><span class="o">.</span><span class="n">description</span> <span class="o">+=</span> <span class="n">series_rows</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;series_desc&#39;</span><span class="p">]</span>
            <span class="n">entry</span><span class="o">.</span><span class="n">stationname</span><span class="o">=</span><span class="n">series_rows</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;station_name&#39;</span><span class="p">]</span>
            <span class="n">entry</span><span class="o">.</span><span class="n">modality</span><span class="o">=</span><span class="n">series_rows</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;modality&#39;</span><span class="p">]</span>
            <span class="n">entry</span><span class="o">.</span><span class="n">srcaet</span> <span class="o">=</span> <span class="n">series_rows</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;src_aet&#39;</span><span class="p">]</span>

            <span class="c"># add content_datetime to entry</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;SELECT content_datetime FROM </span><span class="si">%s</span><span class="s"> WHERE series_fk=</span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_instances</span><span class="p">,</span><span class="n">entry</span><span class="o">.</span><span class="n">seriesid</span><span class="p">))</span>
            <span class="n">instance_rows</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
            <span class="n">seriesdate</span> <span class="o">=</span> <span class="nb">min</span> <span class="p">(</span> <span class="p">[</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;content_datetime&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">instance_rows</span><span class="p">]</span> <span class="p">)</span>
            <span class="n">entry</span><span class="o">.</span><span class="n">date</span> <span class="o">=</span> <span class="n">seriesdate</span>

        <span class="c">### close db</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">closedb</span><span class="p">(</span><span class="n">con</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">addFilterNames</span><span class="p">(</span><span class="n">allentries</span><span class="p">,</span><span class="n">doubleid</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="c"># just make sure both RH and MO are different series</span>

        <span class="c"># 3. make list of only the latest series given to each selector</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reportentries</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">entry</span> <span class="ow">in</span> <span class="n">allentries</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">uid</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">selector</span>
            <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s">&#39;selector+description&#39;</span><span class="p">:</span>
                <span class="n">uid</span><span class="o">+=</span><span class="s">&#39;_&#39;</span><span class="o">+</span><span class="n">entry</span><span class="o">.</span><span class="n">description</span>

            <span class="k">if</span> <span class="n">uid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reportentries</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">date</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">reportentries</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span><span class="o">.</span><span class="n">date</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">reportentries</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span> <span class="o">=</span> <span class="n">entry</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">reportentries</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span> <span class="o">=</span> <span class="n">entry</span>

        <span class="c"># 4. checkresults</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">checkResults</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reportentries</span><span class="p">)</span>

        <span class="c"># 5. show in table</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;Selector&#39;</span><span class="p">,</span><span class="s">&#39;StationName&#39;</span><span class="p">,</span><span class="s">&#39;Description&#39;</span><span class="p">,</span><span class="s">&#39;SrcAET&#39;</span><span class="p">,</span><span class="s">&#39;AcquisitionDate&#39;</span><span class="p">,</span><span class="s">&#39;WADStatus&#39;</span><span class="p">,</span><span class="s">&#39;AnalysisDate&#39;</span><span class="p">,</span><span class="s">&#39;Result&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qctable</span><span class="o">.</span><span class="n">setRowCount</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reportentries</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reportentries</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qctable</span><span class="o">.</span><span class="n">setColumnCount</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">headers</span><span class="p">))</span>
            <span class="n">rowid</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qctable</span><span class="o">.</span><span class="n">setHorizontalHeaderLabels</span><span class="p">(</span><span class="n">headers</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">entry</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reportentries</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()):</span>
                <span class="n">colid</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">vals</span> <span class="o">=</span> <span class="p">[</span><span class="n">entry</span><span class="o">.</span><span class="n">selector</span><span class="p">,</span> <span class="n">entry</span><span class="o">.</span><span class="n">stationname</span><span class="p">,</span><span class="n">entry</span><span class="o">.</span><span class="n">description</span><span class="p">,</span><span class="n">entry</span><span class="o">.</span><span class="n">srcaet</span><span class="p">,</span><span class="n">entry</span><span class="o">.</span><span class="n">date</span><span class="p">,</span><span class="n">entry</span><span class="o">.</span><span class="n">status</span><span class="p">,</span><span class="n">entry</span><span class="o">.</span><span class="n">analysisdate</span><span class="p">,</span><span class="n">entry</span><span class="o">.</span><span class="n">analysisresult</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">qctable</span><span class="o">.</span><span class="n">setItem</span><span class="p">(</span><span class="n">rowid</span><span class="p">,</span> <span class="n">colid</span><span class="p">,</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QTableWidgetItem</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)))</span>
                    <span class="n">colid</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">rowid</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statusLabel</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s">&quot;Done&quot;</span><span class="p">)</span>

        <span class="c">### build GUI</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qctable</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qw</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="dbTool.reportDemo"><a class="viewcode-back" href="../../../Tools.dbTools.html#Tools.dbTools.dbTool.dbTool.reportDemo">[docs]</a>    <span class="k">def</span> <span class="nf">reportDemo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">random</span>
        <span class="n">randn</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randn</span>
        <span class="c">## 2. for each selector make dictionary of scaled measurements vs date</span>
        <span class="n">machine</span> <span class="o">=</span> <span class="s">&#39;AZUMAMM&#39;</span>
        <span class="n">selectors</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;sel_a&#39;</span><span class="p">,</span><span class="s">&#39;sel_b&#39;</span><span class="p">,</span><span class="s">&#39;sel_c&#39;</span><span class="p">]</span>
        <span class="n">measurements</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;meas_a&#39;</span><span class="p">,</span><span class="s">&#39;meas_b&#39;</span><span class="p">,</span><span class="s">&#39;meas_c&#39;</span><span class="p">,</span><span class="s">&#39;meas_d&#39;</span><span class="p">,</span><span class="s">&#39;meas_e&#39;</span><span class="p">]</span>
        <span class="n">nsamples</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="n">entries</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">sel</span> <span class="ow">in</span> <span class="n">selectors</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">meas</span> <span class="ow">in</span> <span class="n">measurements</span><span class="p">:</span>
                <span class="n">secs</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="mi">3600</span><span class="o">*</span><span class="mi">24</span><span class="o">*</span><span class="mi">30</span><span class="o">*</span><span class="n">randn</span><span class="p">(</span><span class="n">nsamples</span><span class="p">)</span><span class="o">+</span><span class="n">datetime2seconds</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2014</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">)))</span>
                <span class="n">vals</span> <span class="o">=</span> <span class="n">randn</span><span class="p">(</span><span class="n">nsamples</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">s</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span> <span class="p">(</span><span class="n">secs</span><span class="p">,</span><span class="n">vals</span><span class="p">):</span>
                    <span class="n">entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span><span class="n">sel</span><span class="p">,</span><span class="n">meas</span><span class="p">,</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">s</span><span class="p">),</span><span class="n">v</span><span class="p">)</span> <span class="p">)</span>

        <span class="n">scaleddata</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">en</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">:</span>
            <span class="n">selector</span> <span class="o">=</span> <span class="n">en</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">measurement_name</span> <span class="o">=</span> <span class="n">en</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">date</span> <span class="o">=</span> <span class="n">en</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">en</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">selector</span> <span class="ow">in</span> <span class="n">scaleddata</span><span class="p">:</span>
                <span class="n">scaleddata</span><span class="p">[</span><span class="n">selector</span><span class="p">]</span><span class="o">=</span><span class="p">{}</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">measurement_name</span> <span class="ow">in</span> <span class="n">scaleddata</span><span class="p">[</span><span class="n">selector</span><span class="p">]:</span>
                <span class="n">scaleddata</span><span class="p">[</span><span class="n">selector</span><span class="p">][</span><span class="n">measurement_name</span><span class="p">]</span><span class="o">=</span><span class="p">[]</span>
            <span class="n">scaleddata</span><span class="p">[</span><span class="n">selector</span><span class="p">][</span><span class="n">measurement_name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span><span class="n">datetime2seconds</span><span class="p">(</span><span class="n">date</span><span class="p">),</span><span class="n">value</span><span class="p">,</span><span class="mf">2.</span><span class="o">*</span><span class="n">value</span><span class="p">)</span> <span class="p">)</span>

        <span class="n">errors</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">errors</span><span class="p">[</span><span class="s">&#39;meas_a&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="n">errors</span><span class="p">[</span><span class="s">&#39;meas_b&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">errors</span><span class="p">[</span><span class="s">&#39;meas_a&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span>

        <span class="n">total_errors</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">val</span> <span class="ow">in</span> <span class="n">errors</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">total_errors</span> <span class="o">+=</span> <span class="n">val</span>
        <span class="k">print</span> <span class="s">&#39;     : </span><span class="si">%d</span><span class="s"> problems:&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">total_errors</span><span class="p">),</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">val</span> <span class="ow">in</span> <span class="n">errors</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="k">print</span> <span class="n">key</span><span class="p">,</span><span class="s">&#39;:&#39;</span><span class="p">,</span><span class="n">val</span><span class="p">,</span><span class="s">&#39;;&#39;</span><span class="p">,</span>
        <span class="k">print</span> <span class="s">&#39;&#39;</span>

        <span class="n">reporter</span> <span class="o">=</span> <span class="n">Reporter</span><span class="p">(</span><span class="n">author</span><span class="o">=</span><span class="s">&#39;Me&#39;</span><span class="p">)</span>
        <span class="n">reporter</span><span class="o">.</span><span class="n">addtitlepage</span><span class="p">()</span>

        <span class="c">#print &#39;Overal: found %d (%d bad, %d retakes) of %d expected tests (net %.1f%% done) showing %d errors&#39; \</span>
        <span class="c">#      %( overal_total,overal_np,overal_retakes,overal_expected,100.*(overal_total-overal_np-overal_retakes)/overal_expected,overal_errors )</span>

        <span class="k">for</span> <span class="n">sel</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">scaleddata</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">section_title</span>   <span class="o">=</span> <span class="n">reporter</span><span class="o">.</span><span class="n">header</span><span class="p">(</span><span class="n">machine</span><span class="o">+</span><span class="s">&#39;: &#39;</span><span class="o">+</span><span class="n">sel</span><span class="p">)</span>
            <span class="n">section_explain1</span> <span class="o">=</span> <span class="n">reporter</span><span class="o">.</span><span class="n">paragraph</span><span class="p">(</span><span class="s">&quot;Periode: 2014-01-01 t/m 2014-06-30&quot;</span><span class="p">)</span>
            <span class="n">section_explain2</span> <span class="o">=</span> <span class="n">reporter</span><span class="o">.</span><span class="n">paragraph</span><span class="p">(</span><span class="s">&quot;Verwachte #testen: 52&quot;</span><span class="p">)</span>
            <span class="n">section_explain3</span> <span class="o">=</span> <span class="n">reporter</span><span class="o">.</span><span class="n">paragraph</span><span class="p">(</span><span class="s">&quot;Uitgevoerde #testen: 95 (0 onbruikbaar, 2 herhalingen)&quot;</span><span class="p">)</span>
            <span class="n">section_explain4</span> <span class="o">=</span> <span class="n">reporter</span><span class="o">.</span><span class="n">paragraph</span><span class="p">(</span><span class="s">&quot;Netto score: 178.8</span><span class="si">% u</span><span class="s">itgevoerd&quot;</span><span class="p">)</span>

            <span class="n">section_tabletext</span> <span class="o">=</span> <span class="n">reporter</span><span class="o">.</span><span class="n">paragraph</span><span class="p">(</span><span class="s">&quot;In totaal zijn 9 problemen gevonden.&quot;</span><span class="p">)</span>
            <span class="n">table_data</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">table_data</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s">&#39;meting&#39;</span><span class="p">,</span><span class="s">&#39;#problemen&#39;</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">val</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">errors</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()):</span>
                <span class="n">table_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">[</span><span class="n">key</span><span class="p">,</span><span class="n">val</span><span class="p">]</span> <span class="p">)</span>
            <span class="n">section_table</span> <span class="o">=</span> <span class="n">reporter</span><span class="o">.</span><span class="n">table</span><span class="p">(</span> <span class="n">table_data</span> <span class="p">)</span>

            <span class="n">graph_data</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">scaleddata</span><span class="p">[</span><span class="n">sel</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="n">dadata</span> <span class="o">=</span> <span class="n">scaleddata</span><span class="p">[</span><span class="n">sel</span><span class="p">][</span><span class="n">name</span><span class="p">]</span>
                <span class="n">xyarr</span> <span class="o">=</span> <span class="p">[</span> <span class="p">(</span><span class="n">da</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">da</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">da</span> <span class="ow">in</span> <span class="n">dadata</span> <span class="p">]</span>
                <span class="n">graph_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">xyarr</span><span class="p">)</span> <span class="p">)</span>
            <span class="n">section_chart</span> <span class="o">=</span> <span class="n">reporter</span><span class="o">.</span><span class="n">dategraph</span><span class="p">(</span><span class="n">graph_data</span><span class="p">)</span>

            <span class="n">section</span> <span class="o">=</span> <span class="p">[</span><span class="n">section_title</span><span class="p">,</span> <span class="n">section_explain1</span><span class="p">,</span><span class="n">section_explain2</span><span class="p">,</span><span class="n">section_explain3</span><span class="p">,</span><span class="n">section_explain4</span><span class="p">,</span><span class="n">section_tabletext</span><span class="p">,</span> <span class="n">section_table</span><span class="p">,</span> <span class="n">section_chart</span><span class="p">]</span>
            <span class="n">reporter</span><span class="o">.</span><span class="n">addsection</span><span class="p">(</span><span class="n">section</span><span class="p">)</span>


        <span class="c"># colortest</span>
        <span class="n">section_title</span> <span class="o">=</span> <span class="n">reporter</span><span class="o">.</span><span class="n">header</span><span class="p">(</span><span class="s">&quot;ColorTest&quot;</span><span class="p">)</span>
        <span class="n">section_table</span> <span class="o">=</span> <span class="n">reporter</span><span class="o">.</span><span class="n">colorTest</span><span class="p">()</span>
        <span class="n">reporter</span><span class="o">.</span><span class="n">addsection</span><span class="p">([</span><span class="n">section_title</span><span class="p">,</span><span class="n">section_table</span><span class="p">])</span>

        <span class="c"># stackedChart test</span>
        <span class="k">for</span> <span class="n">sel</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">scaleddata</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">section_title</span>   <span class="o">=</span> <span class="n">reporter</span><span class="o">.</span><span class="n">header</span><span class="p">(</span><span class="n">machine</span><span class="o">+</span><span class="s">&#39;: &#39;</span><span class="o">+</span><span class="n">sel</span><span class="p">)</span>
            <span class="n">section_explain1</span> <span class="o">=</span> <span class="n">reporter</span><span class="o">.</span><span class="n">paragraph</span><span class="p">(</span><span class="s">&quot;Periode: 2014-01-01 t/m 2014-06-30&quot;</span><span class="p">)</span>
            <span class="n">section_explain2</span> <span class="o">=</span> <span class="n">reporter</span><span class="o">.</span><span class="n">paragraph</span><span class="p">(</span><span class="s">&quot;Verwachte #testen: 52&quot;</span><span class="p">)</span>
            <span class="n">section_explain3</span> <span class="o">=</span> <span class="n">reporter</span><span class="o">.</span><span class="n">paragraph</span><span class="p">(</span><span class="s">&quot;Uitgevoerde #testen: 95 (0 onbruikbaar, 2 herhalingen)&quot;</span><span class="p">)</span>
            <span class="n">section_explain4</span> <span class="o">=</span> <span class="n">reporter</span><span class="o">.</span><span class="n">paragraph</span><span class="p">(</span><span class="s">&quot;Netto score: 178.8</span><span class="si">% u</span><span class="s">itgevoerd&quot;</span><span class="p">)</span>

            <span class="n">section_tabletext</span> <span class="o">=</span> <span class="n">reporter</span><span class="o">.</span><span class="n">paragraph</span><span class="p">(</span><span class="s">&quot;In totaal zijn 9 problemen gevonden.&quot;</span><span class="p">)</span>
            <span class="n">table_data</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">table_data</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s">&#39;meting&#39;</span><span class="p">,</span><span class="s">&#39;#problemen&#39;</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">val</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">errors</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()):</span>
                <span class="n">table_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">[</span><span class="n">key</span><span class="p">,</span><span class="n">val</span><span class="p">]</span> <span class="p">)</span>
            <span class="n">section_table</span> <span class="o">=</span> <span class="n">reporter</span><span class="o">.</span><span class="n">table</span><span class="p">(</span> <span class="n">table_data</span> <span class="p">)</span>

            <span class="n">graph_data</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">scaleddata</span><span class="p">[</span><span class="n">sel</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="n">dadata</span> <span class="o">=</span> <span class="n">scaleddata</span><span class="p">[</span><span class="n">sel</span><span class="p">][</span><span class="n">name</span><span class="p">]</span>
                <span class="n">xyarr</span> <span class="o">=</span> <span class="p">[</span> <span class="p">(</span><span class="n">da</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">da</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">da</span> <span class="ow">in</span> <span class="n">dadata</span> <span class="p">]</span>
                <span class="n">graph_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">xyarr</span><span class="p">)</span> <span class="p">)</span>
            <span class="n">section_chart</span> <span class="o">=</span> <span class="n">reporter</span><span class="o">.</span><span class="n">stackedGraphs</span><span class="p">(</span><span class="n">graph_data</span><span class="p">)</span>

            <span class="n">section</span> <span class="o">=</span> <span class="p">[</span><span class="n">section_title</span><span class="p">,</span> <span class="n">section_explain1</span><span class="p">,</span><span class="n">section_explain2</span><span class="p">,</span><span class="n">section_explain3</span><span class="p">,</span><span class="n">section_explain4</span><span class="p">,</span><span class="n">section_tabletext</span><span class="p">,</span> <span class="n">section_table</span><span class="p">,</span> <span class="n">section_chart</span><span class="p">]</span>
            <span class="n">reporter</span><span class="o">.</span><span class="n">addsection</span><span class="p">(</span><span class="n">section</span><span class="p">)</span>


        <span class="n">reportfile</span> <span class="o">=</span> <span class="s">&#39;gfe.pdf&#39;</span>
        <span class="n">reporter</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">reportfile</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statusLabel</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s">&quot;Report written to </span><span class="si">%s</span><span class="s">.&quot;</span> <span class="o">%</span><span class="n">reportfile</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="dbTool.reportMIRBucky"><a class="viewcode-back" href="../../../Tools.dbTools.html#Tools.dbTools.dbTool.dbTool.reportMIRBucky">[docs]</a>    <span class="k">def</span> <span class="nf">reportMIRBucky</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Idee: Voor iedere bucky de volgende waardes dumpen:</span>
<span class="sd">            Exposure_ms, DOP, MTF_Area5, Sensitivity</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">selectors</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;CR F10&#39;</span><span class="p">,</span><span class="s">&#39;CR F11a&#39;</span><span class="p">,</span> <span class="s">&#39;CR F11b&#39;</span><span class="p">,</span> <span class="s">&#39;CR Trauma1&#39;</span><span class="p">,</span> <span class="s">&#39;CR Trauma2&#39;</span><span class="p">]</span>
        <span class="n">subset</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s">&#39;ExposureTime (ms)&#39;</span><span class="p">,</span> <span class="s">&#39;ImageAreaDoseProduct&#39;</span><span class="p">,</span> <span class="s">&#39;Sensitivity&#39;</span><span class="p">,</span> <span class="s">&#39;AreaMTF5&#39;</span> <span class="p">]</span>
        <span class="n">subset_table</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">subset_wall</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="n">subset</span><span class="p">:</span>
            <span class="n">subset_table</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;_Table&#39;</span><span class="p">)</span>
            <span class="n">subset_wall</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;_Wall&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">runmode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stModeReport</span>
        <span class="c"># clear GUI</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clearLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status_id_text</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c"># table showing results</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qctable</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QTableWidget</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qctable</span><span class="o">.</span><span class="n">setEditTriggers</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QTableWidget</span><span class="o">.</span><span class="n">NoEditTriggers</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qctable</span><span class="o">.</span><span class="n">horizontalHeader</span><span class="p">()</span><span class="o">.</span><span class="n">sectionClicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qctable</span><span class="o">.</span><span class="n">sortByColumn</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qcgraph</span> <span class="o">=</span> <span class="bp">None</span>


        <span class="c"># make list of selectable selectors</span>
        <span class="c">###1 open db iqc</span>
        <span class="n">con</span><span class="p">,</span><span class="n">cur</span><span class="p">,</span><span class="n">dbversion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectdb</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selector_id_text</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">selected</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;select * from </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_selector</span><span class="p">))</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="n">minid</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
            <span class="n">selected</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">minid</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">minid</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;pk&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">minid</span> <span class="o">=</span> <span class="nb">min</span> <span class="p">(</span><span class="n">minid</span><span class="p">,</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;pk&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">selector_id_text</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;pk&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">selector_id_text</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;pk&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span>
        <span class="n">zerotext</span> <span class="o">=</span> <span class="s">&#39;[Selector]&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selector_id_text</span><span class="p">[</span><span class="n">zerotext</span><span class="p">]</span> <span class="o">=</span> <span class="n">minid</span><span class="o">-</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selector_id_text</span><span class="p">[</span><span class="n">minid</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">zerotext</span>

        <span class="c">### close db</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">closedb</span><span class="p">(</span><span class="n">con</span><span class="p">)</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Workflow:</span>
<span class="sd">                2. Find processes of correct modality, stationname, selector and in given reporting period</span>
<span class="sd">                3. Determine expected number of processes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">## 2. Find processes of correct modality, stationname, selector and in given reporting period</span>

        <span class="k">for</span> <span class="n">sel</span> <span class="ow">in</span> <span class="n">selectors</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">sel</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">selector_id_text</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">&quot;SEL&quot;</span><span class="p">,</span><span class="n">sel</span>
                <span class="c"># select given selector</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">selectedSelector</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">selector_id_text</span><span class="p">[</span><span class="n">sel</span><span class="p">]</span>
                <span class="c"># select correct time period</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">selectedReportPeriod</span> <span class="o">=</span> <span class="s">&#39;Previous year&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">determineReportPeriod</span><span class="p">()</span>
                <span class="c"># clear irrelevant search fields</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">selectedModality</span> <span class="o">=</span><span class="s">&#39;[Modality]&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">selectedStation</span> <span class="o">=</span> <span class="s">&#39;[StationName]&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">selectedStatus</span> <span class="o">=</span> <span class="bp">None</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">onActivatedProcessorChanged</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">lab</span><span class="p">,</span><span class="n">sss</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="s">&#39;Table&#39;</span><span class="p">,</span><span class="s">&#39;Wall&#39;</span><span class="p">],[</span><span class="n">subset_table</span><span class="p">,</span><span class="n">subset_wall</span><span class="p">]):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">getSubSelection</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reportentries</span><span class="p">,</span><span class="n">sss</span><span class="p">)</span>

                    <span class="n">fname</span> <span class="o">=</span> <span class="n">sel</span><span class="o">+</span><span class="s">&#39;_&#39;</span><span class="o">+</span><span class="n">lab</span><span class="o">+</span><span class="s">&#39;.tsv&#39;</span>
                    <span class="n">copyline</span> <span class="o">=</span> <span class="s">&#39;selector</span><span class="se">\t</span><span class="s">date&#39;</span>
                    <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">sss</span><span class="p">):</span>
                        <span class="n">copyline</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\t</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">ss</span>
                    <span class="n">copyline</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">myfile</span><span class="p">:</span>
                        <span class="n">myfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">copyline</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">en</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reportentries</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                            <span class="k">if</span> <span class="n">en</span><span class="o">.</span><span class="n">analysisresult</span><span class="p">:</span>
                                <span class="n">copyline</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="se">\t</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">en</span><span class="o">.</span><span class="n">selector</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">en</span><span class="o">.</span><span class="n">date</span><span class="p">))</span>
                                <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">val</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">en</span><span class="o">.</span><span class="n">analysisresult</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()):</span>
                                    <span class="n">copyline</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\t</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
                                <span class="n">copyline</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
                                <span class="n">myfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">copyline</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="dbTool.getSubSelection"><a class="viewcode-back" href="../../../Tools.dbTools.html#Tools.dbTools.dbTool.dbTool.getSubSelection">[docs]</a>    <span class="k">def</span> <span class="nf">getSubSelection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">entries</span><span class="p">,</span><span class="n">subselection</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check all results of given entries, identified by gewensteprocessen_id.</span>
<span class="sd">        If any of the tables resultaten_char, resultaten_floating is outside specs, put in report</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c">###1 open db iqc</span>
        <span class="n">con</span><span class="p">,</span><span class="n">cur</span><span class="p">,</span><span class="n">dbversion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectdb</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">en</span> <span class="ow">in</span> <span class="n">entries</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">en</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="s">&#39;Error&#39;</span><span class="p">:</span>
                <span class="n">en</span><span class="o">.</span><span class="n">analysisresult</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stResultError</span>
                <span class="k">continue</span>
            <span class="n">en</span><span class="o">.</span><span class="n">analysisresult</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;SELECT * FROM </span><span class="si">%s</span><span class="s"> WHERE gewenste_processen_fk=</span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_char</span><span class="p">,</span><span class="n">en</span><span class="o">.</span><span class="n">gpid</span><span class="p">))</span>
            <span class="n">rows</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;omschrijving&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">subselection</span><span class="p">:</span>
                    <span class="n">en</span><span class="o">.</span><span class="n">analysisresult</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;omschrijving&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;waarde&#39;</span><span class="p">]</span>

            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;SELECT * FROM </span><span class="si">%s</span><span class="s"> WHERE gewenste_processen_fk=</span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_float</span><span class="p">,</span><span class="n">en</span><span class="o">.</span><span class="n">gpid</span><span class="p">))</span>
            <span class="n">rows</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;omschrijving&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">subselection</span><span class="p">:</span>
                    <span class="n">en</span><span class="o">.</span><span class="n">analysisresult</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;omschrijving&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;waarde&#39;</span><span class="p">]</span>

        <span class="c">### close db</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">closedb</span><span class="p">(</span><span class="n">con</span><span class="p">)</span>
        <span class="k">return</span>
<span class="c">#----------------------------------------------------------------------</span>
<span class="c">#----------------------------------------------------------------------</span></div></div>
<div class="viewcode-block" id="DateAxis"><a class="viewcode-back" href="../../../Tools.dbTools.html#Tools.dbTools.dbTool.DateAxis">[docs]</a><span class="k">class</span> <span class="nc">DateAxis</span><span class="p">(</span><span class="n">pg</span><span class="o">.</span><span class="n">AxisItem</span><span class="p">):</span>
<div class="viewcode-block" id="DateAxis.tickStrings"><a class="viewcode-back" href="../../../Tools.dbTools.html#Tools.dbTools.dbTool.DateAxis.tickStrings">[docs]</a>    <span class="k">def</span> <span class="nf">tickStrings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">spacing</span><span class="p">):</span>
        <span class="n">strns</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">rng</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">values</span><span class="p">)</span><span class="o">-</span><span class="nb">min</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">strns</span>

        <span class="n">string</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%d</span><span class="s">-%b-%Y&#39;</span>
        <span class="n">label1</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%d</span><span class="s">-%b,%Y -&#39;</span>
        <span class="n">label2</span> <span class="o">=</span> <span class="s">&#39; </span><span class="si">%d</span><span class="s">-%b,%Y&#39;</span>

        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">strns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">localtime</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>  <span class="c">## Windows can&#39;t handle dates before 1970</span>
                <span class="n">strns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">label1</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">localtime</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">values</span><span class="p">)))</span><span class="o">+</span><span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">label2</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">localtime</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">values</span><span class="p">)))</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="c">#self.setLabel(text=label)</span>
        <span class="k">return</span> <span class="n">strns</span>
</div></div>
<div class="viewcode-block" id="process_args"><a class="viewcode-back" href="../../../Tools.dbTools.html#Tools.dbTools.dbTool.process_args">[docs]</a><span class="k">def</span> <span class="nf">process_args</span><span class="p">(</span><span class="n">argv</span><span class="p">):</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s">&#39;PyQt4 argstest&#39;</span><span class="p">,</span>
                                   <span class="n">add_help</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

    <span class="c"># reimplement help (which we disabled above) so that -help works rather</span>
    <span class="c"># than --help; done to be consistent with the style of args Qt wants</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&quot;-h&quot;</span><span class="p">,</span> <span class="s">&quot;-help&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&#39;help&#39;</span><span class="p">,</span>
                      <span class="n">help</span><span class="o">=</span><span class="s">&quot;show this help message and exit&quot;</span><span class="p">)</span>

    <span class="c"># AS: now my own</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&quot;-f&quot;</span><span class="p">,</span> <span class="s">&quot;--file&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&quot;No gui, just run for given file&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</div>
<div class="viewcode-block" id="ignore"><a class="viewcode-back" href="../../../Tools.dbTools.html#Tools.dbTools.dbTool.ignore">[docs]</a><span class="k">class</span> <span class="nc">ignore</span><span class="p">(</span><span class="n">argparse</span><span class="o">.</span><span class="n">Action</span><span class="p">):</span>
  <span class="c"># we create an action that does nothing, so the Qt args do nothing</span>
  <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">option_string</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="k">pass</span>
</div>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QApplication</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="c"># QApplication eats argv in constructor</span>

    <span class="c"># We can get a QStringList out of QApplication of those arguments it</span>
    <span class="c"># didn&#39;t decide were reserved by Qt.</span>
    <span class="n">argv2</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">arguments</span><span class="p">()</span>

    <span class="c"># now we need to turn them back into something that optparse/argparse</span>
    <span class="c"># can understand, since a QStringList is not what it wants</span>
    <span class="n">argv3</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">argv2</span><span class="p">:</span>
        <span class="n">argv3</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>

    <span class="c"># now we can pass this to optparse/argparse</span>
    <span class="n">args</span><span class="o">=</span><span class="n">process_args</span><span class="p">(</span><span class="n">argv3</span><span class="p">)</span>

    <span class="n">form</span> <span class="o">=</span> <span class="n">dbTool</span><span class="p">()</span>
    <span class="k">if</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">file</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="n">form</span><span class="o">.</span><span class="n">batchFile</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">file</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">form</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="n">app</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">..  documentation</a> &raquo;</li>
          <li><a href="../../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2015, Author.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.1.
    </div>
  </body>
</html>